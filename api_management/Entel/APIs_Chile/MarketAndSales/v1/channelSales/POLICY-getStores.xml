<?xml version="1.0" encoding="UTF-8"?>
<wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy">
    <wsp:All wsp:Usage="Required">
        <wsp:OneOrMore wsp:Usage="Required">
            <wsp:All wsp:Usage="Required">
                <L7p:Encapsulated>
                    <L7p:EncapsulatedAssertionConfigGuid stringValue="371f66e9-a471-4dfb-8e78-07c793ea10d3"/>
                    <L7p:EncapsulatedAssertionConfigName stringValue="Compose Bus Header"/>
                    <L7p:Parameters mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="format"/>
                            <L7p:value stringValue="XML"/>
                        </L7p:entry>
                        <L7p:entry>
                            <L7p:key stringValue="operationCode"/>
                            <L7p:value stringValue="SASS100173"/>
                        </L7p:entry>
                    </L7p:Parameters>
                </L7p:Encapsulated>
                <L7p:EvaluateJsonPathExpression>
                    <L7p:Expression stringValue=".Store"/>
                    <L7p:VariablePrefix stringValue="store"/>
                </L7p:EvaluateJsonPathExpression>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue=""/>
                    <L7p:VariableToSet stringValue="list_store"/>
                </L7p:SetVariable>
                <L7p:ForEachLoop L7p:Usage="Required"
                    loopVariable="store.results" variablePrefix="aux">
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="JHthdXguY3VycmVudH0="/>
                        <L7p:ContentType stringValue="application/json; charset=utf-8"/>
                        <L7p:DataType variableDataType="message"/>
                        <L7p:VariableToSet stringValue="messageInJson"/>
                    </L7p:SetVariable>
                    <L7p:EvaluateJsonPathExpression>
                        <L7p:Expression stringValue=".ID"/>
                        <L7p:OtherTargetMessageVariable stringValue="messageInJson"/>
                        <L7p:Target target="OTHER"/>
                        <L7p:VariablePrefix stringValue="ID"/>
                    </L7p:EvaluateJsonPathExpression>
                    <L7p:EvaluateJsonPathExpression>
                        <L7p:Expression stringValue=".name"/>
                        <L7p:OtherTargetMessageVariable stringValue="messageInJson"/>
                        <L7p:Target target="OTHER"/>
                        <L7p:VariablePrefix stringValue="name"/>
                    </L7p:EvaluateJsonPathExpression>
                    <L7p:EvaluateJsonPathExpression>
                        <L7p:Expression stringValue=".Warehouse.id"/>
                        <L7p:OtherTargetMessageVariable stringValue="messageInJson"/>
                        <L7p:Target target="OTHER"/>
                        <L7p:VariablePrefix stringValue="id2"/>
                    </L7p:EvaluateJsonPathExpression>
                    <L7p:EvaluateJsonPathExpression>
                        <L7p:Expression stringValue=".technicalWarehouseParentCode"/>
                        <L7p:OtherTargetMessageVariable stringValue="messageInJson"/>
                        <L7p:Target target="OTHER"/>
                        <L7p:VariablePrefix stringValue="technicalWarehouseParentCode"/>
                    </L7p:EvaluateJsonPathExpression>
                    <L7p:EvaluateJsonPathExpression>
                        <L7p:Expression stringValue=".technicalWarehouseCode"/>
                        <L7p:OtherTargetMessageVariable stringValue="messageInJson"/>
                        <L7p:Target target="OTHER"/>
                        <L7p:VariablePrefix stringValue="technicalWarehouseCode"/>
                    </L7p:EvaluateJsonPathExpression>
                    <L7p:EvaluateJsonPathExpression>
                        <L7p:Expression stringValue=".warehouseParentCode"/>
                        <L7p:OtherTargetMessageVariable stringValue="messageInJson"/>
                        <L7p:Target target="OTHER"/>
                        <L7p:VariablePrefix stringValue="warehouseParentCode"/>
                    </L7p:EvaluateJsonPathExpression>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="JHtsaXN0X3N0b3JlfQ0KICAgICAgICAgICAgPCEtLVplcm8gb3IgbW9yZSByZXBldGl0aW9uczotLT4NCiAgICAgICAgICAgIDx2MTpTdG9yZT4NCiAgICAgICAgICAgICAgIDwhLS1PcHRpb25hbDotLT4NCiAgICAgICAgICAgICAgIDx2MTpJRD4ke0lELnJlc3VsdH08L3YxOklEPg0KICAgICAgICAgICAgICAgPCEtLU9wdGlvbmFsOi0tPg0KICAgICAgICAgICAgICAgPHYxOm5hbWU+JHtuYW1lLnJlc3VsdH08L3YxOm5hbWU+DQogICAgICAgICAgICAgICA8IS0tT3B0aW9uYWw6LS0+DQogICAgICAgICAgICAgICA8djE6V2FyZWhvdXNlPg0KICAgICAgICAgICAgICAgICAgPCEtLU9wdGlvbmFsOi0tPg0KICAgICAgICAgICAgICAgICAgPHYxOmlkPiR7aWQyLnJlc3VsdH08L3YxOmlkPg0KICAgICAgICAgICAgICAgPC92MTpXYXJlaG91c2U+DQogICAgICAgICAgICAgICA8IS0tT3B0aW9uYWw6LS0+DQogICAgICAgICAgICAgICA8djE6VERFPg0KICAgICAgICAgICAgICAgICAgPCEtLU9wdGlvbmFsOi0tPg0KICAgICAgICAgICAgICAgICAgPHYxOnRlY2huaWNhbFdhcmVob3VzZVBhcmVudENvZGU+JHt0ZWNobmljYWxXYXJlaG91c2VQYXJlbnRDb2RlLnJlc3VsdH08L3YxOnRlY2huaWNhbFdhcmVob3VzZVBhcmVudENvZGU+DQogICAgICAgICAgICAgICAgICA8IS0tT3B0aW9uYWw6LS0+DQogICAgICAgICAgICAgICAgICA8djE6dGVjaG5pY2FsV2FyZWhvdXNlQ29kZT4ke3RlY2huaWNhbFdhcmVob3VzZUNvZGUucmVzdWx0fTwvdjE6dGVjaG5pY2FsV2FyZWhvdXNlQ29kZT4NCiAgICAgICAgICAgICAgICAgIDwhLS1PcHRpb25hbDotLT4NCiAgICAgICAgICAgICAgICAgIDx2MTp3YXJlaG91c2VQYXJlbnRDb2RlPiR7d2FyZWhvdXNlUGFyZW50Q29kZS5yZXN1bHR9PC92MTp3YXJlaG91c2VQYXJlbnRDb2RlPg0KICAgICAgICAgICAgICAgPC92MTpUREU+DQogICAgICAgICAgICA8L3YxOlN0b3JlPg=="/>
                        <L7p:VariableToSet stringValue="list_store"/>
                    </L7p:SetVariable>
                </L7p:ForEachLoop>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="PHNvYXA6RW52ZWxvcGUgeG1sbnM6c29hcD0iaHR0cDovL3d3dy53My5vcmcvMjAwMy8wNS9zb2FwLWVudmVsb3BlIiB4bWxuczp2MT0iaHR0cDovL3d3dy5lbnRlbC5jbC9FQk0vR2V0U3RvcmUvdjEiIHhtbG5zOnYxMT0iaHR0cDovL3d3dy5lbnRlbC5jbC9FU08vTWVzc2FnZUhlYWRlci92MSIgeG1sbnM6djI9Imh0dHA6Ly93d3cuZW50ZWwuY2wvRVNPL1Jlc3VsdC92MiIgeG1sbnM6djEyPSJodHRwOi8vd3d3LmVudGVsLmNsL0VTTy9FcnJvci92MSI+DQogICA8c29hcDpIZWFkZXIvPg0KICAgPHNvYXA6Qm9keT4NCiAgICAgIDx2MTpHZXRTdG9yZV9SRVE+DQoJCQkke2hlYWRlcn0NCiAgICAgICAgIDx2MTpCb2R5Pg0KICAJCQkke2xpc3Rfc3RvcmV9DQogICAgICAgICA8L3YxOkJvZHk+DQogICAgICA8L3YxOkdldFN0b3JlX1JFUT4NCiAgIDwvc29hcDpCb2R5Pg0KPC9zb2FwOkVudmVsb3BlPg=="/>
                    <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                    <L7p:DataType variableDataType="message"/>
                    <L7p:VariableToSet stringValue="message"/>
                </L7p:SetVariable>
                <L7p:HttpRoutingAssertion>
                    <L7p:FailOnErrorStatus booleanValue="false"/>
                    <L7p:HttpMethod httpMethod="POST"/>
                    <L7p:PassThroughSoapFaults booleanValue="false"/>
                    <L7p:ProtectedServiceUrl stringValue="http://${gateway.eUSB.tde.hostname}/ES/GetStore/v1"/>
                    <L7p:ProxyPassword stringValueNull="null"/>
                    <L7p:ProxyUsername stringValueNull="null"/>
                    <L7p:RequestHeaderRules httpPassthroughRuleSet="included">
                        <L7p:ForwardAll booleanValue="true"/>
                        <L7p:Rules httpPassthroughRules="included">
                            <L7p:item httpPassthroughRule="included">
                                <L7p:Name stringValue="Cookie"/>
                            </L7p:item>
                            <L7p:item httpPassthroughRule="included">
                                <L7p:Name stringValue="SOAPAction"/>
                            </L7p:item>
                        </L7p:Rules>
                    </L7p:RequestHeaderRules>
                    <L7p:RequestMsgSrc stringValue="message"/>
                    <L7p:RequestParamRules httpPassthroughRuleSet="included">
                        <L7p:ForwardAll booleanValue="true"/>
                        <L7p:Rules httpPassthroughRules="included"/>
                    </L7p:RequestParamRules>
                    <L7p:ResponseHeaderRules httpPassthroughRuleSet="included">
                        <L7p:ForwardAll booleanValue="true"/>
                        <L7p:Rules httpPassthroughRules="included">
                            <L7p:item httpPassthroughRule="included">
                                <L7p:Name stringValue="Set-Cookie"/>
                            </L7p:item>
                        </L7p:Rules>
                    </L7p:ResponseHeaderRules>
                    <L7p:SamlAssertionVersion intValue="2"/>
                </L7p:HttpRoutingAssertion>
                <L7p:ResponseXpathAssertion>
                    <L7p:VariablePrefix stringValue="codeResult"/>
                    <L7p:XpathExpression xpathExpressionValue="included">
                        <L7p:Expression stringValue="/soap:Envelope/soap:Body/ns1:GetStore_RSP/ns0:ResponseHeader/ns3:Result/@status"/>
                        <L7p:Namespaces mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="n0"/>
                                <L7p:value stringValue="urn:sap-com:document:sap:rfc:functions"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="soap-env"/>
                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="ns0"/>
                                <L7p:value stringValue="http://www.entel.cl/ESO/MessageHeader/v1"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="ns2"/>
                                <L7p:value stringValue="http://www.entel.cl/EBM/GetStore/v1"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="ns1"/>
                                <L7p:value stringValue="http://www.entel.cl/EBM/GetStore/v1"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="ns4"/>
                                <L7p:value stringValue="http://www.entel.cl/ESO/Error/v1"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="ns3"/>
                                <L7p:value stringValue="http://www.entel.cl/ESO/Result/v2"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="v12"/>
                                <L7p:value stringValue="http://www.entel.cl/ESO/Error/v1"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="v11"/>
                                <L7p:value stringValue="http://www.entel.cl/ESO/MessageHeader/v1"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="v1"/>
                                <L7p:value stringValue="http://www.entel.cl/EBM/GetStore/v1"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="v2"/>
                                <L7p:value stringValue="http://www.entel.cl/ESO/Result/v2"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="soap"/>
                                <L7p:value stringValue="http://www.w3.org/2003/05/soap-envelope"/>
                            </L7p:entry>
                        </L7p:Namespaces>
                        <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
                    </L7p:XpathExpression>
                </L7p:ResponseXpathAssertion>
                <L7p:ResponseXpathAssertion>
                    <L7p:VariablePrefix stringValue="descriptionResult"/>
                    <L7p:XpathExpression xpathExpressionValue="included">
                        <L7p:Expression stringValue="/s:Envelope/s:Body/ns1:GetStore_RSP/ns2:ResponseHeader/v2:Result/@description"/>
                        <L7p:Namespaces mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="res"/>
                                <L7p:value stringValue="http://www.esa.com/MED/E/consultaTraficoVozRedFija/Response"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="n0"/>
                                <L7p:value stringValue="urn:sap-com:document:sap:rfc:functions"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="soapenv"/>
                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="S"/>
                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="s"/>
                                <L7p:value stringValue="http://www.w3.org/2003/05/soap-envelope"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="ns2"/>
                                <L7p:value stringValue="http://www.entel.cl/ESO/MessageHeader/v1"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="v2"/>
                                <L7p:value stringValue="http://www.entel.cl/ESO/Result/v2"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="ns1"/>
                                <L7p:value stringValue="http://www.entel.cl/EBM/GetStore/v1"/>
                            </L7p:entry>
                        </L7p:Namespaces>
                        <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
                    </L7p:XpathExpression>
                </L7p:ResponseXpathAssertion>
                <L7p:XslTransformation>
                    <L7p:Direction intValue="2"/>
                    <L7p:ResourceInfo staticResourceInfo="included">
                        <L7p:Document stringValueReference="inline"><![CDATA[<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
  <xsl:output indent="yes" method="xml"/>
  <xsl:template match="*">
    <xsl:element name="{local-name(.)}">
      <xsl:apply-templates select="@* | node()"/>
    </xsl:element>
  </xsl:template>
  <xsl:template match="@*">
    <xsl:attribute name="{local-name(.)}">
      <xsl:value-of select="."/>
    </xsl:attribute>
  </xsl:template>
   <xsl:template match="text() | comment() | processing-instruction()">
        <xsl:copy />
   </xsl:template>
</xsl:stylesheet>]]></L7p:Document>
                    </L7p:ResourceInfo>
                    <L7p:Target target="RESPONSE"/>
                    <L7p:TransformName stringValue=""/>
                    <L7p:XsltVersion stringValue="1.0"/>
                </L7p:XslTransformation>
                <L7p:XslTransformation>
                    <L7p:Direction intValue="2"/>
                    <L7p:MsgVarPrefix stringValue="xslt2"/>
                    <L7p:ResourceInfo staticResourceInfo="included">
                        <L7p:Document stringValueReference="inline"><![CDATA[<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
    <xsl:output encoding="UTF-8" indent="no" media-type="text/x-json" method="text" omit-xml-declaration="yes"/>
    <xsl:strip-space elements="*"/>
    <!--contant-->
    <xsl:variable name="d">0123456789</xsl:variable>
    
    <!-- ignore document text -->
    <xsl:template match="text()[preceding-sibling::node() or following-sibling::node()]"/>
    
    <!-- string -->
    <xsl:template match="text()">
        <xsl:call-template name="escape-string">
            <xsl:with-param name="s" select="."/>
        </xsl:call-template>
    </xsl:template>
    

    <!-- Main template for escaping strings; used by above template and for object-properties 
        Responsibilities: placed quotes around string, and chain up to next filter, escape-bs-string -->
    <xsl:template name="escape-string">
        <xsl:param name="s"/>
        <xsl:text>"</xsl:text>
        <xsl:call-template name="escape-bs-string">
            <xsl:with-param name="s" select="$s"/>
        </xsl:call-template>
        <xsl:text>"</xsl:text>
    </xsl:template>
    
    <!-- Escape the backslash (\) before everything else. -->
    <xsl:template name="escape-bs-string">
        <xsl:param name="s"/>
        <xsl:choose>
            <xsl:when test="contains($s,'\')">
                <xsl:call-template name="escape-quot-string">
                    <xsl:with-param name="s" select="concat(substring-before($s,'\'),'\\')"/>
                </xsl:call-template>
                <xsl:call-template name="escape-bs-string">
                    <xsl:with-param name="s" select="substring-after($s,'\')"/>
                </xsl:call-template>
            </xsl:when>
            <xsl:otherwise>
                <xsl:call-template name="escape-quot-string">
                    <xsl:with-param name="s" select="$s"/>
                </xsl:call-template>
            </xsl:otherwise>
        </xsl:choose>
    </xsl:template>
    

    <!-- Escape the double quote ("). -->
    <xsl:template name="escape-quot-string">
        <xsl:param name="s"/>
        <xsl:choose>
            <xsl:when test="contains($s,'&quot;')">
                <xsl:call-template name="encode-string">
                    <xsl:with-param name="s" select="concat(substring-before($s,'&quot;'),'\&quot;')"/>
                </xsl:call-template>
                <xsl:call-template name="escape-quot-string">
                    <xsl:with-param name="s" select="substring-after($s,'&quot;')"/>
                </xsl:call-template>
            </xsl:when>
            <xsl:otherwise>
                <xsl:call-template name="encode-string">
                    <xsl:with-param name="s" select="$s"/>
                </xsl:call-template>
            </xsl:otherwise>
        </xsl:choose>
    </xsl:template>
    

    <!-- Replace tab, line feed and/or carriage return by its matching escape code. Can't escape backslash
        or double quote here, because they don't replace characters (&#x0; becomes \t), but they prefix 
        characters (\ becomes \\). Besides, backslash should be seperate anyway, because it should be 
        processed first. This function can't do that. -->
    <xsl:template name="encode-string">
        <xsl:param name="s"/>
        <xsl:choose>
            <!-- tab -->
            <xsl:when test="contains($s,'&#x9;')">
                <xsl:call-template name="encode-string">
                    <xsl:with-param name="s" select="concat(substring-before($s,'&#x9;'),'\t',substring-after($s,'&#x9;'))"/>
                </xsl:call-template>
            </xsl:when>
            <!-- line feed -->
            <xsl:when test="contains($s,'&#xa;')">
                <xsl:call-template name="encode-string">
                    <xsl:with-param name="s" select="concat(substring-before($s,'&#xa;'),'\n',substring-after($s,'&#xa;'))"/>
                </xsl:call-template>
            </xsl:when>
            <!-- carriage return -->
            <xsl:when test="contains($s,'&#xd;')">
                <xsl:call-template name="encode-string">
                    <xsl:with-param name="s" select="concat(substring-before($s,'&#xd;'),'\r',substring-after($s,'&#xd;'))"/>
                </xsl:call-template>
            </xsl:when>
            <xsl:otherwise><xsl:value-of select="$s"/></xsl:otherwise>
        </xsl:choose>
    </xsl:template>
    
    <!-- number (no support for javascript mantise) -->
    <xsl:template match="text()[not(string(number())='NaN')]">
        <xsl:text>"</xsl:text><xsl:value-of select="."/><xsl:text>"</xsl:text>
    </xsl:template>
    
    <!-- boolean, case-insensitive -->
    <xsl:template match="text()[translate(.,'TRUE','true')='true']">true</xsl:template>
    <xsl:template match="text()[translate(.,'FALSE','false')='false']">false</xsl:template>
    

    <!-- item:null -->
    <xsl:template match="*[count(child::node())=0 and not(attribute::node())]">
        <xsl:call-template name="escape-string">
            <xsl:with-param name="s" select="local-name()"/>
        </xsl:call-template>
        <xsl:text>:null</xsl:text>
        <xsl:if test="following-sibling::*">,</xsl:if>
    </xsl:template>
    

    <!-- object -->
    <xsl:template match="*" name="base">
        <!-- <xsl:if test="not(preceding-sibling::*)">{</xsl:if> -->
        <xsl:call-template name="escape-string">
            <xsl:with-param name="s" select="name()"/>
        </xsl:call-template>
        <xsl:text>:</xsl:text>
        <xsl:choose>
            <xsl:when test="attribute::node() and child::node()">
                <xsl:if test="attribute::node() or child::node()">
                    <xsl:text>{</xsl:text>
                    <xsl:call-template name="handleAttributes">
                        <xsl:with-param name="attrib" select="attribute::*"/>
                    </xsl:call-template>
                    <xsl:if test="attribute::* and child::node()"><xsl:text>, </xsl:text></xsl:if>
                    <xsl:apply-templates select="child::*"/>
                    <xsl:if test="text()">
                        <xsl:text>"$" :</xsl:text><xsl:apply-templates select="text()"/>
                    </xsl:if>
                    <xsl:text>}</xsl:text>
                </xsl:if>
            </xsl:when>

            <xsl:when test="not(attribute::node()) and child::node()">
                <xsl:if test="child::*">{</xsl:if>
                <xsl:apply-templates select="child::*"/>
                <xsl:if test="text() and child::*">
                    <xsl:text>"$" :</xsl:text>
                </xsl:if>
                <xsl:apply-templates select="text()"/>
                <xsl:if test="child::*">}</xsl:if>
            </xsl:when>
            <xsl:when test="attribute::node()">
                <xsl:text>{</xsl:text>
                <xsl:call-template name="handleAttributes">
                    <xsl:with-param name="attrib" select="attribute::*"/>
                </xsl:call-template>
                <xsl:text>}</xsl:text>
            </xsl:when>
            <xsl:otherwise>
                <xsl:apply-templates select="text()"/>
            </xsl:otherwise>
        </xsl:choose>
        <xsl:if test="following-sibling::*">,</xsl:if>
        <!-- <xsl:if test="not(following-sibling::*)">}</xsl:if> -->
    </xsl:template>
    

    <!-- array -->
    <!-- <xsl:template match="*[count(../*[name(../*)=name(.)])=count(../*) and count(../*)&gt;1]"> -->
    <xsl:template match="*[name(preceding-sibling::*[1]) = name(.) or name(following-sibling::*[1]) = name(.) or name(.) = 'detNumeracion']">
        <xsl:if test="name(.) != name(preceding-sibling::*[1])">
            <xsl:text>"</xsl:text><xsl:value-of select="name(.)"/><xsl:text>": [</xsl:text>
        </xsl:if>
        <xsl:choose>
            <xsl:when test="not(child::node()) and not(attribute::*)">
                <xsl:text>null</xsl:text>
            </xsl:when>
            <xsl:otherwise>
                <xsl:text>{</xsl:text>
                <xsl:call-template name="handleAttributes">
                    <xsl:with-param name="attrib" select="attribute::*"/>
                </xsl:call-template>
                <xsl:if test="attribute::* and (text() or child::node())"><xsl:text>, </xsl:text></xsl:if>
                <xsl:apply-templates select="child::*"/>
                <xsl:if test="text()">
                    <xsl:text>"$" :</xsl:text><xsl:apply-templates select="text()"/>
                </xsl:if>
                <xsl:text>}</xsl:text>
            </xsl:otherwise>
        </xsl:choose>
        <xsl:if test="name(.) != name(following-sibling::*[1]) or not(following-sibling::*)">]</xsl:if>
        <xsl:if test="following-sibling::*">,</xsl:if>
    </xsl:template>
    

    <xsl:template name="handleAttributes">
        <xsl:param name="attrib"/>
        <xsl:param name="count" select="count($attrib)"/>
        
        <xsl:for-each select="$attrib">
            <xsl:text>"</xsl:text><xsl:value-of select="name()"/><xsl:text>": </xsl:text>
            <xsl:choose>
                <xsl:when test=".">
                    <xsl:text>"</xsl:text><xsl:value-of select="."/><xsl:text>"</xsl:text>
                </xsl:when>
                <xsl:otherwise>
                    <xsl:text>""</xsl:text>
                </xsl:otherwise>
            </xsl:choose>
            <xsl:if test="position() &lt; $count">
                <xsl:text>, </xsl:text>
            </xsl:if>
        </xsl:for-each>
    </xsl:template>
    
    <!-- convert root element to an anonymous container -->
    <xsl:template match="/">
            <xsl:text>{</xsl:text><xsl:apply-templates select="node()"/><xsl:text>}</xsl:text>
    </xsl:template>
    
</xsl:stylesheet>]]></L7p:Document>
                    </L7p:ResourceInfo>
                    <L7p:Target target="RESPONSE"/>
                    <L7p:TransformName stringValue=""/>
                    <L7p:XsltVersion stringValue="1.0"/>
                </L7p:XslTransformation>
                <L7p:ContentType>
                    <L7p:ChangeContentType booleanValue="true"/>
                    <L7p:NewContentTypeValue stringValue="application/json"/>
                    <L7p:Target target="RESPONSE"/>
                </L7p:ContentType>
                <L7p:ComparisonAssertion>
                    <L7p:CaseSensitive booleanValue="false"/>
                    <L7p:Expression1 stringValue="${httpRouting.reasonCode}"/>
                    <L7p:Operator operatorNull="null"/>
                    <L7p:Predicates predicates="included">
                        <L7p:item dataType="included">
                            <L7p:Type variableDataType="int"/>
                        </L7p:item>
                        <L7p:item binary="included">
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:RightValue stringValue="200"/>
                        </L7p:item>
                    </L7p:Predicates>
                </L7p:ComparisonAssertion>
                <wsp:OneOrMore wsp:Usage="Required">
                    <wsp:All wsp:Usage="Required">
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${codeResult.result}"/>
                            <L7p:Operator operatorNull="null"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item dataType="included">
                                    <L7p:Type variableDataType="int"/>
                                </L7p:item>
                                <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="OK"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:EvaluateJsonPathExpression>
                            <L7p:Expression stringValue=".GetStore_RSP.Body"/>
                            <L7p:Target target="RESPONSE"/>
                        </L7p:EvaluateJsonPathExpression>
                        <L7p:Regex>
                            <L7p:AutoTarget booleanValue="false"/>
                            <L7p:OtherTargetMessageVariable stringValue="jsonPath.result"/>
                            <L7p:Regex stringValue="^\{|^}"/>
                            <L7p:Replace booleanValue="true"/>
                            <L7p:Replacement stringValue=""/>
                            <L7p:Target target="OTHER"/>
                        </L7p:Regex>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="JHtyZXF1ZXN0LnRpbWUubG9jYWwueXl5eS9NTS9kZCdUJ0hIOm1tOnNzLlNTU30="/>
                            <L7p:VariableToSet stringValue="responseTimestamp"/>
                        </L7p:SetVariable>
                        <L7p:Encapsulated>
                            <L7p:EncapsulatedAssertionConfigGuid stringValue="2873d7c1-bfb2-42b8-ab9a-35767965de80"/>
                            <L7p:EncapsulatedAssertionConfigName stringValue="API Portal Integration - Post Route"/>
                            <L7p:Parameters mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="portal.analytics.response.code"/>
                                    <L7p:value stringValue="200"/>
                                </L7p:entry>
                                <L7p:entry>
                                    <L7p:key stringValue="portal.analytics.routingTotalTime"/>
                                    <L7p:value stringValue="${request.routingTotalTime}"/>
                                </L7p:entry>
                            </L7p:Parameters>
                        </L7p:Encapsulated>
                        <L7p:HardcodedResponse>
                            <L7p:Base64ResponseBody stringValue="ewoicmVzdWx0Ijp7CgkidHJhbnNhY3Rpb25JZCI6IiR7cmVxdWVzdElkfSIsCgkiY29kZSI6IjIwMCIsCgkiZGVzY3JpcHRpb24iOiJPSyIsCgkiZGVzY3JpcHRpb25EZXRhaWwiOiAiJHtjb2RlUmVzdWx0LnJlc3VsdH06ICR7ZGVzY3JpcHRpb25SZXN1bHQucmVzdWx0fSIsCgkicmVzcG9uc2VUaW1lc3RhbXAiOiIke3Jlc3BvbnNlVGltZXN0YW1wfSIKCX0sCiR7anNvblBhdGgucmVzdWx0fQo="/>
                            <L7p:ResponseContentType stringValue="application/json; charset=UTF-8"/>
                        </L7p:HardcodedResponse>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue=">> 200 - OK"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <wsp:All wsp:Usage="Required">
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="JHtyZXF1ZXN0LnRpbWUubG9jYWwueXl5eS9NTS9kZCdUJ0hIOm1tOnNzLlNTU30="/>
                            <L7p:VariableToSet stringValue="responseTimestamp"/>
                        </L7p:SetVariable>
                        <L7p:Encapsulated>
                            <L7p:EncapsulatedAssertionConfigGuid stringValue="2873d7c1-bfb2-42b8-ab9a-35767965de80"/>
                            <L7p:EncapsulatedAssertionConfigName stringValue="API Portal Integration - Post Route"/>
                            <L7p:Parameters mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="portal.analytics.response.code"/>
                                    <L7p:value stringValue="200"/>
                                </L7p:entry>
                                <L7p:entry>
                                    <L7p:key stringValue="portal.analytics.routingTotalTime"/>
                                    <L7p:value stringValue="${request.routingTotalTime}"/>
                                </L7p:entry>
                            </L7p:Parameters>
                        </L7p:Encapsulated>
                        <L7p:HardcodedResponse>
                            <L7p:Base64ResponseBody stringValue="ewoicmVzdWx0Ijp7CgkidHJhbnNhY3Rpb25JZCI6IiR7cmVxdWVzdElkfSIsCgkiY29kZSI6IjIwMCIsCgkiZGVzY3JpcHRpb24iOiJPSyIsCgkiZGVzY3JpcHRpb25EZXRhaWwiOiAiJHtjb2RlUmVzdWx0LnJlc3VsdH06ICR7ZGVzY3JpcHRpb25SZXN1bHQucmVzdWx0fSIsCgkicmVzcG9uc2VUaW1lc3RhbXAiOiIke3Jlc3BvbnNlVGltZXN0YW1wfSIKCX0KfQo="/>
                            <L7p:ResponseContentType stringValue="application/json; charset=UTF-8"/>
                        </L7p:HardcodedResponse>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue=">> 200 - NOK"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="//Ejecucion Principal"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:OneOrMore>
            </wsp:All>
            <wsp:All wsp:Usage="Required">
                <L7p:ResponseXpathAssertion>
                    <L7p:VariablePrefix stringValue="codeResult"/>
                    <L7p:XpathExpression xpathExpressionValue="included">
                        <L7p:Expression stringValue="/soap:Envelope/soap:Body/env:Fault/env:Detail/ns11:GetStore_FRSP/v11:ResponseHeader/ns3:Result/@status"/>
                        <L7p:Namespaces mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="ns0"/>
                                <L7p:value stringValue="http://www.siebel.com/xml/TDE%20GetStore%20IO"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="env"/>
                                <L7p:value stringValue="http://www.w3.org/2003/05/soap-envelope"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="ns2"/>
                                <L7p:value stringValue="http://www.entel.cl/ESO/Tracer/v1"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="ns1"/>
                                <L7p:value stringValue="http://www.entel.cl/ESO/Error/v1"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="ns4"/>
                                <L7p:value stringValue="http://www.entel.cl/ESO/Error/v1"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="ns3"/>
                                <L7p:value stringValue="http://www.entel.cl/ESO/Result/v2"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="S"/>
                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="ns12"/>
                                <L7p:value stringValue="http://www.entel.cl/SC/ErrorManager/handle/v2"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="v12"/>
                                <L7p:value stringValue="http://www.entel.cl/ESO/Error/v1"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="ns11"/>
                                <L7p:value stringValue="http://www.entel.cl/EBM/GetStore/v1"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="v11"/>
                                <L7p:value stringValue="http://www.entel.cl/ESO/MessageHeader/v1"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="v1"/>
                                <L7p:value stringValue="http://www.entel.cl/EBM/GetStore/v1"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="v2"/>
                                <L7p:value stringValue="http://www.entel.cl/ESO/Result/v2"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="soap"/>
                                <L7p:value stringValue="http://www.w3.org/2003/05/soap-envelope"/>
                            </L7p:entry>
                        </L7p:Namespaces>
                        <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
                    </L7p:XpathExpression>
                </L7p:ResponseXpathAssertion>
                <L7p:ResponseXpathAssertion>
                    <L7p:VariablePrefix stringValue="descriptionResult"/>
                    <L7p:XpathExpression xpathExpressionValue="included">
                        <L7p:Expression stringValue="/soap:Envelope/soap:Body/env:Fault/env:Detail/ns11:GetStore_FRSP/v11:ResponseHeader/ns3:Result/@description"/>
                        <L7p:Namespaces mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="ns0"/>
                                <L7p:value stringValue="http://www.siebel.com/xml/TDE%20GetStore%20IO"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="env"/>
                                <L7p:value stringValue="http://www.w3.org/2003/05/soap-envelope"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="ns2"/>
                                <L7p:value stringValue="http://www.entel.cl/ESO/Tracer/v1"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="ns1"/>
                                <L7p:value stringValue="http://www.entel.cl/ESO/Error/v1"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="ns4"/>
                                <L7p:value stringValue="http://www.entel.cl/ESO/Error/v1"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="ns3"/>
                                <L7p:value stringValue="http://www.entel.cl/ESO/Result/v2"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="S"/>
                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="ns12"/>
                                <L7p:value stringValue="http://www.entel.cl/SC/ErrorManager/handle/v2"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="v12"/>
                                <L7p:value stringValue="http://www.entel.cl/ESO/Error/v1"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="ns11"/>
                                <L7p:value stringValue="http://www.entel.cl/EBM/GetStore/v1"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="v11"/>
                                <L7p:value stringValue="http://www.entel.cl/ESO/MessageHeader/v1"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="v1"/>
                                <L7p:value stringValue="http://www.entel.cl/EBM/GetStore/v1"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="v2"/>
                                <L7p:value stringValue="http://www.entel.cl/ESO/Result/v2"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="soap"/>
                                <L7p:value stringValue="http://www.w3.org/2003/05/soap-envelope"/>
                            </L7p:entry>
                        </L7p:Namespaces>
                        <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
                    </L7p:XpathExpression>
                </L7p:ResponseXpathAssertion>
                <L7p:ComparisonAssertion>
                    <L7p:CaseSensitive booleanValue="false"/>
                    <L7p:Expression1 stringValue="${codeResult.result}"/>
                    <L7p:Operator operatorNull="null"/>
                    <L7p:Predicates predicates="included">
                        <L7p:item dataType="included">
                            <L7p:Type variableDataType="string"/>
                        </L7p:item>
                        <L7p:item binary="included">
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:RightValue stringValue="ERROR"/>
                        </L7p:item>
                    </L7p:Predicates>
                </L7p:ComparisonAssertion>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="JHtyZXF1ZXN0LnRpbWUubG9jYWwueXl5eS9NTS9kZCdUJ0hIOm1tOnNzLlNTU30="/>
                    <L7p:VariableToSet stringValue="responseTimestamp"/>
                </L7p:SetVariable>
                <L7p:Encapsulated>
                    <L7p:EncapsulatedAssertionConfigGuid stringValue="2873d7c1-bfb2-42b8-ab9a-35767965de80"/>
                    <L7p:EncapsulatedAssertionConfigName stringValue="API Portal Integration - Post Route"/>
                    <L7p:Parameters mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="portal.analytics.response.code"/>
                            <L7p:value stringValue="200"/>
                        </L7p:entry>
                        <L7p:entry>
                            <L7p:key stringValue="portal.analytics.routingTotalTime"/>
                            <L7p:value stringValue="${request.routingTotalTime}"/>
                        </L7p:entry>
                    </L7p:Parameters>
                </L7p:Encapsulated>
                <L7p:CustomizeErrorResponse>
                    <L7p:Content stringValueReference="inline"><![CDATA[{
"result":{
	"transactionId":"${requestId}",
	"code":"422",
	"description":"Entidad no procesada",
	"descriptionDetail":"${codeResult.result}: ${descriptionResult.result}",
	"responseTimestamp":"${responseTimestamp}"
	}
}]]></L7p:Content>
                    <L7p:ContentType stringValue="application/json; charset=UTF-8"/>
                    <L7p:ExtraHeaders nameValuePairArray="included"/>
                    <L7p:HttpStatus stringValue="422"/>
                </L7p:CustomizeErrorResponse>
                <L7p:RaiseError/>
                <L7p:assertionComment>
                    <L7p:Properties mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="RIGHT.COMMENT"/>
                            <L7p:value stringValue="//Controla errores de Negocio"/>
                        </L7p:entry>
                    </L7p:Properties>
                </L7p:assertionComment>
            </wsp:All>
            <L7p:Include>
                <L7p:PolicyGuid stringValue="1b3f18a3-5e88-4cae-9fae-44b459727ac1"/>
            </L7p:Include>
            <L7p:assertionComment>
                <L7p:Properties mapValue="included">
                    <L7p:entry>
                        <L7p:key stringValue="RIGHT.COMMENT"/>
                        <L7p:value stringValue="//Logica"/>
                    </L7p:entry>
                </L7p:Properties>
            </L7p:assertionComment>
        </wsp:OneOrMore>
    </wsp:All>
</wsp:Policy>