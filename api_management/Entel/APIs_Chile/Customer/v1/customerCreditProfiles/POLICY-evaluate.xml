<?xml version="1.0" encoding="UTF-8"?>
<wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy">
    <wsp:All wsp:Usage="Required">
        <wsp:OneOrMore wsp:Usage="Required">
            <wsp:All wsp:Usage="Required">
                <L7p:HtmlFormDataAssertion>
                    <L7p:AllowGet booleanValue="true"/>
                    <L7p:DisallowOtherFields booleanValue="true"/>
                    <L7p:FieldSpecs htmlFormFieldSpecArray="included">
                        <L7p:item htmlFormFieldSpec="included">
                            <L7p:AllowEmpty boxedBooleanValue="false"/>
                            <L7p:AllowedLocation fieldLocation="requestUrl"/>
                            <L7p:DataType fieldDataType="string"/>
                            <L7p:MaxOccurs intValue="1"/>
                            <L7p:MinOccurs intValue="1"/>
                            <L7p:Name stringValue="chileanRut"/>
                        </L7p:item>
                        <L7p:item htmlFormFieldSpec="included">
                            <L7p:AllowEmpty boxedBooleanValue="false"/>
                            <L7p:AllowedLocation fieldLocation="requestUrl"/>
                            <L7p:DataType fieldDataType="string"/>
                            <L7p:MaxOccurs intValue="1"/>
                            <L7p:MinOccurs intValue="1"/>
                            <L7p:Name stringValue="chileanSerialNumber"/>
                        </L7p:item>
                    </L7p:FieldSpecs>
                </L7p:HtmlFormDataAssertion>
            </wsp:All>
            <wsp:All wsp:Usage="Required">
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="JHtyZXF1ZXN0LnRpbWUubG9jYWwueXl5eS1NTS1kZCdUJ0hIOm1tOnNzLlNTU30="/>
                    <L7p:VariableToSet stringValue="responseTimestamp"/>
                </L7p:SetVariable>
                <L7p:CustomizeErrorResponse>
                    <L7p:Content stringValueReference="inline"><![CDATA[{
"result":{
	"transactionId":"${requestId}",
	"code":"400",
	"description":"PeticiÃ³n incorrecta",
	"descriptionDetail":"Uno de los parametros no fue ingresado o tiene un formato incorrecto",
	"responseTimestamp":"${responseTimestamp}"
	}
}]]></L7p:Content>
                    <L7p:ContentType stringValue="application/json; charset=UTF-8"/>
                    <L7p:ExtraHeaders nameValuePairArray="included"/>
                    <L7p:HttpStatus stringValue="400"/>
                </L7p:CustomizeErrorResponse>
                <L7p:RaiseError/>
            </wsp:All>
        </wsp:OneOrMore>
        <wsp:OneOrMore wsp:Usage="Required">
            <wsp:All wsp:Usage="Required">
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="ew0KICAgICAgICAgICAgICAgICJhcHBsaWNhbnRzIiA6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAicHJpbWFyeUNvbnN1bWVyIiA6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInBlcnNvbmFsSW5mb3JtYXRpb24iIDogew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIm5hbWUiIDogW3sNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaWRlbnRpZmllciIgOiAiY3VycmVudCINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiY2hpbGVhblJ1dCIgOiAiJHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmNoaWxlYW5SdXR9IiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJjaGlsZWFuU2VyaWFsTnVtYmVyIiA6ICIke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXIuY2hpbGVhblNlcmlhbE51bWJlcn0iLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImFkZHJlc3NlcyIgOiBbew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJpZGVudGlmaWVyIiA6ICJjdXJyZW50Ig0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJjdXN0b21lclJlZmVyZW5jZUlkZW50aWZpZXIiIDogIkVOVEVMIg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCn0="/>
                    <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                    <L7p:DataType variableDataType="message"/>
                    <L7p:VariableToSet stringValue="json"/>
                </L7p:SetVariable>
                <L7p:AddHeader>
                    <L7p:HeaderName stringValue="Content-Type"/>
                    <L7p:HeaderValue stringValue="application/vnd.com.equifax.backbone.service.orchestration.rest.request.v1+json"/>
                    <L7p:OtherTargetMessageVariable stringValue="json"/>
                    <L7p:RemoveExisting booleanValue="true"/>
                    <L7p:Target target="OTHER"/>
                </L7p:AddHeader>
                <L7p:AddHeader>
                    <L7p:HeaderName stringValue="Authorization"/>
                    <L7p:HeaderValue stringValue="Basic ZW50ZWxwcm9kOiQwQzZhQSF5"/>
                    <L7p:OtherTargetMessageVariable stringValue="json"/>
                    <L7p:RemoveExisting booleanValue="true"/>
                    <L7p:Target target="OTHER"/>
                </L7p:AddHeader>
                <L7p:AddHeader>
                    <L7p:HeaderName stringValue="Accept-Encoding:"/>
                    <L7p:HeaderValue stringValue="gzip"/>
                    <L7p:OtherTargetMessageVariable stringValue="json"/>
                    <L7p:RemoveExisting booleanValue="true"/>
                    <L7p:Target target="OTHER"/>
                </L7p:AddHeader>
                <L7p:HttpRoutingAssertion>
                    <L7p:ConnectionTimeout stringValue="60000"/>
                    <L7p:FailOnErrorStatus booleanValue="false"/>
                    <L7p:OverrideContentType booleanValue="true"/>
                    <L7p:ProtectedServiceUrl stringValue="https://${gateway.equifax.hostname}/entel-client-orchestration/api/consumer"/>
                    <L7p:ProxyHost stringValue="${gateway.proxy.internet.hostname}"/>
                    <L7p:ProxyPort stringValue="${gateway.proxy.internet.port}"/>
                    <L7p:RequestHeaderRules httpPassthroughRuleSet="included">
                        <L7p:ForwardAll booleanValue="true"/>
                        <L7p:Rules httpPassthroughRules="included"/>
                    </L7p:RequestHeaderRules>
                    <L7p:RequestMsgSrc stringValue="json"/>
                    <L7p:RequestParamRules httpPassthroughRuleSet="included">
                        <L7p:ForwardAll booleanValue="true"/>
                        <L7p:Rules httpPassthroughRules="included"/>
                    </L7p:RequestParamRules>
                    <L7p:ResponseHeaderRules httpPassthroughRuleSet="included">
                        <L7p:Rules httpPassthroughRules="included"/>
                    </L7p:ResponseHeaderRules>
                    <L7p:Timeout stringValue="60000"/>
                </L7p:HttpRoutingAssertion>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="JHtyZXNwb25zZS5tYWlucGFydH0="/>
                    <L7p:ContentType stringValue="application/json; charset=utf-8"/>
                    <L7p:DataType variableDataType="message"/>
                    <L7p:VariableToSet stringValue="jsonRsp"/>
                </L7p:SetVariable>
                <wsp:OneOrMore wsp:Usage="Required">
                    <wsp:All wsp:Usage="Required">
                        <L7p:ComparisonAssertion>
                            <L7p:Expression1 stringValue="${httpRouting.reasonCode}"/>
                            <L7p:Expression2 stringValue="200"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item binary="included">
                                    <L7p:RightValue stringValue="200"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="JHtyZXF1ZXN0LnRpbWUubG9jYWwueXl5eS1NTS1kZCdUJ0hIOm1tOnNzLlNTU30="/>
                            <L7p:VariableToSet stringValue="responseTimestamp"/>
                        </L7p:SetVariable>
                        <L7p:Regex>
                            <L7p:AutoTarget booleanValue="false"/>
                            <L7p:OtherTargetMessageVariable stringValue="jsonRsp"/>
                            <L7p:Regex stringValue="^\{"/>
                            <L7p:Replace booleanValue="true"/>
                            <L7p:Replacement stringValue=""/>
                            <L7p:Target target="OTHER"/>
                        </L7p:Regex>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="ew0KCSJyZXN1bHQiOiB7DQoJInRyYW5zYWN0aW9uSWQiOiAiJHtyZXF1ZXN0SWR9IiwNCiAgICAiY29kZSI6ICIyMDAiLA0KICAgICJkZXNjcmlwdGlvbiI6ICJPSyIsDQogICAgImRlc2NyaXB0aW9uRGV0YWlsIjogIlByb2Nlc2FtaWVudG8gY29uY2x1w61kbyBleGl0b3NhbWVudGUiLA0KICAgICJyZXNwb25zZVRpbWVzdGFtcCI6ICIke3Jlc3BvbnNlVGltZXN0YW1wfSINCiAgfSwNCiAgJHtqc29uUnNwLm1haW5wYXJ0fQ=="/>
                            <L7p:ContentType stringValue="application/json; charset=utf-8"/>
                            <L7p:DataType variableDataType="message"/>
                            <L7p:VariableToSet stringValue="serviceRsp"/>
                        </L7p:SetVariable>
                        <L7p:Encapsulated>
                            <L7p:EncapsulatedAssertionConfigGuid stringValue="2873d7c1-bfb2-42b8-ab9a-35767965de80"/>
                            <L7p:EncapsulatedAssertionConfigName stringValue="API Portal Integration - Post Route"/>
                            <L7p:Parameters mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="portal.analytics.response.code"/>
                                    <L7p:value stringValue="200"/>
                                </L7p:entry>
                                <L7p:entry>
                                    <L7p:key stringValue="portal.analytics.routingTotalTime"/>
                                    <L7p:value stringValue="${assertion.latency.ms}"/>
                                </L7p:entry>
                            </L7p:Parameters>
                        </L7p:Encapsulated>
                        <L7p:HardcodedResponse>
                            <L7p:Base64ResponseBody stringValue="JHtzZXJ2aWNlUnNwLm1haW5wYXJ0fQ=="/>
                            <L7p:ResponseContentType stringValue="application/json; charset=utf-8"/>
                        </L7p:HardcodedResponse>
                    </wsp:All>
                    <wsp:All wsp:Usage="Required">
                        <L7p:EvaluateJsonPathExpression>
                            <L7p:Expression stringValue=".clientOrchestrationMessageError"/>
                            <L7p:OtherTargetMessageVariable stringValue="jsonRsp"/>
                            <L7p:Target target="OTHER"/>
                            <L7p:VariablePrefix stringValue="descriptionResult"/>
                        </L7p:EvaluateJsonPathExpression>
                        <L7p:EvaluateJsonPathExpression>
                            <L7p:Expression stringValue=".clientOrchestrationMessageErrorRoot"/>
                            <L7p:OtherTargetMessageVariable stringValue="jsonRsp"/>
                            <L7p:Target target="OTHER"/>
                            <L7p:VariablePrefix stringValue="codeResult"/>
                        </L7p:EvaluateJsonPathExpression>
                        <wsp:OneOrMore wsp:Usage="Required">
                            <wsp:All wsp:Usage="Required">
                                <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${httpRouting.reasonCode}"/>
                                    <L7p:Expression2 stringValue="401"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="401"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:EvaluateJsonPathExpression>
                                    <L7p:Expression stringValue=".code"/>
                                    <L7p:OtherTargetMessageVariable stringValue="jsonRsp"/>
                                    <L7p:Target target="OTHER"/>
                                    <L7p:VariablePrefix stringValue="codeResult"/>
                                </L7p:EvaluateJsonPathExpression>
                                <L7p:EvaluateJsonPathExpression>
                                    <L7p:Expression stringValue=".message"/>
                                    <L7p:OtherTargetMessageVariable stringValue="jsonRsp"/>
                                    <L7p:Target target="OTHER"/>
                                    <L7p:VariablePrefix stringValue="descriptionResult"/>
                                </L7p:EvaluateJsonPathExpression>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtyZXF1ZXN0LnRpbWUubG9jYWwueXl5eS1NTS1kZCdUJ0hIOm1tOnNzLlNTU30="/>
                                    <L7p:VariableToSet stringValue="responseTimestamp"/>
                                </L7p:SetVariable>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="ew0KCSJyZXN1bHQiOiB7DQoJInRyYW5zYWN0aW9uSWQiOiAiJHtyZXF1ZXN0SWR9IiwNCiAgICAiY29kZSI6ICIke2NvZGVSZXN1bHQucmVzdWx0fSIsDQogICAgImRlc2NyaXB0aW9uIjogIkVycm9yIiwNCiAgICAiZGVzY3JpcHRpb25EZXRhaWwiOiAiJHtkZXNjcmlwdGlvblJlc3VsdC5yZXN1bHR9IiwNCiAgICAicmVzcG9uc2VUaW1lc3RhbXAiOiAiJHtyZXNwb25zZVRpbWVzdGFtcH0iDQogIH0NCn0="/>
                                    <L7p:ContentType stringValue="application/json; charset=utf-8"/>
                                    <L7p:DataType variableDataType="message"/>
                                    <L7p:VariableToSet stringValue="serviceRsp"/>
                                </L7p:SetVariable>
                                <L7p:AuditDetailAssertion>
                                    <L7p:CustomLoggerSuffix stringValue="entel.api.syslog.error"/>
                                    <L7p:Detail stringValue="REQUESTID: ${requestId} | EVENTID: ${request.http.header.consumerId} | APIM ${service.name} Route Failed | IS STATUS: ${httpRouting.reasonCode} | IS URI: ${httpRouting.url} | IS REQUEST: ${json.mainpart} | IS RESPONSE: ${jsonRsp.mainpart} | TIMESTAMP: ${request.time.local.yyyy-MM-dd'T'HH:mm:ss.SSS}"/>
                                    <L7p:Level stringValue="WARNING"/>
                                    <L7p:LoggingOnly booleanValue="true"/>
                                </L7p:AuditDetailAssertion>
                                <L7p:Encapsulated>
                                    <L7p:EncapsulatedAssertionConfigGuid stringValue="2873d7c1-bfb2-42b8-ab9a-35767965de80"/>
                                    <L7p:EncapsulatedAssertionConfigName stringValue="API Portal Integration - Post Route"/>
                                    <L7p:Parameters mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="portal.analytics.response.code"/>
                                    <L7p:value stringValue="401"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="portal.analytics.routingTotalTime"/>
                                    <L7p:value stringValue="${assertion.latency.ms}"/>
                                    </L7p:entry>
                                    </L7p:Parameters>
                                </L7p:Encapsulated>
                                <L7p:CustomizeErrorResponse>
                                    <L7p:Content stringValue="${serviceRsp.mainpart}"/>
                                    <L7p:ContentType stringValue="application/json; charset=utf-8"/>
                                    <L7p:ExtraHeaders nameValuePairArray="included"/>
                                    <L7p:HttpStatus stringValue="${httpRouting.reasonCode}"/>
                                </L7p:CustomizeErrorResponse>
                                <L7p:RaiseError/>
                            </wsp:All>
                            <wsp:All wsp:Usage="Required">
                                <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${codeResult.result}"/>
                                    <L7p:Expression2 stringValue="20012"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="20012"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtyZXF1ZXN0LnRpbWUubG9jYWwueXl5eS1NTS1kZCdUJ0hIOm1tOnNzLlNTU30="/>
                                    <L7p:VariableToSet stringValue="responseTimestamp"/>
                                </L7p:SetVariable>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="ew0KCSJyZXN1bHQiOiB7DQoJInRyYW5zYWN0aW9uSWQiOiAiJHtyZXF1ZXN0SWR9IiwNCiAgICAiY29kZSI6ICIke2NvZGVSZXN1bHQucmVzdWx0fSIsDQogICAgImRlc2NyaXB0aW9uIjogIkVycm9yIGludGVybm8gZW4gZWwgc2Vydmlkb3IiLA0KICAgICJkZXNjcmlwdGlvbkRldGFpbCI6ICIke2Rlc2NyaXB0aW9uUmVzdWx0LnJlc3VsdH0iLA0KICAgICJyZXNwb25zZVRpbWVzdGFtcCI6ICIke3Jlc3BvbnNlVGltZXN0YW1wfSINCiAgfQ0KfQ=="/>
                                    <L7p:ContentType stringValue="application/json; charset=utf-8"/>
                                    <L7p:DataType variableDataType="message"/>
                                    <L7p:VariableToSet stringValue="serviceRsp"/>
                                </L7p:SetVariable>
                                <L7p:AuditDetailAssertion>
                                    <L7p:CustomLoggerSuffix stringValue="entel.api.syslog.error"/>
                                    <L7p:Detail stringValue="REQUESTID: ${requestId} | EVENTID: ${request.http.header.consumerId} | APIM ${service.name} Route Failed | IS STATUS: ${httpRouting.reasonCode} | IS URI: ${httpRouting.url} | IS REQUEST: ${json.mainpart} | IS RESPONSE: ${jsonRsp.mainpart} | TIMESTAMP: ${request.time.local.yyyy-MM-dd'T'HH:mm:ss.SSS}"/>
                                    <L7p:Level stringValue="WARNING"/>
                                    <L7p:LoggingOnly booleanValue="true"/>
                                </L7p:AuditDetailAssertion>
                                <L7p:Encapsulated>
                                    <L7p:EncapsulatedAssertionConfigGuid stringValue="2873d7c1-bfb2-42b8-ab9a-35767965de80"/>
                                    <L7p:EncapsulatedAssertionConfigName stringValue="API Portal Integration - Post Route"/>
                                    <L7p:Parameters mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="portal.analytics.response.code"/>
                                    <L7p:value stringValue="500"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="portal.analytics.routingTotalTime"/>
                                    <L7p:value stringValue="${assertion.latency.ms}"/>
                                    </L7p:entry>
                                    </L7p:Parameters>
                                </L7p:Encapsulated>
                                <L7p:CustomizeErrorResponse>
                                    <L7p:Content stringValue="${serviceRsp.mainpart}"/>
                                    <L7p:ContentType stringValue="application/json; charset=utf-8"/>
                                    <L7p:ExtraHeaders nameValuePairArray="included"/>
                                </L7p:CustomizeErrorResponse>
                                <L7p:RaiseError/>
                            </wsp:All>
                            <wsp:All wsp:Usage="Required">
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtyZXF1ZXN0LnRpbWUubG9jYWwueXl5eS1NTS1kZCdUJ0hIOm1tOnNzLlNTU30="/>
                                    <L7p:VariableToSet stringValue="responseTimestamp"/>
                                </L7p:SetVariable>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="ew0KCSJyZXN1bHQiOiB7DQoJInRyYW5zYWN0aW9uSWQiOiAiJHtyZXF1ZXN0SWR9IiwNCiAgICAiY29kZSI6ICIke2NvZGVSZXN1bHQucmVzdWx0fSIsDQogICAgImRlc2NyaXB0aW9uIjogIkVycm9yIGludGVybm8gZW4gZWwgc2Vydmlkb3IiLA0KICAgICJkZXNjcmlwdGlvbkRldGFpbCI6ICIke2Rlc2NyaXB0aW9uUmVzdWx0LnJlc3VsdH0iLA0KICAgICJyZXNwb25zZVRpbWVzdGFtcCI6ICIke3Jlc3BvbnNlVGltZXN0YW1wfSINCiAgfQ0KfQ=="/>
                                    <L7p:ContentType stringValue="application/json; charset=utf-8"/>
                                    <L7p:DataType variableDataType="message"/>
                                    <L7p:VariableToSet stringValue="serviceRsp"/>
                                </L7p:SetVariable>
                                <L7p:AuditDetailAssertion>
                                    <L7p:CustomLoggerSuffix stringValue="entel.api.syslog.error"/>
                                    <L7p:Detail stringValue="REQUESTID: ${requestId} | EVENTID: ${request.http.header.consumerId} | APIM ${service.name} Route Failed | IS STATUS: ${httpRouting.reasonCode} | IS URI: ${httpRouting.url} | IS REQUEST: ${json.mainpart} | IS RESPONSE: ${jsonRsp.mainpart} | TIMESTAMP: ${request.time.local.yyyy-MM-dd'T'HH:mm:ss.SSS}"/>
                                    <L7p:Level stringValue="WARNING"/>
                                    <L7p:LoggingOnly booleanValue="true"/>
                                </L7p:AuditDetailAssertion>
                                <L7p:Encapsulated>
                                    <L7p:EncapsulatedAssertionConfigGuid stringValue="2873d7c1-bfb2-42b8-ab9a-35767965de80"/>
                                    <L7p:EncapsulatedAssertionConfigName stringValue="API Portal Integration - Post Route"/>
                                    <L7p:Parameters mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="portal.analytics.response.code"/>
                                    <L7p:value stringValue="${httpRouting.reasonCode}"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="portal.analytics.routingTotalTime"/>
                                    <L7p:value stringValue="${assertion.latency.ms}"/>
                                    </L7p:entry>
                                    </L7p:Parameters>
                                </L7p:Encapsulated>
                                <L7p:CustomizeErrorResponse>
                                    <L7p:Content stringValue="${serviceRsp.mainpart}"/>
                                    <L7p:ContentType stringValue="application/json; charset=utf-8"/>
                                    <L7p:ExtraHeaders nameValuePairArray="included"/>
                                    <L7p:HttpStatus stringValue="${httpRouting.reasonCode}"/>
                                </L7p:CustomizeErrorResponse>
                                <L7p:RaiseError/>
                            </wsp:All>
                        </wsp:OneOrMore>
                    </wsp:All>
                </wsp:OneOrMore>
            </wsp:All>
            <wsp:All wsp:Usage="Required">
                <L7p:Encapsulated>
                    <L7p:EncapsulatedAssertionConfigGuid stringValue="14295f18-da19-4f0e-9643-a8c30b3544dc"/>
                    <L7p:EncapsulatedAssertionConfigName stringValue="CodeStatus"/>
                </L7p:Encapsulated>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="JHtyZXF1ZXN0LnRpbWUubG9jYWwueXl5eS1NTS1kZCdUJ0hIOm1tOnNzLlNTU30="/>
                    <L7p:VariableToSet stringValue="responseTimestamp"/>
                </L7p:SetVariable>
                <L7p:AuditDetailAssertion>
                    <L7p:CustomLoggerSuffix stringValue="entel.api.syslog.error"/>
                    <L7p:Detail stringValue="REQUESTID: ${requestId} | EVENTID: ${request.http.header.consumerId} | APIM ${service.name} Route Failed | IS STATUS: ${httpRouting.reasonCode} | IS URI: ${httpRouting.url} | IS REQUEST: ${json.mainpart} | IS RESPONSE: ${jsonRsp.mainpart} | TIMESTAMP: ${request.time.local.yyyy-MM-dd'T'HH:mm:ss.SSS}"/>
                    <L7p:Level stringValue="WARNING"/>
                    <L7p:LoggingOnly booleanValue="true"/>
                </L7p:AuditDetailAssertion>
                <L7p:Encapsulated>
                    <L7p:EncapsulatedAssertionConfigGuid stringValue="2873d7c1-bfb2-42b8-ab9a-35767965de80"/>
                    <L7p:EncapsulatedAssertionConfigName stringValue="API Portal Integration - Post Route"/>
                    <L7p:Parameters mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="portal.analytics.response.code"/>
                            <L7p:value stringValue="${httpRouting.reasonCode}"/>
                        </L7p:entry>
                        <L7p:entry>
                            <L7p:key stringValue="portal.analytics.routingTotalTime"/>
                            <L7p:value stringValue="${assertion.latency.ms}"/>
                        </L7p:entry>
                    </L7p:Parameters>
                </L7p:Encapsulated>
                <L7p:CustomizeErrorResponse>
                    <L7p:Content stringValueReference="inline"><![CDATA[{
"result":{
	"transactionId":"${requestId}",
	"code":"${httpRouting.ReasonCode}",
	"description":"${codeDescription}",
	"descriptionDetail":"Error en el procesamiento de la solicitud",
	"responseTimestamp":"${responseTimestamp}"
	}
}]]></L7p:Content>
                    <L7p:ContentType stringValue="application/json; charset=UTF-8"/>
                    <L7p:ExtraHeaders nameValuePairArray="included"/>
                    <L7p:HttpStatus stringValue="${httpRouting.reasonCode}"/>
                </L7p:CustomizeErrorResponse>
                <L7p:RaiseError/>
            </wsp:All>
            <L7p:Include>
                <L7p:PolicyGuid stringValue="1b3f18a3-5e88-4cae-9fae-44b459727ac1"/>
            </L7p:Include>
        </wsp:OneOrMore>
    </wsp:All>
</wsp:Policy>