<?xml version="1.0" encoding="UTF-8"?>
<wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy">
    <wsp:All wsp:Usage="Required">
        <L7p:UUIDGenerator>
            <L7p:TargetVariable stringValue="idTransaction"/>
        </L7p:UUIDGenerator>
        <wsp:OneOrMore wsp:Usage="Required">
            <wsp:All wsp:Usage="Required">
                <L7p:ComparisonAssertion>
                    <L7p:CaseSensitive booleanValue="false"/>
                    <L7p:Expression1 stringValue="${url.length}"/>
                    <L7p:Expression2 stringValue="4"/>
                    <L7p:Predicates predicates="included">
                        <L7p:item binary="included">
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:RightValue stringValue="4"/>
                        </L7p:item>
                    </L7p:Predicates>
                </L7p:ComparisonAssertion>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="JHt1cmxbM119"/>
                    <L7p:VariableToSet stringValue="msisdn"/>
                </L7p:SetVariable>
                <L7p:Regex>
                    <L7p:AutoTarget booleanValue="false"/>
                    <L7p:OtherTargetMessageVariable stringValue="msisdn"/>
                    <L7p:Regex stringValue="^(569){1}\d{8}"/>
                    <L7p:RegexName stringValue="regularNumberPhone"/>
                    <L7p:RegexVar stringValue="regularExpresion"/>
                    <L7p:Replacement stringValue=""/>
                    <L7p:Target target="OTHER"/>
                </L7p:Regex>
            </wsp:All>
            <wsp:All wsp:Usage="Required">
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="SW52YWxpZCBwYXJhbWV0ZXI="/>
                    <L7p:VariableToSet stringValue="description"/>
                </L7p:SetVariable>
                <L7p:AuditDetailAssertion>
                    <L7p:CustomLoggerSuffix stringValue="entel.api.syslog"/>
                    <L7p:Detail stringValue="idOperation: ${idTransaction} ResourceId: ${msisdn} Message: ${description} Service: ${request.http.uri}"/>
                    <L7p:LoggingOnly booleanValue="true"/>
                </L7p:AuditDetailAssertion>
                <L7p:CustomizeErrorResponse>
                    <L7p:Content stringValueReference="inline"><![CDATA[{
"error":"Invalid parameter"
}]]></L7p:Content>
                    <L7p:ContentType stringValue="application/json; charset=UTF-8"/>
                    <L7p:ExtraHeaders nameValuePairArray="included"/>
                    <L7p:HttpStatus stringValue="400"/>
                </L7p:CustomizeErrorResponse>
                <L7p:RaiseError/>
            </wsp:All>
            <L7p:assertionComment>
                <L7p:Properties mapValue="included">
                    <L7p:entry>
                        <L7p:key stringValue="LEFT.COMMENT"/>
                        <L7p:value stringValue="validar parametro entrada"/>
                    </L7p:entry>
                </L7p:Properties>
            </L7p:assertionComment>
        </wsp:OneOrMore>
        <wsp:OneOrMore wsp:Usage="Required">
            <wsp:All wsp:Usage="Required">
                <L7p:JdbcQuery>
                    <L7p:AssertionFailureEnabled booleanValue="false"/>
                    <L7p:ConnectionName stringValue="MigrationInfo"/>
                    <L7p:ConvertVariablesToStrings booleanValue="false"/>
                    <L7p:SqlQuery stringValueReference="inline"><![CDATA[SELECT DOCUMENT_TYPE,DOCUMENT_ID,CUSTOMER_ID,RESOURCE_ID,SUBSCRIPTION_ID,STATE,RESOURCE_TYPE
FROM ESB_MIGRATION_INFO
WHERE
(STATE='MIG' OR STATE='MNA' OR STATE='ACT' OR STATE='NOT') AND
RESOURCE_ID=${msisdn}]]></L7p:SqlQuery>
                </L7p:JdbcQuery>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="JHtqZGJjUXVlcnkucXVlcnlyZXN1bHQuY291bnR9"/>
                    <L7p:DataType variableDataType="int"/>
                    <L7p:VariableToSet stringValue="countResultQuery"/>
                </L7p:SetVariable>
                <wsp:OneOrMore wsp:Usage="Required">
                    <wsp:All wsp:Usage="Required">
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${countResultQuery}"/>
                            <L7p:Operator operatorNull="null"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item dataType="included">
                                    <L7p:Type variableDataType="int"/>
                                </L7p:item>
                                <L7p:item binary="included">
                                    <L7p:RightValue stringValue="1"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="JHtqZGJjUXVlcnkuRE9DVU1FTlRfSUR9"/>
                            <L7p:VariableToSet stringValue="documentId"/>
                        </L7p:SetVariable>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="bWlncmF0ZWQgY2xpZW50LiBkb2N1bWVudElkID0gJHtkb2N1bWVudElkfQ=="/>
                            <L7p:VariableToSet stringValue="description"/>
                        </L7p:SetVariable>
                        <L7p:AuditDetailAssertion>
                            <L7p:CustomLoggerSuffix stringValue="entel.api.syslog"/>
                            <L7p:Detail stringValue="idOperation: ${idTransaction} ResourceId: ${msisdn} Message: ${description} Service: ${request.http.uri}"/>
                            <L7p:LoggingOnly booleanValue="true"/>
                        </L7p:AuditDetailAssertion>
                        <L7p:HardcodedResponse>
                            <L7p:Base64ResponseBody stringValue="ewoiY29kZSI6ICIwIiwKImRlc2NyaXB0aW9uIjogIm1pZ3JhdGVkIGNsaWVudCIsCiJkb2N1bWVudElkIjogIiR7ZG9jdW1lbnRJZH0iCn0="/>
                            <L7p:ResponseContentType stringValue="application/json; charset=UTF-8"/>
                        </L7p:HardcodedResponse>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue="count result query = 1"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <wsp:All wsp:Usage="Required">
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="Y2xpZW50IG5vdCBtaWdyYXRlZA=="/>
                            <L7p:VariableToSet stringValue="description"/>
                        </L7p:SetVariable>
                        <L7p:AuditDetailAssertion>
                            <L7p:CustomLoggerSuffix stringValue="entel.api.syslog"/>
                            <L7p:Detail stringValue="idOperation: ${idTransaction} ResourceId: ${msisdn} Message: ${description} Service: ${request.http.uri}"/>
                        </L7p:AuditDetailAssertion>
                        <L7p:HardcodedResponse>
                            <L7p:Base64ResponseBody stringValue="ewoiY29kZSI6ICIxIiwKImRlc2NyaXB0aW9uIjogImNsaWVudCBub3QgbWlncmF0ZWQiCn0="/>
                            <L7p:ResponseContentType stringValue="application/json; charset=UTF-8"/>
                        </L7p:HardcodedResponse>
                    </wsp:All>
                </wsp:OneOrMore>
            </wsp:All>
            <wsp:All wsp:Usage="Required">
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="Q2FuJ3QgY29ubmVjdCBkYXRhYmFzZQ=="/>
                    <L7p:VariableToSet stringValue="description"/>
                </L7p:SetVariable>
                <L7p:AuditDetailAssertion>
                    <L7p:CustomLoggerSuffix stringValue="entel.api.syslog"/>
                    <L7p:Detail stringValue="idOperation: ${idTransaction} ResourceId: ${msisdn} Message: ${description} Service: ${request.http.uri}"/>
                </L7p:AuditDetailAssertion>
                <L7p:CustomizeErrorResponse>
                    <L7p:Content stringValueReference="inline"><![CDATA[{
"error":"Can't connect database"
}]]></L7p:Content>
                    <L7p:ContentType stringValue="application/json; charset=UTF-8"/>
                    <L7p:ExtraHeaders nameValuePairArray="included"/>
                </L7p:CustomizeErrorResponse>
                <L7p:RaiseError/>
            </wsp:All>
        </wsp:OneOrMore>
    </wsp:All>
</wsp:Policy>