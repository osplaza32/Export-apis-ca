<?xml version="1.0" encoding="UTF-8"?>
<wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy">
    <wsp:All wsp:Usage="Required">
        <wsp:OneOrMore wsp:Usage="Required">
            <wsp:All wsp:Usage="Required">
                <L7p:Encapsulated>
                    <L7p:EncapsulatedAssertionConfigGuid stringValue="371f66e9-a471-4dfb-8e78-07c793ea10d3"/>
                    <L7p:EncapsulatedAssertionConfigName stringValue="Compose Bus Header"/>
                    <L7p:Parameters mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="format"/>
                            <L7p:value stringValue="XML"/>
                        </L7p:entry>
                        <L7p:entry>
                            <L7p:key stringValue="operationCode"/>
                            <L7p:value stringValue="SASS100310"/>
                        </L7p:entry>
                    </L7p:Parameters>
                </L7p:Encapsulated>
                <L7p:EvaluateJsonPathExpression>
                    <L7p:Expression stringValue=".MSISDN"/>
                    <L7p:VariablePrefix stringValue="MSISDN"/>
                </L7p:EvaluateJsonPathExpression>
                <L7p:EvaluateJsonPathExpression>
                    <L7p:Expression stringValue=".acumulatedAmount"/>
                    <L7p:VariablePrefix stringValue="acumulatedAmount"/>
                </L7p:EvaluateJsonPathExpression>
                <L7p:EvaluateJsonPathExpression>
                    <L7p:Expression stringValue=".currency"/>
                    <L7p:VariablePrefix stringValue="currency"/>
                </L7p:EvaluateJsonPathExpression>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="PHNvYXBlbnY6RW52ZWxvcGUgeG1sbnM6c29hcGVudj0iaHR0cDovL3NjaGVtYXMueG1sc29hcC5vcmcvc29hcC9lbnZlbG9wZS8iIHhtbG5zOnYxPSJodHRwOi8vd3d3LmVudGVsLmNsL0VCTS9VcGRhdGVDcmVkaXRVc2VkL3YxIiB4bWxuczp2MTE9Imh0dHA6Ly93d3cuZW50ZWwuY2wvRVNPL01lc3NhZ2VIZWFkZXIvdjEiIHhtbG5zOnYyPSJodHRwOi8vd3d3LmVudGVsLmNsL0VTTy9SZXN1bHQvdjIiIHhtbG5zOnYxMj0iaHR0cDovL3d3dy5lbnRlbC5jbC9FU08vRXJyb3IvdjEiPg0KICAgPHNvYXBlbnY6SGVhZGVyLz4NCiAgIDxzb2FwZW52OkJvZHk+DQogICAgICA8djE6VXBkYXRlQ3JlZGl0VXNlZF9SRVE+DQogICAgICAgICAgICAke2hlYWRlcn0NCiAgICAgICAgIDx2MTpCb2R5Pg0KICAgICAgICAgICAgPCEtLU9wdGlvbmFsOi0tPg0KICAgICAgICAgICAgPHYxOkNyZWRpdD4NCiAgICAgICAgICAgICAgIDwhLS1PcHRpb25hbDotLT4NCiAgICAgICAgICAgICAgIDx2MTpVcGRhdGU+DQogICAgICAgICAgICAgICAgICA8IS0tT3B0aW9uYWw6LS0+DQogICAgICAgICAgICAgICAgICA8djE6TVNJU0ROPiR7TVNJU0ROLnJlc3VsdH08L3YxOk1TSVNETj4NCiAgICAgICAgICAgICAgICAgIDwhLS1PcHRpb25hbDotLT4NCiAgICAgICAgICAgICAgICAgIDx2MTphY3VtdWxhdGVkQW1vdW50PiR7YWN1bXVsYXRlZEFtb3VudC5yZXN1bHR9PC92MTphY3VtdWxhdGVkQW1vdW50Pg0KICAgICAgICAgICAgICAgICAgPCEtLU9wdGlvbmFsOi0tPg0KICAgICAgICAgICAgICAgICAgPHYxOmN1cnJlbmN5PiR7Y3VycmVuY3kucmVzdWx0fTwvdjE6Y3VycmVuY3k+DQogICAgICAgICAgICAgICA8L3YxOlVwZGF0ZT4NCiAgICAgICAgICAgIDwvdjE6Q3JlZGl0Pg0KICAgICAgICAgPC92MTpCb2R5Pg0KICAgICAgPC92MTpVcGRhdGVDcmVkaXRVc2VkX1JFUT4NCiAgIDwvc29hcGVudjpCb2R5Pg0KPC9zb2FwZW52OkVudmVsb3BlPg=="/>
                    <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                    <L7p:DataType variableDataType="message"/>
                    <L7p:VariableToSet stringValue="message"/>
                </L7p:SetVariable>
                <L7p:HttpRoutingAssertion>
                    <L7p:FailOnErrorStatus booleanValue="false"/>
                    <L7p:ProtectedServiceUrl stringValue="http://${gateway.eUSB.tde.hostname}/ES/UpdateCreditUsed/v1"/>
                    <L7p:ProxyPassword stringValueNull="null"/>
                    <L7p:ProxyUsername stringValueNull="null"/>
                    <L7p:RequestHeaderRules httpPassthroughRuleSet="included">
                        <L7p:ForwardAll booleanValue="true"/>
                        <L7p:Rules httpPassthroughRules="included">
                            <L7p:item httpPassthroughRule="included">
                                <L7p:Name stringValue="Cookie"/>
                            </L7p:item>
                            <L7p:item httpPassthroughRule="included">
                                <L7p:Name stringValue="SOAPAction"/>
                            </L7p:item>
                        </L7p:Rules>
                    </L7p:RequestHeaderRules>
                    <L7p:RequestMsgSrc stringValue="message"/>
                    <L7p:RequestParamRules httpPassthroughRuleSet="included">
                        <L7p:ForwardAll booleanValue="true"/>
                        <L7p:Rules httpPassthroughRules="included"/>
                    </L7p:RequestParamRules>
                    <L7p:ResponseHeaderRules httpPassthroughRuleSet="included">
                        <L7p:ForwardAll booleanValue="true"/>
                        <L7p:Rules httpPassthroughRules="included">
                            <L7p:item httpPassthroughRule="included">
                                <L7p:Name stringValue="Set-Cookie"/>
                            </L7p:item>
                        </L7p:Rules>
                    </L7p:ResponseHeaderRules>
                    <L7p:SamlAssertionVersion intValue="2"/>
                </L7p:HttpRoutingAssertion>
                <L7p:ComparisonAssertion>
                    <L7p:CaseSensitive booleanValue="false"/>
                    <L7p:Expression1 stringValue="${httpRouting.reasonCode}"/>
                    <L7p:Operator operatorNull="null"/>
                    <L7p:Predicates predicates="included">
                        <L7p:item dataType="included">
                            <L7p:Type variableDataType="int"/>
                        </L7p:item>
                        <L7p:item binary="included">
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:RightValue stringValue="200"/>
                        </L7p:item>
                    </L7p:Predicates>
                </L7p:ComparisonAssertion>
                <L7p:ResponseXpathAssertion>
                    <L7p:VariablePrefix stringValue="code"/>
                    <L7p:XpathExpression xpathExpressionValue="included">
                        <L7p:Expression stringValue="/soapenv:Envelope/soapenv:Body/v1:UpdateCreditUsed_RSP/v1:Body/v1:Result/v1:codError"/>
                        <L7p:Namespaces mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="s"/>
                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="soapenv"/>
                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="v1"/>
                                <L7p:value stringValue="http://www.entel.cl/EBM/UpdateCreditUsed/v1"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="v2"/>
                                <L7p:value stringValue="http://www.entel.cl/ESO/Result/v2"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="v12"/>
                                <L7p:value stringValue="http://www.entel.cl/ESO/Error/v1"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="v11"/>
                                <L7p:value stringValue="http://www.entel.cl/ESO/MessageHeader/v1"/>
                            </L7p:entry>
                        </L7p:Namespaces>
                        <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
                    </L7p:XpathExpression>
                </L7p:ResponseXpathAssertion>
                <L7p:ResponseXpathAssertion>
                    <L7p:VariablePrefix stringValue="description"/>
                    <L7p:XpathExpression xpathExpressionValue="included">
                        <L7p:Expression stringValue="/s:Envelope/s:Body/v1:UpdateCreditUsed_RSP/v1:Body/v1:Result/v1:descError"/>
                        <L7p:Namespaces mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="s"/>
                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="v1"/>
                                <L7p:value stringValue="http://www.entel.cl/EBM/UpdateCreditUsed/v1"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="v2"/>
                                <L7p:value stringValue="http://www.entel.cl/ESO/Result/v2"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="v12"/>
                                <L7p:value stringValue="http://www.entel.cl/ESO/Error/v1"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="v11"/>
                                <L7p:value stringValue="http://www.entel.cl/ESO/MessageHeader/v1"/>
                            </L7p:entry>
                        </L7p:Namespaces>
                        <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
                    </L7p:XpathExpression>
                </L7p:ResponseXpathAssertion>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="JHtyZXF1ZXN0LnRpbWUubG9jYWwueXl5eS9NTS9kZCdUJ0hIOm1tOnNzLlNTU30="/>
                    <L7p:VariableToSet stringValue="responseTimestamp"/>
                </L7p:SetVariable>
                <L7p:Encapsulated>
                    <L7p:EncapsulatedAssertionConfigGuid stringValue="2873d7c1-bfb2-42b8-ab9a-35767965de80"/>
                    <L7p:EncapsulatedAssertionConfigName stringValue="API Portal Integration - Post Route"/>
                    <L7p:Parameters mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="portal.analytics.response.code"/>
                            <L7p:value stringValue="200"/>
                        </L7p:entry>
                        <L7p:entry>
                            <L7p:key stringValue="portal.analytics.routingTotalTime"/>
                            <L7p:value stringValue="${request.routingTotalTime}"/>
                        </L7p:entry>
                    </L7p:Parameters>
                </L7p:Encapsulated>
                <L7p:HardcodedResponse>
                    <L7p:Base64ResponseBody stringValue="ewoicmVzdWx0Ijp7CgkidHJhbnNhY3Rpb25JZCI6IiR7cmVxdWVzdElkfSIsCgkiY29kZSI6IiR7Y29kZS5yZXN1bHR9IiwKCSJkZXNjcmlwdGlvbiI6Ik9LIiwKCSJkZXNjcmlwdGlvbkRldGFpbCI6ICIke3N0YXR1cy5yZXN1bHR9OiAke2Rlc2NyaXB0aW9uLnJlc3VsdH0iLAoJInJlc3BvbnNlVGltZXN0YW1wIjoiJHtyZXNwb25zZVRpbWVzdGFtcH0iCgl9Cn0KCg=="/>
                    <L7p:ResponseContentType stringValue="application/json; charset=UTF-8"/>
                </L7p:HardcodedResponse>
            </wsp:All>
            <wsp:All wsp:Usage="Required">
                <L7p:ComparisonAssertion>
                    <L7p:CaseSensitive booleanValue="false"/>
                    <L7p:Expression1 stringValue="${httpRouting.reasonCode}"/>
                    <L7p:Operator operatorNull="null"/>
                    <L7p:Predicates predicates="included">
                        <L7p:item dataType="included">
                            <L7p:Type variableDataType="int"/>
                        </L7p:item>
                        <L7p:item binary="included">
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:RightValue stringValue="(400|422|429)"/>
                        </L7p:item>
                    </L7p:Predicates>
                </L7p:ComparisonAssertion>
                <L7p:ResponseXpathAssertion>
                    <L7p:VariablePrefix stringValue="code"/>
                    <L7p:XpathExpression xpathExpressionValue="included">
                        <L7p:Expression stringValue="/soap:Envelope/soap:Body/env:Fault/env:Detail/ns22:UnexpectedErrorException/v20:Result/ns3:SourceError/ns3:SourceFault/ns:fault/ns:errorCode"/>
                        <L7p:Namespaces mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="ns"/>
                                <L7p:value stringValue="http://www.bea.com/wli/sb/context"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="env"/>
                                <L7p:value stringValue="http://www.w3.org/2003/05/soap-envelope"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="ns2"/>
                                <L7p:value stringValue="http://www.entel.cl/ESO/Tracer/v1"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="ns4"/>
                                <L7p:value stringValue="http://www.entel.cl/ESO/Error/v1"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="ns3"/>
                                <L7p:value stringValue="http://www.entel.cl/ESO/Error/v1"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="s"/>
                                <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="ns12"/>
                                <L7p:value stringValue="http://www.entel.cl/SC/ErrorManager/handle/v2"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="v20"/>
                                <L7p:value stringValue="http://www.entel.cl/ESO/Result/v2"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="v12"/>
                                <L7p:value stringValue="http://www.entel.cl/ESO/Error/v1"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="ns22"/>
                                <L7p:value stringValue="http://www.entel.cl/ESO/Exception/v1"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="v11"/>
                                <L7p:value stringValue="http://www.entel.cl/ESO/MessageHeader/v1"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="v1"/>
                                <L7p:value stringValue="http://www.entel.cl/EBM/UpdateCreditUsed/v1"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="v2"/>
                                <L7p:value stringValue="http://www.entel.cl/ESO/Result/v2"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="soap"/>
                                <L7p:value stringValue="http://www.w3.org/2003/05/soap-envelope"/>
                            </L7p:entry>
                        </L7p:Namespaces>
                        <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
                    </L7p:XpathExpression>
                </L7p:ResponseXpathAssertion>
                <L7p:ResponseXpathAssertion>
                    <L7p:VariablePrefix stringValue="description"/>
                    <L7p:XpathExpression xpathExpressionValue="included">
                        <L7p:Expression stringValue="/s:Envelope/s:Body/s:Fault/s:Detail/ns22:UnexpectedErrorException/v2:Result/v12:SourceError/v12:SourceFault/ns:fault/ns:reason"/>
                        <L7p:Namespaces mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="s"/>
                                <L7p:value stringValue="http://www.w3.org/2003/05/soap-envelope"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="v2"/>
                                <L7p:value stringValue="http://www.entel.cl/ESO/Result/v2"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="ns"/>
                                <L7p:value stringValue="http://www.bea.com/wli/sb/context"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="ns22"/>
                                <L7p:value stringValue="http://www.entel.cl/ESO/Exception/v1"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="v12"/>
                                <L7p:value stringValue="http://www.entel.cl/ESO/Error/v1"/>
                            </L7p:entry>
                        </L7p:Namespaces>
                        <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
                    </L7p:XpathExpression>
                </L7p:ResponseXpathAssertion>
                <L7p:ComparisonAssertion>
                    <L7p:CaseSensitive booleanValue="false"/>
                    <L7p:Expression1 stringValue="${status.result}"/>
                    <L7p:Operator operatorNull="null"/>
                    <L7p:Predicates predicates="included">
                        <L7p:item dataType="included">
                            <L7p:Type variableDataType="string"/>
                        </L7p:item>
                        <L7p:item binary="included">
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:RightValue stringValue="ERROR"/>
                        </L7p:item>
                    </L7p:Predicates>
                </L7p:ComparisonAssertion>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="JHtyZXF1ZXN0LnRpbWUubG9jYWwueXl5eS9NTS9kZCdUJ0hIOm1tOnNzLlNTU30="/>
                    <L7p:VariableToSet stringValue="responseTimestamp"/>
                </L7p:SetVariable>
                <L7p:Encapsulated>
                    <L7p:EncapsulatedAssertionConfigGuid stringValue="2873d7c1-bfb2-42b8-ab9a-35767965de80"/>
                    <L7p:EncapsulatedAssertionConfigName stringValue="API Portal Integration - Post Route"/>
                    <L7p:Parameters mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="portal.analytics.response.code"/>
                            <L7p:value stringValue="200"/>
                        </L7p:entry>
                        <L7p:entry>
                            <L7p:key stringValue="portal.analytics.routingTotalTime"/>
                            <L7p:value stringValue="${request.routingTotalTime}"/>
                        </L7p:entry>
                    </L7p:Parameters>
                </L7p:Encapsulated>
                <L7p:CustomizeErrorResponse>
                    <L7p:Content stringValueReference="inline"><![CDATA[{
"result":{
	"transactionId":"${requestId}",
	"code":"${httpRouting.reasonCode}",
	"description":"Entidad no procesada",
	"descriptionDetail":"${code.result}: ${description.result}",
	"responseTimestamp":"${responseTimestamp}"
	}
}]]></L7p:Content>
                    <L7p:ContentType stringValue="application/json; charset=UTF-8"/>
                    <L7p:ExtraHeaders nameValuePairArray="included"/>
                    <L7p:HttpStatus stringValue="${httpRouting.reasonCode}"/>
                </L7p:CustomizeErrorResponse>
                <L7p:RaiseError/>
                <L7p:assertionComment>
                    <L7p:Properties mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="RIGHT.COMMENT"/>
                            <L7p:value stringValue="//Controla errores de Negocio"/>
                        </L7p:entry>
                    </L7p:Properties>
                </L7p:assertionComment>
            </wsp:All>
            <L7p:Include>
                <L7p:PolicyGuid stringValue="1b3f18a3-5e88-4cae-9fae-44b459727ac1"/>
            </L7p:Include>
            <L7p:assertionComment>
                <L7p:Properties mapValue="included">
                    <L7p:entry>
                        <L7p:key stringValue="RIGHT.COMMENT"/>
                        <L7p:value stringValue="//Logica"/>
                    </L7p:entry>
                </L7p:Properties>
            </L7p:assertionComment>
        </wsp:OneOrMore>
    </wsp:All>
</wsp:Policy>