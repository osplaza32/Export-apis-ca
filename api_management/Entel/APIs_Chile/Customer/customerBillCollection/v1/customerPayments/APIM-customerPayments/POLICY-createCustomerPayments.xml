<?xml version="1.0" encoding="UTF-8"?>
<wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy">
    <wsp:All wsp:Usage="Required">
        <wsp:OneOrMore wsp:Usage="Required">
            <wsp:All wsp:Usage="Required">
                <L7p:JSONSchema>
                    <L7p:ResourceInfo staticResourceInfo="included">
                        <L7p:Document stringValueReference="inline"><![CDATA[{
  "definitions": {},
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "http://example.com/root.json",
  "type": "object",
  "title": "The Root Schema",
  "required": [
    "oc",
    "msisdn",
    "mercadoOnePay",
    "commerceCodeOnePay",
    "environmentPortal",
    "monto",
    "url",
    "canal",
    "listaItems"
  ],
  "properties": {
    "oc": {
      "$id": "#/properties/oc",
      "type": "string",
      "title": "The Oc Schema",
      "default": "",
      "examples": [
        ""
      ],
      "pattern": "^(.*)$"
    },
    "msisdn": {
      "$id": "#/properties/msisdn",
      "type": "string",
      "title": "The Msisdn Schema",
      "default": "",
      "examples": [
        ""
      ],
      "pattern": "^(.*)$"
    },
    "mercadoOnePay": {
      "$id": "#/properties/mercadoOnePay",
      "type": "string",
      "title": "The Mercadoonepay Schema",
      "default": "",
      "examples": [
        ""
      ],
      "pattern": "^(.*)$"
    },
    "commerceCodeOnePay": {
      "$id": "#/properties/commerceCodeOnePay",
      "type": "string",
      "title": "The Commercecodeonepay Schema",
      "default": "",
      "examples": [
        ""
      ],
      "pattern": "^(.*)$"
    },
    "environmentPortal": {
      "$id": "#/properties/environmentPortal",
      "type": "string",
      "title": "The Environmentportal Schema",
      "default": "",
      "examples": [
        ""
      ],
      "pattern": "^(.*)$"
    },
    "monto": {
      "$id": "#/properties/monto",
      "type": "integer",
      "title": "The Monto Schema",
      "default": 0,
      "examples": [
        0
      ]
    },
    "url": {
      "$id": "#/properties/url",
      "type": "string",
      "title": "The Url Schema",
      "default": "",
      "examples": [
        ""
      ],
      "pattern": "^(.*)$"
    },
    "canal": {
      "$id": "#/properties/canal",
      "type": "string",
      "title": "The Canal Schema",
      "default": "",
      "examples": [
        ""
      ],
      "pattern": "^(.*)$"
    },
    "listaItems": {
      "$id": "#/properties/listaItems",
      "type": "array",
      "title": "The Listaitems Schema",
      "items": {
        "$id": "#/properties/listaItems/items",
        "type": "object",
        "title": "The Items Schema",
        "required": [
          "producto",
          "monto",
          "cantidad",
          "codigo",
          "vigencia"
        ],
        "properties": {
          "producto": {
            "$id": "#/properties/listaItems/items/properties/producto",
            "type": "string",
            "title": "The Producto Schema",
            "default": "",
            "examples": [
              ""
            ],
            "pattern": "^(.*)$"
          },
          "monto": {
            "$id": "#/properties/listaItems/items/properties/monto",
            "type": "integer",
            "title": "The Monto Schema",
            "default": 0,
            "examples": [
              0
            ]
          },
          "cantidad": {
            "$id": "#/properties/listaItems/items/properties/cantidad",
            "type": "integer",
            "title": "The Cantidad Schema",
            "default": 0,
            "examples": [
              0
            ]
          },
          "codigo": {
            "$id": "#/properties/listaItems/items/properties/codigo",
            "type": "string",
            "title": "The Codigo Schema",
            "default": "",
            "examples": [
              ""
            ],
            "pattern": "^(.*)$"
          },
          "vigencia": {
            "$id": "#/properties/listaItems/items/properties/vigencia",
            "type": "string",
            "title": "The Vigencia Schema",
            "default": "",
            "examples": [
              ""
            ],
            "pattern": "^(.*)$"
          }
        }
      }
    }
  }
}]]></L7p:Document>
                    </L7p:ResourceInfo>
                </L7p:JSONSchema>
            </wsp:All>
            <wsp:All wsp:Usage="Required">
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="NDAw"/>
                    <L7p:VariableToSet stringValue="code"/>
                </L7p:SetVariable>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="U29saWNpdHVkIGluY29ycmVjdGE="/>
                    <L7p:VariableToSet stringValue="description"/>
                </L7p:SetVariable>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="RXN0cnVjdHVyYSBkZSBKU09OIGludsOhbGlkYQ=="/>
                    <L7p:VariableToSet stringValue="descriptionDetail"/>
                </L7p:SetVariable>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="JHtyZXF1ZXN0LnRpbWUubG9jYWwueXl5eS9NTS9kZCdUJ0hIOm1tOnNzLlNTU30="/>
                    <L7p:VariableToSet stringValue="responseTimestamp"/>
                </L7p:SetVariable>
                <L7p:AuditDetailAssertion>
                    <L7p:CustomLoggerSuffix stringValue="entel.api.syslog"/>
                    <L7p:Detail stringValue="TRANSACTION: ${requestId} CODE: ${code} DESCRIPTION: ${description} DETAIL: ${descriptionDetail}"/>
                    <L7p:LoggingOnly booleanValue="true"/>
                </L7p:AuditDetailAssertion>
                <L7p:CustomizeErrorResponse>
                    <L7p:Content stringValueReference="inline"><![CDATA[{
"result":{
	"transactionId":"${requestId}",
	"code":"${code}",
	"description":"${description}",
	"descriptionDetail":"${descriptionDetail}",
	"responseTimestamp":"${responseTimestamp}"
	}
}]]></L7p:Content>
                    <L7p:ContentType stringValue="application/json; charset=UTF-8"/>
                    <L7p:ExtraHeaders nameValuePairArray="included"/>
                    <L7p:HttpStatus stringValue="400"/>
                </L7p:CustomizeErrorResponse>
                <L7p:RaiseError/>
            </wsp:All>
        </wsp:OneOrMore>
        <wsp:OneOrMore wsp:Usage="Required">
            <wsp:All wsp:Usage="Required">
                <L7p:HttpRoutingAssertion>
                    <L7p:FailOnErrorStatus booleanValue="false"/>
                    <L7p:HttpMethod httpMethod="POST"/>
                    <L7p:ProtectedServiceUrl stringValue="${gateway.integradorpagos.hostname}/integrador/onepay/occ_solicitar"/>
                    <L7p:ProxyHost stringValue="10.49.10.9"/>
                    <L7p:ProxyPort stringValue="8080"/>
                    <L7p:RequestHeaderRules httpPassthroughRuleSet="included">
                        <L7p:ForwardAll booleanValue="true"/>
                        <L7p:Rules httpPassthroughRules="included"/>
                    </L7p:RequestHeaderRules>
                    <L7p:RequestParamRules httpPassthroughRuleSet="included">
                        <L7p:ForwardAll booleanValue="true"/>
                        <L7p:Rules httpPassthroughRules="included"/>
                    </L7p:RequestParamRules>
                    <L7p:ResponseHeaderRules httpPassthroughRuleSet="included">
                        <L7p:Rules httpPassthroughRules="included"/>
                    </L7p:ResponseHeaderRules>
                    <L7p:ResponseMsgDest stringValue="serviceResponse"/>
                    <L7p:SamlAssertionVersion intValue="2"/>
                </L7p:HttpRoutingAssertion>
                <L7p:ComparisonAssertion>
                    <L7p:CaseSensitive booleanValue="false"/>
                    <L7p:Expression1 stringValue="${httpRouting.reasonCode}"/>
                    <L7p:Expression2 stringValue="200"/>
                    <L7p:Predicates predicates="included">
                        <L7p:item binary="included">
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:RightValue stringValue="200"/>
                        </L7p:item>
                    </L7p:Predicates>
                </L7p:ComparisonAssertion>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="ew0KICAgICJvY2MiOiAiMTgxMDIxNDQ0OTIzNTExMCIsDQogICAgIm90dCI6IDc5Mjc2NDk5LA0KICAgICJleHRlcm5hbFVuaXF1ZU51bWJlciI6ICIxNTM4NDQ0ODk5MTkxIiwNCiAgICAicXJDb2RlQXNCYXNlNjQiOiAiaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQU1nQUFBRElDQVlBQUFDdFdLNmVBQUFEcFVsRVFWUjQydTNkUzI3RE1CQkVRZDcvMHZZSnNnZ3NhcnJKZWtCMmhxRVBLNHVCSmE2UHBEOWJMb0VFaUFTSUJJZ0VpQVNJQklnRWlBU0lCSWdrUUNSQUpFQWtRQ1JBSkVBa1FDUkFKRUFrUUNRQklnRWlBU0lCSXQwQ1pLMVY4ZmZmNDkvOSthZU8vN2I3QlFnZ2dBQUNDQ0NBQUFJSUlJQUFBZ2dnZ0FEeTdBVWZHOTA5ZER3dFlOMHZRQUFCQkJCQUFBRUVFRUFBQVFRUVFBQUJCSkFkSjlneXR0MDlsa3diODdiY0wwQUFBUVFRUUFBQkJCQkFBQUVFRUVBQUFRUVFRTjQ4bnJUdkFRUVFRQUFCQkJCQUFBRUVFRUFBQVFRUVFBQUJwQkhJN3JGdDJuRUNBZ2dnZ0FBQ0NDQ0FBQUlJSUlBQUFnZ2dnQUR5Wm1rdlhtdFo4S2ZlTDBBQUFRUVFRQUFCQkJCQUFBRUVFRUFBQVFTUVo4ZUF0MjEva1BaNTJ4OEFBZ2dnZ0Zqd2dBQUNDQ0NBQUFJSUlJQUFjamFRMjJyNU1hUUFBUVFRUUFBQkJCQkFBQUVFRUVBQUFRUVFRSDY1Y1ZQYkN1eitmTnA0ODdaSGlRRUJCQkJBQUFFRUVFQUFBUVFRUUFBQkJCQkFac2VoN1krSXRtL1dhY3dMQ0NDQVdFaUFBQUtJOHdJRUVFQUFBUVFRUUFCNWN5dzVOZDVNRzJ2dnZnNkFBQUlJSUlBQUFnZ2dnQUFDQ0NDQUFBSUlJSmxBYm52aDI5VENhQmwzKzdFaUlJQUFBZ2dnZ0FBQ0NDQ0FBQUlJSUlBQWNqYVF0SVdVQm5uMzhVeDl2ekV2SUlBQUFnZ2dnQUFDQ0NDQUFBSUlJSUFBa3JuOVFjc0w0dEpBdGJ3SXJna09JSUFBQWdnZ2dBQUNDQ0NBQUFJSUlJQUFBc2pudWpGdnl5UEd0LzNJRXhCQUFBRUVFRUFBQVFRUVFBQUJCQkJBQUFGa2RueDZLdnkwUjNyYnp3c1FRSndYSUlBNEwwQUFBUVFRUUFBQkJCQkFBSm1GZHVyMkJPM1h3WXZqQUFFRUVFQUFBUVFRUUFBQkJCQkFBQUVFa0xPQm5EcTIzWDA4YVdOMlFBQUJCQkJBQUFGRWdBQWlRQUFCQkJCQU1vRk1qUm5iWDNUV3ZwbHArejhpUUFBQkJCQkFBQUVFRUVBQUFRUVFRQUFCQkpETVIyTFR4c0pwTDZCTCswY0JDQ0NBQUFJSUlJQUFBZ2dnZ0FBQ0NDQ0FBREs3SUZ1MkZXZ1plN2FQMHljREJCQkFBQUVFRUVBQUFRUVFRQUFCQkJCQUFPa0JjdHZDT1BVRmZZQUFBZ2dnZ0FBQ0NDQ0FBQUlJSUlBQUFnZ2dnQ1M4T0s1bHdVK04zd0VCQkJCQUFBRUVFRUFBQVFRUVFBQUJCQkJBbnIyaDdRdXNaUnphQWh3UVFBQUJCQkJBQUFFRUVFQUFBUVFRUUFBQnhQWUhDVUJPSGY5T2pmRUJBUVFRUUFBQkJCQkFBQUVFRUVBQUFRUVFRS1M3QWtRQ1JBSkVBa1FDUkFKRUFrUUNSQUpFQWtRU0lCSWdFaUFTSUJJZ0VpQVNJQklnRWlBU0lKSUFrUUNSQUpFQWtSTDZBbHpUNFBnWGwwcWxBQUFBQUVsRlRrU3VRbUNDIiwNCiAgICAiaXNzdWVkQXQiOiAxNTM4NTc2MTM4LA0KICAgICJhbW91bnQiOiA1MDANCn0="/>
                    <L7p:ContentType stringValue="application/json; charset=utf-8"/>
                    <L7p:DataType variableDataType="message"/>
                    <L7p:Enabled booleanValue="false"/>
                    <L7p:VariableToSet stringValue="serviceResponse"/>
                </L7p:SetVariable>
                <wsp:OneOrMore wsp:Usage="Required">
                    <wsp:All wsp:Usage="Required">
                        <L7p:EvaluateJsonPathExpression>
                            <L7p:Expression stringValue=".occ"/>
                            <L7p:OtherTargetMessageVariable stringValue="serviceResponse"/>
                            <L7p:Target target="OTHER"/>
                        </L7p:EvaluateJsonPathExpression>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="MjAw"/>
                            <L7p:VariableToSet stringValue="code"/>
                        </L7p:SetVariable>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="T3BlcmFjacOzbiBleGl0b3Nh"/>
                            <L7p:VariableToSet stringValue="description"/>
                        </L7p:SetVariable>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="JHtyZXF1ZXN0LnRpbWUubG9jYWwueXl5eS9NTS9kZCdUJ0hIOm1tOnNzLlNTU30="/>
                            <L7p:VariableToSet stringValue="responseTimestamp"/>
                        </L7p:SetVariable>
                        <L7p:Regex>
                            <L7p:AutoTarget booleanValue="false"/>
                            <L7p:OtherTargetMessageVariable stringValue="serviceResponse"/>
                            <L7p:Regex stringValue="^(.)|}$"/>
                            <L7p:Replace booleanValue="true"/>
                            <L7p:Replacement stringValue=""/>
                            <L7p:Target target="OTHER"/>
                        </L7p:Regex>
                        <L7p:Encapsulated>
                            <L7p:EncapsulatedAssertionConfigGuid stringValue="2873d7c1-bfb2-42b8-ab9a-35767965de80"/>
                            <L7p:EncapsulatedAssertionConfigName stringValue="API Portal Integration - Post Route"/>
                            <L7p:Parameters mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="portal.analytics.response.code"/>
                                    <L7p:value stringValue="200"/>
                                </L7p:entry>
                                <L7p:entry>
                                    <L7p:key stringValue="portal.analytics.routingTotalTime"/>
                                    <L7p:value stringValue="${request.routingTotalTime}"/>
                                </L7p:entry>
                            </L7p:Parameters>
                        </L7p:Encapsulated>
                        <L7p:HardcodedResponse>
                            <L7p:Base64ResponseBody stringValue="ewoicmVzdWx0Ijp7CgkidHJhbnNhY3Rpb25JZCI6IiR7cmVxdWVzdElkfSIsCgkiY29kZSI6IiR7Y29kZX0iLAoJImRlc2NyaXB0aW9uIjoiJHtkZXNjcmlwdGlvbn0iLAoJInJlc3BvbnNlVGltZXN0YW1wIjoiJHtyZXNwb25zZVRpbWVzdGFtcH0iCgl9LAoke3NlcnZpY2VSZXNwb25zZS5tYWlucGFydH0KfQ=="/>
                            <L7p:ResponseContentType stringValue="application/json; charset=UTF-8"/>
                        </L7p:HardcodedResponse>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="operacion exitosa"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <wsp:All wsp:Usage="Required">
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="NDIy"/>
                            <L7p:VariableToSet stringValue="code"/>
                        </L7p:SetVariable>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="RW50aWRhZCBubyBwcm9jZXNhZGEu"/>
                            <L7p:VariableToSet stringValue="description"/>
                        </L7p:SetVariable>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="U2UgaGEgcHJvZHVjaWRvIHVuIGVycm9yIGVuIGVsIHByb2Nlc2FtaWVudG8gZGUgbGEgc29saWNpdHVk"/>
                            <L7p:VariableToSet stringValue="descriptionDetail"/>
                        </L7p:SetVariable>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="JHtyZXF1ZXN0LnRpbWUubG9jYWwueXl5eS9NTS9kZCdUJ0hIOm1tOnNzLlNTU30="/>
                            <L7p:VariableToSet stringValue="responseTimestamp"/>
                        </L7p:SetVariable>
                        <L7p:AuditDetailAssertion>
                            <L7p:CustomLoggerSuffix stringValue="entel.api.syslog"/>
                            <L7p:Detail stringValue="IDTRANSACTION: ${requestId} SERVICE: ${httpRouting.url} LATENCY: ${httpRouting.latency} HTTP STATUS: ${httpRouting.reasonCode} DESCRIPTION: ${description} DESCRIPTION: ${descriptionDetail} CODE: ${code} BODY: ${serviceResponse.mainpart} REQUEST:${request.maintpart} "/>
                            <L7p:LoggingOnly booleanValue="true"/>
                        </L7p:AuditDetailAssertion>
                        <L7p:CustomizeErrorResponse>
                            <L7p:Content stringValueReference="inline"><![CDATA[{
"result":{
	"transactionId":"${requestId}",
	"code":"${code}",
	"description":"${description}",
	"descriptionDetail":"${descriptionDetail}",
	"responseTimestamp":"${responseTimestamp}"
	}
}]]></L7p:Content>
                            <L7p:ContentType stringValue="application/json; charset=UTF-8"/>
                            <L7p:ExtraHeaders nameValuePairArray="included"/>
                            <L7p:HttpStatus stringValue="422"/>
                        </L7p:CustomizeErrorResponse>
                        <L7p:RaiseError/>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="error de negocio"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                </wsp:OneOrMore>
                <L7p:assertionComment>
                    <L7p:Properties mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="LEFT.COMMENT"/>
                            <L7p:value stringValue="OK"/>
                        </L7p:entry>
                        <L7p:entry>
                            <L7p:key stringValue="RIGHT.COMMENT"/>
                            <L7p:value stringValue="Código 200."/>
                        </L7p:entry>
                    </L7p:Properties>
                </L7p:assertionComment>
            </wsp:All>
            <wsp:All wsp:Usage="Required">
                <L7p:Encapsulated>
                    <L7p:EncapsulatedAssertionConfigGuid stringValue="14295f18-da19-4f0e-9643-a8c30b3544dc"/>
                    <L7p:EncapsulatedAssertionConfigName stringValue="CodeStatus"/>
                </L7p:Encapsulated>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="JHtodHRwUm91dGluZy5yZWFzb25Db2RlfQ=="/>
                    <L7p:VariableToSet stringValue="code"/>
                </L7p:SetVariable>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="JHtjb2RlRGVzY3JpcHRpb259"/>
                    <L7p:VariableToSet stringValue="description"/>
                </L7p:SetVariable>
                <L7p:EvaluateJsonPathExpression>
                    <L7p:Expression stringValue=".message"/>
                    <L7p:OtherTargetMessageVariable stringValue="serviceResponse"/>
                    <L7p:Target target="OTHER"/>
                </L7p:EvaluateJsonPathExpression>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="JHtqc29uUGF0aC5yZXN1bHR9"/>
                    <L7p:VariableToSet stringValue="descriptionDetail"/>
                </L7p:SetVariable>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="JHtyZXF1ZXN0LnRpbWUubG9jYWwueXl5eS1NTS1kZCdUJ0hIOm1tOnNzLlNTU30="/>
                    <L7p:VariableToSet stringValue="responseTimestamp"/>
                </L7p:SetVariable>
                <L7p:CustomizeErrorResponse>
                    <L7p:Content stringValueReference="inline"><![CDATA[{
"result":{
	"transactionId":"${requestId}",
	"code":"${code}",
	"description":"${description}",
	"descriptionDetail":"${descriptionDetail}",
	"responseTimestamp":"${responseTimestamp}"
	}
}]]></L7p:Content>
                    <L7p:ContentType stringValue="application/json; charset=UTF-8"/>
                    <L7p:ExtraHeaders nameValuePairArray="included"/>
                </L7p:CustomizeErrorResponse>
                <L7p:RaiseError/>
            </wsp:All>
            <L7p:Include>
                <L7p:PolicyGuid stringValue="1b3f18a3-5e88-4cae-9fae-44b459727ac1"/>
            </L7p:Include>
        </wsp:OneOrMore>
    </wsp:All>
</wsp:Policy>