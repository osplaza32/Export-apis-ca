<?xml version="1.0" encoding="UTF-8"?>
<wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy">
    <wsp:All wsp:Usage="Required">
        <wsp:OneOrMore wsp:Usage="Required">
            <wsp:All wsp:Usage="Required">
                <L7p:ComparisonAssertion>
                    <L7p:CaseSensitive booleanValue="false"/>
                    <L7p:Expression1 stringValue="${request.http.parameter.platform}"/>
                    <L7p:Expression2 stringValue="netflix"/>
                    <L7p:Predicates predicates="included">
                        <L7p:item binary="included">
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:RightValue stringValue="netflix"/>
                        </L7p:item>
                    </L7p:Predicates>
                </L7p:ComparisonAssertion>
                <wsp:OneOrMore wsp:Usage="Required">
                    <wsp:All wsp:Usage="Required">
                        <L7p:JSONSchema>
                            <L7p:ResourceInfo staticResourceInfo="included">
                                <L7p:Document stringValueReference="inline"><![CDATA[{
  "definitions": {},
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "http://example.com/root.json",
  "type": "object",
  "title": "The Root Schema",
  "required": [
    "msisdn"
  ],
  "properties": {
    "msisdn": {
      "$id": "#/properties/msisdn",
      "type": "string",
      "title": "The Msisdn Schema",
      "default": "",
      "examples": [
        "123213"
      ]
    }
  }
}]]></L7p:Document>
                            </L7p:ResourceInfo>
                        </L7p:JSONSchema>
                    </wsp:All>
                    <wsp:All wsp:Usage="Required">
                        <L7p:CustomizeErrorResponse>
                            <L7p:Content stringValueReference="inline"><![CDATA[{
"result":{
	"transactionId":"${requestId}",
	"code":"400",
	"description":"Petición incorrecta",
	"descriptionDetail":"La petición contiene sintaxis errónea y no debería repetirse",
	"responseTimestamp":"${request.time.local.yyyy-MM-dd'T'HH:mm:ss.SSS}"
	}
}]]></L7p:Content>
                            <L7p:ContentType stringValue="application/json; charset=UTF-8"/>
                            <L7p:ExtraHeaders nameValuePairArray="included"/>
                            <L7p:HttpStatus stringValue="400"/>
                        </L7p:CustomizeErrorResponse>
                        <L7p:RaiseError/>
                    </wsp:All>
                </wsp:OneOrMore>
                <wsp:OneOrMore wsp:Usage="Required">
                    <wsp:All wsp:Usage="Required">
                        <L7p:EvaluateJsonPathExpression>
                            <L7p:Expression stringValue=".msisdn"/>
                            <L7p:VariablePrefix stringValue="msisdn"/>
                        </L7p:EvaluateJsonPathExpression>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="eyANCiJORVRXT1JLX0lEIjogIkNITF9FTlRFTCIsIA0KIkNSRURFTlRJQUxfVFlQRSI6ICJTVUJOTyIsIA0KIkNSRURFTlRJQUwiOiAiJHttc2lzZG4ucmVzdWx0fSIgDQp9"/>
                            <L7p:ContentType stringValue="application/json; charset=utf-8"/>
                            <L7p:DataType variableDataType="message"/>
                            <L7p:VariableToSet stringValue="message"/>
                        </L7p:SetVariable>
                        <L7p:HttpRoutingAssertion>
                            <L7p:FailOnErrorStatus booleanValue="false"/>
                            <L7p:HttpMethod httpMethod="POST"/>
                            <L7p:ProtectedServiceUrl stringValue="https://${gateway.bango.hostname}/HTTP/MSISDNRECYCLING/CLOSEACCOUNT"/>
                            <L7p:ProxyHost stringValue="${gateway.proxy.internet.hostname}"/>
                            <L7p:ProxyPort stringValue="${gateway.proxy.internet.port}"/>
                            <L7p:RequestHeaderRules httpPassthroughRuleSet="included">
                                <L7p:Rules httpPassthroughRules="included">
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:CustomizeValue stringValue="Basic RW50ZWxjaGlsZTpEOGhteG9nUkFZVzFwSw=="/>
                                    <L7p:Name stringValue="Authorization"/>
                                    <L7p:UsesCustomizedValue booleanValue="true"/>
                                    </L7p:item>
                                </L7p:Rules>
                            </L7p:RequestHeaderRules>
                            <L7p:RequestMsgSrc stringValue="message"/>
                            <L7p:RequestParamRules httpPassthroughRuleSet="included">
                                <L7p:ForwardAll booleanValue="true"/>
                                <L7p:Rules httpPassthroughRules="included"/>
                            </L7p:RequestParamRules>
                            <L7p:ResponseHeaderRules httpPassthroughRuleSet="included">
                                <L7p:ForwardAll booleanValue="true"/>
                                <L7p:Rules httpPassthroughRules="included">
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="Set-Cookie"/>
                                    </L7p:item>
                                </L7p:Rules>
                            </L7p:ResponseHeaderRules>
                            <L7p:ResponseMsgDest stringValue="serviceResponse"/>
                            <L7p:SamlAssertionVersion intValue="2"/>
                        </L7p:HttpRoutingAssertion>
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${httpRouting.reasonCode}"/>
                            <L7p:Expression2 stringValue="200"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="200"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:EvaluateJsonPathExpression>
                            <L7p:Expression stringValue=".ResponseMessage"/>
                            <L7p:OtherTargetMessageVariable stringValue="serviceResponse"/>
                            <L7p:Target target="OTHER"/>
                            <L7p:VariablePrefix stringValue="descriptRsp"/>
                        </L7p:EvaluateJsonPathExpression>
                        <L7p:HardcodedResponse>
                            <L7p:Base64ResponseBody stringValue="ewoicmVzdWx0Ijp7CgkidHJhbnNhY3Rpb25JZCI6IiR7cmVxdWVzdElkfSIsCgkiY29kZSI6IiR7aHR0cFJvdXRpbmcuUmVhc29uQ29kZX0iLAoJImRlc2NyaXB0aW9uIjoiT0siLAoJImRlc2NyaXB0aW9uRGV0YWlsIjoiJHtkZXNjcmlwdFJzcC5yZXN1bHR9IiwKCSJyZXNwb25zZVRpbWVzdGFtcCI6IiR7cmVxdWVzdC50aW1lLmxvY2FsLnl5eXktTU0tZGQnVCdISDptbTpzcy5TU1N9IgoJfQp9"/>
                            <L7p:ResponseContentType stringValue="application/json; charset=UTF-8"/>
                        </L7p:HardcodedResponse>
                    </wsp:All>
                    <wsp:OneOrMore wsp:Usage="Required">
                        <wsp:All wsp:Usage="Required">
                            <L7p:ComparisonAssertion>
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Expression1 stringValue="${httpRouting.reasonCode}"/>
                                <L7p:Expression2 stringValue="500"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="500"/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <L7p:EvaluateJsonPathExpression>
                                <L7p:Expression stringValue=".ResponseMessage"/>
                                <L7p:OtherTargetMessageVariable stringValue="serviceResponse"/>
                                <L7p:Target target="OTHER"/>
                                <L7p:VariablePrefix stringValue="descriptRsp"/>
                            </L7p:EvaluateJsonPathExpression>
                            <L7p:AuditDetailAssertion>
                                <L7p:CustomLoggerSuffix stringValue="entel.api.syslog.error"/>
                                <L7p:Detail stringValue="REQUESTID: ${requestId} | EVENTID: N/A | APIM ${service.name} Route Failed | IS STATUS: ${httpRouting.reasonCode} | IS URI: ${httpRouting.url} | IS REQUEST: ${message.mainpart} | IS RESPONSE: ${serviceResponse.mainpart} | TIMESTAMP: ${request.time.local.yyyy-MM-dd'T'HH:mm:ss.SSS}"/>
                                <L7p:Level stringValue="WARNING"/>
                                <L7p:LoggingOnly booleanValue="true"/>
                            </L7p:AuditDetailAssertion>
                            <L7p:CustomizeErrorResponse>
                                <L7p:Content stringValueReference="inline"><![CDATA[{
"result":{
	"transactionId":"${requestId}",
	"code":"${httpRouting.ReasonCode}",
	"description":"Error interno en el servidor",
	"descriptionDetail":"${descriptRsp.result}",
	"responseTimestamp":"${request.time.local.yyyy-MM-dd'T'HH:mm:ss.SSS}"
	}
}]]></L7p:Content>
                                <L7p:ContentType stringValue="application/json; charset=UTF-8"/>
                                <L7p:ExtraHeaders nameValuePairArray="included"/>
                            </L7p:CustomizeErrorResponse>
                            <L7p:RaiseError/>
                        </wsp:All>
                        <wsp:All wsp:Usage="Required">
                            <L7p:ComparisonAssertion>
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Expression1 stringValue="${httpRouting.reasonCode}"/>
                                <L7p:Expression2 stringValue="400"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="400"/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <L7p:EvaluateJsonPathExpression>
                                <L7p:Expression stringValue=".responseMessage"/>
                                <L7p:OtherTargetMessageVariable stringValue="serviceResponse"/>
                                <L7p:Target target="OTHER"/>
                                <L7p:VariablePrefix stringValue="descriptRsp"/>
                            </L7p:EvaluateJsonPathExpression>
                            <L7p:AuditDetailAssertion>
                                <L7p:CustomLoggerSuffix stringValue="entel.api.syslog.error"/>
                                <L7p:Detail stringValue="REQUESTID: ${requestId} | EVENTID: N/A | APIM ${service.name} Route Failed | IS STATUS: ${httpRouting.reasonCode} | IS URI: ${httpRouting.url} | IS REQUEST: ${message.mainpart} | IS RESPONSE: ${serviceResponse.mainpart} | TIMESTAMP: ${request.time.local.yyyy-MM-dd'T'HH:mm:ss.SSS}"/>
                                <L7p:Level stringValue="WARNING"/>
                                <L7p:LoggingOnly booleanValue="true"/>
                            </L7p:AuditDetailAssertion>
                            <L7p:CustomizeErrorResponse>
                                <L7p:Content stringValueReference="inline"><![CDATA[{
"result":{
	"transactionId":"${requestId}",
	"code":"${httpRouting.ReasonCode}",
	"description":"Petición incorrecta",
	"descriptionDetail":"${descriptRsp.result}",
	"responseTimestamp":"${request.time.local.yyyy-MM-dd'T'HH:mm:ss.SSS}"
	}
}]]></L7p:Content>
                                <L7p:ContentType stringValue="application/json; charset=UTF-8"/>
                                <L7p:ExtraHeaders nameValuePairArray="included"/>
                                <L7p:HttpStatus stringValue="400"/>
                            </L7p:CustomizeErrorResponse>
                            <L7p:RaiseError/>
                        </wsp:All>
                        <wsp:All wsp:Usage="Required">
                            <L7p:ComparisonAssertion>
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Expression1 stringValue="${httpRouting.reasonCode}"/>
                                <L7p:Expression2 stringValue="401"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="401"/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <L7p:EvaluateJsonPathExpression>
                                <L7p:Expression stringValue=".responseMessage"/>
                                <L7p:OtherTargetMessageVariable stringValue="serviceResponse"/>
                                <L7p:Target target="OTHER"/>
                                <L7p:VariablePrefix stringValue="descriptRsp"/>
                            </L7p:EvaluateJsonPathExpression>
                            <L7p:AuditDetailAssertion>
                                <L7p:CustomLoggerSuffix stringValue="entel.api.syslog.error"/>
                                <L7p:Detail stringValue="REQUESTID: ${requestId} | EVENTID: N/A | APIM ${service.name} Route Failed | IS STATUS: ${httpRouting.reasonCode} | IS URI: ${httpRouting.url} | IS REQUEST: ${message.mainpart} | IS RESPONSE: ${serviceResponse.mainpart} | TIMESTAMP: ${request.time.local.yyyy-MM-dd'T'HH:mm:ss.SSS}"/>
                                <L7p:Level stringValue="WARNING"/>
                                <L7p:LoggingOnly booleanValue="true"/>
                            </L7p:AuditDetailAssertion>
                            <L7p:CustomizeErrorResponse>
                                <L7p:Content stringValueReference="inline"><![CDATA[{
"result":{
	"transactionId":"${requestId}",
	"code":"${httpRouting.ReasonCode}",
	"description":"No autorizado",
	"descriptionDetail":"${descriptRsp.result}",
	"responseTimestamp":"${request.time.local.yyyy-MM-dd'T'HH:mm:ss.SSS}"
	}
}]]></L7p:Content>
                                <L7p:ContentType stringValue="application/json; charset=UTF-8"/>
                                <L7p:ExtraHeaders nameValuePairArray="included"/>
                                <L7p:HttpStatus stringValue="401"/>
                            </L7p:CustomizeErrorResponse>
                            <L7p:RaiseError/>
                        </wsp:All>
                    </wsp:OneOrMore>
                    <L7p:Include>
                        <L7p:PolicyGuid stringValue="1b3f18a3-5e88-4cae-9fae-44b459727ac1"/>
                    </L7p:Include>
                </wsp:OneOrMore>
            </wsp:All>
            <wsp:All wsp:Usage="Required">
                <L7p:CustomizeErrorResponse>
                    <L7p:Content stringValueReference="inline"><![CDATA[{
"result":{
	"transactionId":"${requestId}",
	"code":"400",
	"description":"Petición incorrecta",
	"descriptionDetail":"La petición contiene sintaxis errónea y no debería repetirse",
	"responseTimestamp":"${request.time.local.yyyy-MM-dd'T'HH:mm:ss.SSS}"
	}
}]]></L7p:Content>
                    <L7p:ContentType stringValue="application/json; charset=UTF-8"/>
                    <L7p:ExtraHeaders nameValuePairArray="included"/>
                    <L7p:HttpStatus stringValue="400"/>
                </L7p:CustomizeErrorResponse>
                <L7p:RaiseError/>
            </wsp:All>
        </wsp:OneOrMore>
    </wsp:All>
</wsp:Policy>