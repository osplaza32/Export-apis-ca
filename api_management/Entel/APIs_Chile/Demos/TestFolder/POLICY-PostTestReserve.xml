<?xml version="1.0" encoding="UTF-8"?>
<wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy">
    <wsp:All wsp:Usage="Required">
        <L7p:AuditDetailAssertion>
            <L7p:Detail stringValue="Policy Fragment: PostRequestPayment"/>
        </L7p:AuditDetailAssertion>
        <wsp:OneOrMore wsp:Usage="Required">
            <wsp:OneOrMore wsp:Usage="Required">
                <wsp:All wsp:Usage="Required">
                    <L7p:EvaluateJsonPathExpression>
                        <L7p:Expression stringValue="$.msisdn"/>
                        <L7p:VariablePrefix stringValue="msisdnPath"/>
                    </L7p:EvaluateJsonPathExpression>
                    <L7p:EvaluateJsonPathExpression>
                        <L7p:Expression stringValue="$.valor"/>
                        <L7p:VariablePrefix stringValue="valorPath"/>
                    </L7p:EvaluateJsonPathExpression>
                    <L7p:EvaluateJsonPathExpression>
                        <L7p:Expression stringValue="$.transactionId"/>
                        <L7p:VariablePrefix stringValue="transactionIdPath"/>
                    </L7p:EvaluateJsonPathExpression>
                    <L7p:EvaluateJsonPathExpression>
                        <L7p:Expression stringValue="$.aplicacion"/>
                        <L7p:VariablePrefix stringValue="aplicacionPath"/>
                    </L7p:EvaluateJsonPathExpression>
                    <L7p:EvaluateJsonPathExpression>
                        <L7p:Expression stringValue="$.tipoContenido"/>
                        <L7p:VariablePrefix stringValue="tipoContenidoPath"/>
                    </L7p:EvaluateJsonPathExpression>
                    <L7p:EvaluateJsonPathExpression>
                        <L7p:Expression stringValue="$.producto"/>
                        <L7p:VariablePrefix stringValue="productoPath"/>
                    </L7p:EvaluateJsonPathExpression>
                    <wsp:OneOrMore wsp:Usage="Required">
                        <wsp:OneOrMore wsp:Usage="Required">
                            <wsp:All wsp:Usage="Required">
                                <L7p:JdbcQuery>
                                    <L7p:AssertionFailureEnabled booleanValue="false"/>
                                    <L7p:ConnectionName stringValue="MigrationInfo"/>
                                    <L7p:ConvertVariablesToStrings booleanValue="false"/>
                                    <L7p:SqlQuery stringValueReference="inline"><![CDATA[SELECT 
RESOURCE_ID
FROM ESB_MIGRATION_INFO
WHERE 
(
STATE='MIG' OR STATE='MNA' OR  STATE='ACT' OR  STATE='NOT'
)
AND
RESOURCE_ID=${msisdnPath.result}]]></L7p:SqlQuery>
                                </L7p:JdbcQuery>
                                <wsp:OneOrMore wsp:Usage="Required">
                                    <wsp:All wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>
                                    <L7p:Expression1 stringValue="${jdbcQuery.queryresult.count}"/>
                                    <L7p:Expression2 stringValue="1"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item binary="included">
                                    <L7p:RightValue stringValue="1"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <wsp:All wsp:Usage="Required">
                                    <wsp:OneOrMore wsp:Usage="Required">
                                    <wsp:All wsp:Usage="Required">
                                    <L7p:SetVariable>

                                    <L7p:Base64Expression stringValue="ew0KICAgInN1c2NyaXB0aW9uSWQiOiAiJHttc2lzZG5QYXRoLnJlc3VsdH0iLA0KICAgInZhbG9yIjogIiR7dmFsb3JQYXRoLnJlc3VsdH0iLA0KICAgInRyYW5zYWN0aW9uSWQiOiAiJHt0cmFuc2FjdGlvbklkUGF0aC5yZXN1bHR9IiwNCiAgICJhcGxpY2FjaW9uIjogIiR7YXBsaWNhY2lvblBhdGgucmVzdWx0fSIsDQogICAidGlwb0NvbnRlbmlkbyI6ICIke3RpcG9Db250ZW5pZG9QYXRoLnJlc3VsdH0iLA0KICAgInByb2R1Y3RvIjogIiR7cHJvZHVjdG9QYXRoLnJlc3VsdH0iLA0KICAgInNlcnZpY2VJZGVudGlmaWVyIjogIjExIg0KfQ=="/>
                                    <L7p:ContentType stringValue="application/json; charset=utf-8"/>
                                    <L7p:DataType variableDataType="message"/>

                                    <L7p:VariableToSet stringValue="PayloadRQ"/>
                                    </L7p:SetVariable>
                                    <L7p:AuditDetailAssertion>

                                    <L7p:CustomLoggerSuffix stringValue="entel.api.syslog"/>
                                    <L7p:Detail stringValue="IDTRANSACTIONID: ${requestId} SERVICIO: ${request.url} REQUEST: ${PayloadRQ.mainpart}"/>
                                    <L7p:LoggingOnly booleanValue="true"/>
                                    </L7p:AuditDetailAssertion>
                                    <L7p:HttpRoutingAssertion>

                                    <L7p:ProtectedServiceUrl stringValue="http://10.49.22.28:8080/RestScap/resources/service/reserve"/>

                                    <L7p:ProxyPassword stringValueNull="null"/>

                                    <L7p:ProxyUsername stringValueNull="null"/>

                                    <L7p:RequestHeaderRules httpPassthroughRuleSet="included">

                                    <L7p:ForwardAll booleanValue="true"/>
                                    <L7p:Rules httpPassthroughRules="included">

                                    <L7p:item httpPassthroughRule="included">

                                    <L7p:Name stringValue="Cookie"/>
                                    </L7p:item>

                                    <L7p:item httpPassthroughRule="included">

                                    <L7p:Name stringValue="SOAPAction"/>
                                    </L7p:item>
                                    </L7p:Rules>
                                    </L7p:RequestHeaderRules>

                                    <L7p:RequestMsgSrc stringValue="PayloadRQ"/>

                                    <L7p:RequestParamRules httpPassthroughRuleSet="included">

                                    <L7p:ForwardAll booleanValue="true"/>
                                    <L7p:Rules httpPassthroughRules="included"/>
                                    </L7p:RequestParamRules>

                                    <L7p:ResponseHeaderRules httpPassthroughRuleSet="included">

                                    <L7p:ForwardAll booleanValue="true"/>
                                    <L7p:Rules httpPassthroughRules="included">

                                    <L7p:item httpPassthroughRule="included">

                                    <L7p:Name stringValue="Set-Cookie"/>
                                    </L7p:item>
                                    </L7p:Rules>
                                    </L7p:ResponseHeaderRules>

                                    <L7p:ResponseMsgDest stringValue="ReserveResponse"/>

                                    <L7p:SamlAssertionVersion intValue="2"/>
                                    </L7p:HttpRoutingAssertion>
                                    <L7p:AuditDetailAssertion>

                                    <L7p:CustomLoggerSuffix stringValue="entel.api.syslog"/>
                                    <L7p:Detail stringValue="IDTRANSACTIONID: ${requestId} SERVICIO: ${httpRouting.url} REASONCODE: ${httpRouting.reasonCode}  RESPONSE: ${ReserveResponse.mainpart}"/>
                                    <L7p:LoggingOnly booleanValue="true"/>
                                    </L7p:AuditDetailAssertion>
                                    <L7p:HardcodedResponse>

                                    <L7p:Base64ResponseBody stringValue="JHtSZXNlcnZlUmVzcG9uc2UubWFpbnBhcnR9"/>

                                    <L7p:ResponseContentType stringValue="application/json; charset=utf-8"/>
                                    </L7p:HardcodedResponse>
                                    </wsp:All>
                                    </wsp:OneOrMore>
                                    <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue="Migrado"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:assertionComment>
                                    </wsp:All>
                                    </wsp:All>
                                    <wsp:All wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>
                                    <L7p:Expression1 stringValue="${jdbcQuery.queryresult.count}"/>
                                    <L7p:Expression2 stringValue="0"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item binary="included">
                                    <L7p:RightValue stringValue="0"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <wsp:All wsp:Usage="Required">
                                    <wsp:OneOrMore wsp:Usage="Required">
                                    <wsp:All wsp:Usage="Required">
                                    <L7p:AuditDetailAssertion>

                                    <L7p:CustomLoggerSuffix stringValue="entel.api.syslog"/>
                                    <L7p:Detail stringValue="IDTRANSACTIONID: ${requestId} SERVICIO: ${request.url} REQUEST: ${request.mainpart}"/>
                                    <L7p:LoggingOnly booleanValue="true"/>
                                    </L7p:AuditDetailAssertion>
                                    <L7p:HttpRoutingAssertion>

                                    <L7p:ProtectedServiceUrl stringValue="http://172.28.39.182:8080/legado/mock/v1/reserve"/>

                                    <L7p:ProxyPassword stringValueNull="null"/>

                                    <L7p:ProxyUsername stringValueNull="null"/>

                                    <L7p:RequestHeaderRules httpPassthroughRuleSet="included">

                                    <L7p:ForwardAll booleanValue="true"/>
                                    <L7p:Rules httpPassthroughRules="included">

                                    <L7p:item httpPassthroughRule="included">

                                    <L7p:Name stringValue="Cookie"/>
                                    </L7p:item>

                                    <L7p:item httpPassthroughRule="included">

                                    <L7p:Name stringValue="SOAPAction"/>
                                    </L7p:item>
                                    </L7p:Rules>
                                    </L7p:RequestHeaderRules>

                                    <L7p:RequestParamRules httpPassthroughRuleSet="included">

                                    <L7p:ForwardAll booleanValue="true"/>
                                    <L7p:Rules httpPassthroughRules="included"/>
                                    </L7p:RequestParamRules>

                                    <L7p:ResponseHeaderRules httpPassthroughRuleSet="included">

                                    <L7p:ForwardAll booleanValue="true"/>
                                    <L7p:Rules httpPassthroughRules="included">

                                    <L7p:item httpPassthroughRule="included">

                                    <L7p:Name stringValue="Set-Cookie"/>
                                    </L7p:item>
                                    </L7p:Rules>
                                    </L7p:ResponseHeaderRules>

                                    <L7p:ResponseMsgDest stringValue="serviceResponse"/>

                                    <L7p:SamlAssertionVersion intValue="2"/>
                                    </L7p:HttpRoutingAssertion>
                                    <L7p:AuditDetailAssertion>

                                    <L7p:CustomLoggerSuffix stringValue="entel.api.syslog"/>
                                    <L7p:Detail stringValue="IDTRANSACTIONID: ${requestId} SERVICIO: ${httpRouting.url} REASONCODE: ${httpRouting.reasonCode}  RESPONSE: ${serviceResponse.mainpart}"/>
                                    <L7p:LoggingOnly booleanValue="true"/>
                                    </L7p:AuditDetailAssertion>
                                    <L7p:Include>
                                    <L7p:PolicyGuid stringValue="6ca99a73-dddf-4d5c-b579-1b8ff18635d6"/>
                                    </L7p:Include>
                                    <L7p:SetVariable>

                                    <L7p:Base64Expression stringValue="JHtzZXJ2aWNlUmVzcG9uc2UubWFpbnBhcnR9"/>
                                    <L7p:ContentType stringValue="application/json; charset=utf-8"/>
                                    <L7p:DataType variableDataType="message"/>

                                    <L7p:VariableToSet stringValue="jsonRespuesta"/>
                                    </L7p:SetVariable>
                                    <L7p:EvaluateJsonPathExpression>
                                    <L7p:Expression stringValue=".headerOut"/>

                                    <L7p:OtherTargetMessageVariable stringValue="jsonRespuesta"/>
                                    <L7p:Target target="OTHER"/>
                                    </L7p:EvaluateJsonPathExpression>
                                    <L7p:HardcodedResponse>

                                    <L7p:Base64ResponseBody stringValue="JHtqc29uUGF0aC5yZXN1bHR9"/>

                                    <L7p:ResponseContentType stringValue="application/json; charset=utf-8"/>
                                    </L7p:HardcodedResponse>
                                    </wsp:All>
                                    <wsp:All wsp:Usage="Required">
                                    <wsp:OneOrMore wsp:Usage="Required">
                                    <wsp:All wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>

                                    <L7p:Expression1 stringValue="${httpRouting.reasoncode}"/>

                                    <L7p:Expression2 stringValue="-1"/>

                                    <L7p:Predicates predicates="included">

                                    <L7p:item binary="included">

                                    <L7p:RightValue stringValue="-1"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:SetVariable>

                                    <L7p:Base64Expression stringValue="SG9zdCBOb3QgRm91bmQ="/>

                                    <L7p:VariableToSet stringValue="description"/>
                                    </L7p:SetVariable>
                                    <L7p:AuditDetailAssertion>

                                    <L7p:CustomLoggerSuffix stringValue="entel.api.syslog"/>

                                    <L7p:Detail stringValue="IDTRANSACTIONID: ${requestId}  REASONCODE: ${httpRouting.reasonCode}  DESCRIPTION: ${description}"/>

                                    <L7p:LoggingOnly booleanValue="true"/>
                                    </L7p:AuditDetailAssertion>
                                    <L7p:CustomizeErrorResponse>

                                    <L7p:Content stringValue="-1 Internal Server Error"/>

                                    <L7p:ExtraHeaders nameValuePairArray="included"/>
                                    </L7p:CustomizeErrorResponse>
                                    <L7p:RaiseError/>
                                    </wsp:All>
                                    <wsp:All wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>

                                    <L7p:Expression1 stringValue="${httpRouting.reasoncode}"/>

                                    <L7p:Expression2 stringValue="-2"/>

                                    <L7p:Predicates predicates="included">

                                    <L7p:item binary="included">

                                    <L7p:RightValue stringValue="-2"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:SetVariable>

                                    <L7p:Base64Expression stringValue="QmFkIFVSTA=="/>

                                    <L7p:VariableToSet stringValue="description"/>
                                    </L7p:SetVariable>
                                    <L7p:AuditDetailAssertion>

                                    <L7p:CustomLoggerSuffix stringValue="entel.api.syslog"/>

                                    <L7p:Detail stringValue="IDTRANSACTIONID: ${requestId}  REASONCODE: ${httpRouting.reasonCode}  DESCRIPTION: ${description}"/>

                                    <L7p:LoggingOnly booleanValue="true"/>
                                    </L7p:AuditDetailAssertion>
                                    <L7p:CustomizeErrorResponse>

                                    <L7p:Content stringValue="-2 Internal Server Error"/>

                                    <L7p:ExtraHeaders nameValuePairArray="included"/>
                                    </L7p:CustomizeErrorResponse>
                                    <L7p:RaiseError/>
                                    </wsp:All>
                                    <wsp:All wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>

                                    <L7p:Expression1 stringValue="${httpRouting.reasoncode}"/>

                                    <L7p:Expression2 stringValue="-3"/>

                                    <L7p:Predicates predicates="included">

                                    <L7p:item binary="included">

                                    <L7p:RightValue stringValue="-3"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:SetVariable>

                                    <L7p:Base64Expression stringValue="Q29ubmVjdGlvbiBUaW1lb3V0"/>

                                    <L7p:VariableToSet stringValue="description"/>
                                    </L7p:SetVariable>
                                    <L7p:AuditDetailAssertion>

                                    <L7p:CustomLoggerSuffix stringValue="entel.api.syslog"/>

                                    <L7p:Detail stringValue="IDTRANSACTIONID: ${requestId}  REASONCODE: ${httpRouting.reasonCode}  DESCRIPTION: ${description}"/>

                                    <L7p:LoggingOnly booleanValue="true"/>
                                    </L7p:AuditDetailAssertion>
                                    <L7p:CustomizeErrorResponse>

                                    <L7p:Content stringValue="-3 Internal Server Error"/>

                                    <L7p:ExtraHeaders nameValuePairArray="included"/>
                                    </L7p:CustomizeErrorResponse>
                                    <L7p:RaiseError/>
                                    </wsp:All>
                                    <wsp:All wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>

                                    <L7p:Expression1 stringValue="${httpRouting.reasoncode}"/>

                                    <L7p:Expression2 stringValue="-4"/>

                                    <L7p:Predicates predicates="included">

                                    <L7p:item binary="included">

                                    <L7p:RightValue stringValue="-4"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:SetVariable>

                                    <L7p:Base64Expression stringValue="UmVhZCBUaW1lb3V0"/>

                                    <L7p:VariableToSet stringValue="description"/>
                                    </L7p:SetVariable>
                                    <L7p:AuditDetailAssertion>

                                    <L7p:CustomLoggerSuffix stringValue="entel.api.syslog"/>

                                    <L7p:Detail stringValue="IDTRANSACTIONID: ${requestId}  REASONCODE: ${httpRouting.reasonCode}  DESCRIPTION: ${description}"/>

                                    <L7p:LoggingOnly booleanValue="true"/>
                                    </L7p:AuditDetailAssertion>
                                    <L7p:CustomizeErrorResponse>

                                    <L7p:Content stringValue="-4 Internal Server Error"/>

                                    <L7p:ExtraHeaders nameValuePairArray="included"/>
                                    </L7p:CustomizeErrorResponse>
                                    <L7p:RaiseError/>
                                    </wsp:All>
                                    <wsp:All wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>

                                    <L7p:Expression1 stringValue="${httpRouting.reasoncode}"/>

                                    <L7p:Expression2 stringValue="-5"/>

                                    <L7p:Predicates predicates="included">

                                    <L7p:item binary="included">

                                    <L7p:RightValue stringValue="-5"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:SetVariable>

                                    <L7p:Base64Expression stringValue="VW5kZWZpbmllZA=="/>

                                    <L7p:VariableToSet stringValue="description"/>
                                    </L7p:SetVariable>
                                    <L7p:AuditDetailAssertion>

                                    <L7p:CustomLoggerSuffix stringValue="entel.api.syslog"/>

                                    <L7p:Detail stringValue="IDTRANSACTIONID: ${requestId}  REASONCODE: ${httpRouting.reasonCode}  DESCRIPTION: ${description}"/>

                                    <L7p:LoggingOnly booleanValue="true"/>
                                    </L7p:AuditDetailAssertion>
                                    <L7p:CustomizeErrorResponse>

                                    <L7p:Content stringValue="-5 Internal Server Error"/>

                                    <L7p:ExtraHeaders nameValuePairArray="included"/>
                                    </L7p:CustomizeErrorResponse>
                                    <L7p:RaiseError/>
                                    </wsp:All>
                                    <wsp:All wsp:Usage="Required">
                                    <L7p:SetVariable>

                                    <L7p:Base64Expression stringValue="RXJyb3I="/>

                                    <L7p:VariableToSet stringValue="description"/>
                                    </L7p:SetVariable>
                                    <L7p:AuditDetailAssertion>

                                    <L7p:CustomLoggerSuffix stringValue="entel.api.syslog"/>

                                    <L7p:Detail stringValue="IDTRANSACTIONID: ${requestId}  REASONCODE: ${httpRouting.reasonCode}  DESCRIPTION: ${description}"/>

                                    <L7p:LoggingOnly booleanValue="true"/>
                                    </L7p:AuditDetailAssertion>
                                    <L7p:CustomizeErrorResponse>

                                    <L7p:ExtraHeaders nameValuePairArray="included"/>
                                    </L7p:CustomizeErrorResponse>
                                    </wsp:All>
                                    </wsp:OneOrMore>
                                    </wsp:All>
                                    </wsp:OneOrMore>
                                    <L7p:XslTransformation>
                                    <L7p:Direction intValue="-1"/>
                                    <L7p:Enabled booleanValue="false"/>
                                    <L7p:MsgVarPrefix stringValue="serviceResponse"/>

                                    <L7p:OtherTargetMessageVariable stringValue="serviceResponse"/>
                                    <L7p:ResourceInfo staticResourceInfo="included">
                                    <L7p:Document stringValueReference="inline"><![CDATA[<xsl:stylesheet exclude-result-prefixes="ns0" version="1.0" xmlns:mon="http://lhsgroup.com/lhsws/money" xmlns:ns0="http://ericsson.com/services/ws_CIL_6/usagedatarecordsread" xmlns:ns10="http://www.entel.cl/EBO/Contract/v1" xmlns:ns11="http://www.entel.cl/EBO/IMSI/v1" xmlns:ns12="http://www.entel.cl/EBO/Quantity/v1" xmlns:ns2="http://www.entel.cl/EBO/Product/v1" xmlns:ns3="http://www.entel.cl/EBM/UsageDetails/Get/v1" xmlns:ns4="http://www.entel.cl/EBO/Service/v1" xmlns:ns5="http://www.entel.cl/EBO/CustomerFacingServiceSpec/v1" xmlns:ns6="http://www.entel.cl/EBO/AppliedCustomerBillingCharge/v1" xmlns:ns7="http://www.entel.cl/EBO/BillingAccount/v1" xmlns:ns8="http://www.entel.cl/EBO/CustomerBill/v1" xmlns:ns9="http://www.entel.cl/EBO/Filter/v1" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
    <xsl:template match="/">
        <ns3:Body>
            <xsl:for-each select="//ns0:usageDataRecordsReadResponse/ns0:output/ns0:item">
                <ns3:AppliedCustomerBillingCharge>
                                                                              <xsl:if test="ns0:cdrGenerator">
                                                                                              <ns6:CDRGenerator>
                                                                                                              <xsl:value-of select="ns0:cdrGenerator"/>
                                                                                              </ns6:CDRGenerator>
                                                                              </xsl:if>
                                                                              <xsl:if test="ns0:billedInd">
                                                                                              <ns6:billed>
                                                                                                              <xsl:value-of select="ns0:billedInd"/>
                                                                                              </ns6:billed>
                    </xsl:if>
                                                                              <xsl:if test="ns0:callId">
                                                                                              <ns6:callID>
                                                                                                              <xsl:value-of select="ns0:callId"/>
                                                                                              </ns6:callID>
                                                                              </xsl:if>
                                                                              <xsl:if test="ns0:prepayInd">
                                                                                              <ns6:callPrePayInd>
                                                                                                              <xsl:value-of select="ns0:prepayInd"/>
                                                                                              </ns6:callPrePayInd>    
                                                                              </xsl:if>
                                                                              <xsl:if test="ns0:origStart">                                                                     
                                                                                              <ns6:callStartDate>
                                                                                                              <xsl:value-of select="ns0:origStart"/>
                                                                                              </ns6:callStartDate>                     
                                                                              </xsl:if>
                                                                              <xsl:if test="ns0:type">
                                                                                              <ns6:callType>
                                                                                                              <xsl:value-of select="ns0:type"/>
                                                                                              </ns6:callType>
                                                                              </xsl:if>
                                                                              <xsl:if test="ns0:uomCodePub">
                                                                                              <ns6:callUnitMeasure>
                                                                                                              <xsl:value-of select="ns0:uomCodePub"/>
                                                                                              </ns6:callUnitMeasure>                                             
                                                                              </xsl:if>
                                                                              <xsl:if test="ns0:remark">                                                                        
                                                                                              <ns6:description>
                                                                                                              <xsl:value-of select="ns0:remark"/>
                                                                                              </ns6:description>                                                        
                                                                              </xsl:if>
                                                                              <xsl:if test="ns0:calledparty">
                                                                                              <ns6:destinyCall>
                                                                                                              <xsl:value-of select="ns0:calledparty"/>
                                                                                              </ns6:destinyCall>
                                                                              </xsl:if>
                                                                              <xsl:if test="ns0:entryDate">
                                                                                              <ns6:entryCallDate>
                                                                                                              <xsl:value-of select="ns0:entryDate"/>
                                                                                              </ns6:entryCallDate>
                                                                              </xsl:if>
                                                                              <xsl:if test="ns0:spcode">
                                                                                              <ns6:externalPackID>
                                                                                                              <xsl:value-of select="ns0:spcode"/>
                                                                                              </ns6:externalPackID>
                                                                              </xsl:if>
                                                                              <xsl:if test="ns0:rpcodePub">
                                                                                              <ns6:externalPlanID>
                                                                                                              <xsl:value-of select="ns0:rpcodePub"/>
                                                                                              </ns6:externalPlanID>
                                                                              </xsl:if>
                                                                              <xsl:if test="ns0:callingparty">
                                                                                              <ns6:originCall>
                                                                                                              <xsl:value-of select="ns0:callingparty"/>
                                                                                              </ns6:originCall>
                                                                              </xsl:if>
                                                                              <xsl:if test="ns0:roamingInd">
                                                                                              <ns6:roamingCall>
                                                                                                              <xsl:value-of select="ns0:roamingInd"/>
                                                                                              </ns6:roamingCall>
                                                                              </xsl:if>
                                                                              <xsl:if test="ns0:ttname">
                                                                                              <ns6:taxTimeName>
                                                                                                              <xsl:value-of select="ns0:ttname"/>
                                                                                              </ns6:taxTimeName>
                                                                              </xsl:if>
                                                                              <xsl:if test="ns0:tzname">
                                                                                              <ns6:taxZoneName>
                                                                                                              <xsl:value-of select="ns0:tzname"/>
                                                                                              </ns6:taxZoneName>
                                                                              </xsl:if>
                    <ns3:BillingAccount>
                        <xsl:if test="ns0:currencyIdPub">
                            <ns7:externalCurrency>
                                <xsl:value-of select="ns0:currencyIdPub"/>
                            </ns7:externalCurrency>
                        </xsl:if>
                        <xsl:if test="ns0:csId">
                            <ns7:externalID>
                                <xsl:value-of select="ns0:csId"/>
                            </ns7:externalID>
                        </xsl:if>
                        <ns3:CustomerBill>
                            <xsl:if test="ns0:invoiceno">
                                <ns8:billNo>
                                    <xsl:value-of select="ns0:invoiceno"/>
                                </ns8:billNo>
                            </xsl:if>
                            <xsl:if test="ns0:ratedFlatAmount/mon:amount">
                                <ns8:rateFlat>
                                    <xsl:value-of select="ns0:ratedFlatAmount/mon:amount"/>
                                </ns8:rateFlat>
                            </xsl:if>
                            <xsl:if test="ns0:ratedTaxAmount/mon:amount">
                                <ns8:taxRate>
                                    <xsl:value-of select="ns0:ratedTaxAmount/mon:amount"/>
                                </ns8:taxRate>
                            </xsl:if>
                            <xsl:if test="ns0:xfileExternalCharge">
                                <ns8:taxThirdParty>
                                    <xsl:value-of select="ns0:xfileExternalCharge"/>
                                </ns8:taxThirdParty>
                            </xsl:if>
                        </ns3:CustomerBill>
                    </ns3:BillingAccount>
                    <ns3:Filter>
                                                                              <xsl:if test="//ns0:usageDataRecordsReadResponse/ns0:searchIsComplete">
                        <ns9:searchIsComplete>
                            <xsl:value-of select="//ns0:usageDataRecordsReadResponse/ns0:searchIsComplete"/>
                        </ns9:searchIsComplete>
                            </xsl:if>                                                                                 
                    </ns3:Filter>
                    <ns3:Product>
                        <xsl:if test="ns0:freeUnitsList/ns0:item[1]/ns0:productId">
                            <ns2:id>
                                <xsl:value-of select="ns0:freeUnitsList/ns0:item[1]/ns0:productId"/>
                            </ns2:id>
                        </xsl:if>
                        <ns3:Contract>
                            <xsl:if test="ns0:coId">
                                <ns10:ID>
                                    <xsl:value-of select="ns0:coId"/>
                                </ns10:ID>
                            </xsl:if>
                        </ns3:Contract>
                        <ns3:CustomerFacingServiceSpec>
                                                                                              <xsl:if test="ns0:freeUnitsList/ns0:item/ns0:fuPackIdPub">
                            <ns5:externalID>
                                <xsl:value-of select="ns0:freeUnitsList/ns0:item/ns0:fuPackIdPub"/>
                           </ns5:externalID>
                                                                                              </xsl:if>
                                                                                              <xsl:if test="ns0:freeUnitsList/ns0:item/ns0:cfssId">
                            <ns5:id>
                                <xsl:value-of select="ns0:freeUnitsList/ns0:item/ns0:cfssId"/>
                            </ns5:id>
                                                                                              </xsl:if>
                        </ns3:CustomerFacingServiceSpec>
                        <ns3:IMSI>
                            <xsl:if test="ns0:dataVolume">
                                <ns11:SN>
                                    <xsl:value-of select="ns0:dataVolume"/>
                                </ns11:SN>
                            </xsl:if>
                        </ns3:IMSI>
                        <ns3:Service>
                            <xsl:if test="ns0:sncodePub">
                                <ns4:externalCode>
                                    <xsl:value-of select="ns0:sncodePub"/>
                                </ns4:externalCode>
                            </xsl:if>
                            <xsl:if test="ns0:vasCode">
                                <ns4:serviceCode>
                                    <xsl:value-of select="ns0:vasCode"/>
                                </ns4:serviceCode>
                            </xsl:if>
                        </ns3:Service>
                    </ns3:Product>
                    <ns3:callVolume>
                        <xsl:if test="ns0:dataVolume">
                            <ns12:unit>
                                <xsl:value-of select="ns0:dataVolume"/>
                            </ns12:unit>
                        </xsl:if>
                    </ns3:callVolume>
                    <ns3:downloadVolume>
                        <xsl:if test="ns0:downlinkVolume">
                            <ns12:unit>
                                <xsl:value-of select="ns0:downlinkVolume"/>
                            </ns12:unit>
                        </xsl:if>
                    </ns3:downloadVolume>
                    <ns3:durationCall>
                        <xsl:if test="ns0:duration">
                            <ns12:unit>
                                <xsl:value-of select="ns0:duration"/>
                            </ns12:unit>
                        </xsl:if>
                    </ns3:durationCall>
                    <ns3:eventDuration>
                        <xsl:if test="ns0:eventVolume">
                            <ns12:unit>
                                <xsl:value-of select="ns0:eventVolume"/>
                            </ns12:unit>
                        </xsl:if>
                    </ns3:eventDuration>
                    <ns3:messageVolume>
                        <xsl:if test="ns0:messageVolume">
                            <ns12:unit>
                                <xsl:value-of select="ns0:messageVolume"/>
                            </ns12:unit>
                        </xsl:if>
                    </ns3:messageVolume>
                    <ns3:ratedVolume>
                        <xsl:choose>
                            <xsl:when test="ns0:ratedVolumeUom!=2">
                                <ns12:unit>
                                    <xsl:value-of select="ns0:ratedVolumeUom"/>
                                </ns12:unit>
                            </xsl:when>
                                                                                                              <xsl:otherwise>
                                                                                                                  <ns12:unit>
                                    11
                                </ns12:unit>
                                                                                                              </xsl:otherwise>
                        </xsl:choose>
                        <xsl:if test="ns0:ratedVolumeUom">
                            <ns12:amount>
                                <xsl:value-of select="ns0:ratedVolume"/>
                            </ns12:amount>
                        </xsl:if>
                    </ns3:ratedVolume>
                </ns3:AppliedCustomerBillingCharge>
            </xsl:for-each>
        </ns3:Body>
    </xsl:template>
</xsl:stylesheet>]]></L7p:Document>
                                    </L7p:ResourceInfo>
                                    <L7p:Target target="OTHER"/>
                                    <L7p:TransformName stringValue=""/>
                                    <L7p:XsltVersion stringValue="1.0"/>
                                    </L7p:XslTransformation>
                                    <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue="No migrado"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:assertionComment>
                                    </wsp:All>
                                    </wsp:All>
                                </wsp:OneOrMore>
                            </wsp:All>
                            <wsp:All wsp:Usage="Required"/>
                        </wsp:OneOrMore>
                        <L7p:HttpRoutingAssertion>
                            <L7p:Enabled booleanValue="false"/>
                            <L7p:HttpMethod httpMethod="GET"/>
                            <L7p:ProtectedServiceUrl stringValue="https://10.49.22.7:8443/customer/v1/migration/${msisdnPath.result}"/>
                            <L7p:ProxyPassword stringValueNull="null"/>
                            <L7p:ProxyUsername stringValueNull="null"/>
                            <L7p:RequestHeaderRules httpPassthroughRuleSet="included">
                                <L7p:ForwardAll booleanValue="true"/>
                                <L7p:Rules httpPassthroughRules="included">
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="Cookie"/>
                                    </L7p:item>
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="SOAPAction"/>
                                    </L7p:item>
                                </L7p:Rules>
                            </L7p:RequestHeaderRules>
                            <L7p:RequestParamRules httpPassthroughRuleSet="included">
                                <L7p:ForwardAll booleanValue="true"/>
                                <L7p:Rules httpPassthroughRules="included"/>
                            </L7p:RequestParamRules>
                            <L7p:ResponseHeaderRules httpPassthroughRuleSet="included">
                                <L7p:ForwardAll booleanValue="true"/>
                                <L7p:Rules httpPassthroughRules="included">
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="Set-Cookie"/>
                                    </L7p:item>
                                </L7p:Rules>
                            </L7p:ResponseHeaderRules>
                            <L7p:ResponseMsgDest stringValue="MigrationRSP"/>
                            <L7p:SamlAssertionVersion intValue="2"/>
                        </L7p:HttpRoutingAssertion>
                        <L7p:EvaluateJsonPathExpression>
                            <L7p:Enabled booleanValue="false"/>
                            <L7p:Expression stringValue="$.code"/>
                            <L7p:OtherTargetMessageVariable stringValue="MigrationRSP"/>
                            <L7p:Target target="OTHER"/>
                            <L7p:VariablePrefix stringValue="migrationPath"/>
                        </L7p:EvaluateJsonPathExpression>
                    </wsp:OneOrMore>
                </wsp:All>
            </wsp:OneOrMore>
            <wsp:All wsp:Usage="Required">
                <L7p:CustomizeErrorResponse>
                    <L7p:Content stringValue="Error"/>
                    <L7p:ExtraHeaders nameValuePairArray="included"/>
                </L7p:CustomizeErrorResponse>
                <L7p:RaiseError/>
            </wsp:All>
        </wsp:OneOrMore>
    </wsp:All>
</wsp:Policy>