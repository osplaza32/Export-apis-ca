<?xml version="1.0" encoding="UTF-8"?>
<wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy">
    <wsp:All wsp:Usage="Required">
        <L7p:AuditDetailAssertion>
            <L7p:Detail stringValue="Policy Fragment: Request Header Validation"/>
        </L7p:AuditDetailAssertion>
        <wsp:All wsp:Usage="Required">
            <wsp:OneOrMore wsp:Usage="Required">
                <wsp:All wsp:Usage="Required">
                    <L7p:EvaluateJsonPathExpression>
                        <L7p:AssertionComment assertionComment="included">
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue="OBTENER MESSAGEHEADER"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:AssertionComment>
                        <L7p:Expression stringValue="$.RequestHeader.Consumer"/>
                        <L7p:VariablePrefix stringValue="MessageHeaderConsumer"/>
                    </L7p:EvaluateJsonPathExpression>
                </wsp:All>
                <wsp:All wsp:Usage="Required">
                    <L7p:CustomizeErrorResponse>
                        <L7p:Content stringValueReference="inline"><![CDATA[{
 "Error": "Invalid consumer"
}]]></L7p:Content>
                        <L7p:ContentType stringValue="application/json; charset=utf-8"/>
                        <L7p:ExtraHeaders nameValuePairArray="included"/>
                    </L7p:CustomizeErrorResponse>
                    <L7p:RaiseError/>
                </wsp:All>
            </wsp:OneOrMore>
            <wsp:OneOrMore wsp:Usage="Required">
                <wsp:All wsp:Usage="Required">
                    <L7p:EvaluateJsonPathExpression>
                        <L7p:Expression stringValue=".Channel.name"/>
                        <L7p:VariablePrefix stringValue="chName"/>
                    </L7p:EvaluateJsonPathExpression>
                    <L7p:ComparisonAssertion>
                        <L7p:CaseSensitive booleanValue="false"/>
                        <L7p:Expression1 stringValue="${chName.result}"/>
                        <L7p:Operator operatorNull="null"/>
                        <L7p:Predicates predicates="included">
                            <L7p:item dataType="included">
                                <L7p:Type variableDataType="string"/>
                            </L7p:item>
                            <L7p:item binary="included">
                                <L7p:RightValue stringValue="APIM"/>
                            </L7p:item>
                        </L7p:Predicates>
                    </L7p:ComparisonAssertion>
                    <L7p:EvaluateJsonPathExpression>
                        <L7p:AssertionComment assertionComment="included">
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue="OBTENER MESSAGEHEADER"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:AssertionComment>
                        <L7p:Expression stringValue="$.RequestHeader.Channel"/>
                        <L7p:VariablePrefix stringValue="MessageHeaderChannel"/>
                    </L7p:EvaluateJsonPathExpression>
                </wsp:All>
                <wsp:All wsp:Usage="Required">
                    <wsp:OneOrMore wsp:Usage="Required">
                        <wsp:All wsp:Usage="Required">
                            <L7p:EvaluateJsonPathExpression>
                                <L7p:Expression stringValue=".Channel.name"/>
                                <L7p:VariablePrefix stringValue="chname"/>
                            </L7p:EvaluateJsonPathExpression>
                            <L7p:ComparisonAssertion>
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Expression1 stringValue="${chname.result}"/>
                                <L7p:Operator operatorNull="null"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:Negated booleanValue="true"/>
                                    <L7p:Operator operator="EMPTY"/>
                                    <L7p:RightValue stringValue=""/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <L7p:EvaluateJsonPathExpression>
                                <L7p:Expression stringValue=".Channel.mode"/>
                                <L7p:VariablePrefix stringValue="chmode"/>
                            </L7p:EvaluateJsonPathExpression>
                            <L7p:ComparisonAssertion>
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Expression1 stringValue="${chmode.result}"/>
                                <L7p:Operator operatorNull="null"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:Negated booleanValue="true"/>
                                    <L7p:Operator operator="EMPTY"/>
                                    <L7p:RightValue stringValue=""/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <L7p:SetVariable>
                                <L7p:Base64Expression stringValue="eyJtb2RlIjoiJHtjaG1vZGUucmVzdWx0fSIsIm5hbWUiOiJBUElNIn0="/>
                                <L7p:VariableToSet stringValue="MessageHeaderChannel.result"/>
                            </L7p:SetVariable>
                        </wsp:All>
                        <wsp:All wsp:Usage="Required">
                            <L7p:SetVariable>
                                <L7p:Base64Expression stringValue="ew0KCSJuYW1lIjogIkFQSU0iLA0KCSJtb2RlIjogIlVOSyINCiB9"/>
                                <L7p:VariableToSet stringValue="MessageHeaderChannel.result"/>
                            </L7p:SetVariable>
                        </wsp:All>
                    </wsp:OneOrMore>
                </wsp:All>
            </wsp:OneOrMore>
            <wsp:OneOrMore wsp:Usage="Required">
                <wsp:All wsp:Usage="Required">
                    <L7p:EvaluateJsonPathExpression>
                        <L7p:AssertionComment assertionComment="included">
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue="OBTENER MESSAGEHEADER"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:AssertionComment>
                        <L7p:Expression stringValue=".Trace"/>
                        <L7p:VariablePrefix stringValue="MessageHeaderTrace"/>
                    </L7p:EvaluateJsonPathExpression>
                    <L7p:ComparisonAssertion>
                        <L7p:CaseSensitive booleanValue="false"/>
                        <L7p:Expression1 stringValue="${MessageHeaderTrace.result}"/>
                        <L7p:Operator operatorNull="null"/>
                        <L7p:Predicates predicates="included">
                            <L7p:item dataType="included">
                                <L7p:Type variableDataType="string"/>
                            </L7p:item>
                            <L7p:item binary="included">
                                <L7p:Negated booleanValue="true"/>
                                <L7p:Operator operator="EMPTY"/>
                                <L7p:RightValue stringValue=""/>
                            </L7p:item>
                        </L7p:Predicates>
                    </L7p:ComparisonAssertion>
                    <wsp:OneOrMore wsp:Usage="Required">
                        <wsp:All wsp:Usage="Required">
                            <L7p:EvaluateJsonPathExpression>
                                <L7p:AssertionComment assertionComment="included">
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue="OBTENER MESSAGEHEADER"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                </L7p:AssertionComment>
                                <L7p:Expression stringValue=".Trace.eventID"/>
                                <L7p:VariablePrefix stringValue="eventID"/>
                            </L7p:EvaluateJsonPathExpression>
                            <L7p:EvaluateJsonPathExpression>
                                <L7p:AssertionComment assertionComment="included">
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue="OBTENER MESSAGEHEADER"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                </L7p:AssertionComment>
                                <L7p:Expression stringValue=".Trace.clientReqTimestamp"/>
                                <L7p:VariablePrefix stringValue="clientReqTimestamp"/>
                            </L7p:EvaluateJsonPathExpression>
                            <L7p:ComparisonAssertion>
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Expression1 stringValue="${eventID.result}"/>
                                <L7p:Operator operatorNull="null"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:Negated booleanValue="true"/>
                                    <L7p:Operator operator="EMPTY"/>
                                    <L7p:RightValue stringValue=""/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <L7p:ComparisonAssertion>
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Expression1 stringValue="${clientReqTimestamp.result}"/>
                                <L7p:Operator operatorNull="null"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:Negated booleanValue="true"/>
                                    <L7p:Operator operator="EMPTY"/>
                                    <L7p:RightValue stringValue=""/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <L7p:EvaluateJsonPathExpression>
                                <L7p:Expression stringValue="$.RequestHeader.Trace"/>
                                <L7p:VariablePrefix stringValue="MessageHeaderTrace"/>
                            </L7p:EvaluateJsonPathExpression>
                        </wsp:All>
                        <wsp:All wsp:Usage="Required">
                            <L7p:ComparisonAssertion>
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Expression1 stringValue="${eventID.result}"/>
                                <L7p:Operator operatorNull="null"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:Operator operator="EMPTY"/>
                                    <L7p:RightValue stringValue=""/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <L7p:Regex>
                                <L7p:AutoTarget booleanValue="false"/>
                                <L7p:OtherTargetMessageVariable stringValue="MessageHeaderTrace.result"/>
                                <L7p:Regex stringValue="&quot;eventID&quot;:&quot;.+?,"/>
                                <L7p:Replace booleanValue="true"/>
                                <L7p:Replacement stringValue="&quot;eventID&quot;: &quot;${requestId}&quot;,"/>
                                <L7p:Target target="OTHER"/>
                            </L7p:Regex>
                        </wsp:All>
                        <wsp:All wsp:Usage="Required">
                            <L7p:EvaluateJsonPathExpression>
                                <L7p:Expression stringValue="$.RequestHeader.Trace"/>
                                <L7p:VariablePrefix stringValue="Track"/>
                            </L7p:EvaluateJsonPathExpression>
                            <L7p:EvaluateJsonPathExpression>
                                <L7p:Expression stringValue=".Trace.eventID"/>
                                <L7p:VariablePrefix stringValue="eventID"/>
                            </L7p:EvaluateJsonPathExpression>
                            <L7p:EvaluateJsonPathExpression>
                                <L7p:Expression stringValue=".Trace.clientReqTimestamp"/>
                                <L7p:VariablePrefix stringValue="clientReqTimestamp"/>
                            </L7p:EvaluateJsonPathExpression>
                            <wsp:OneOrMore wsp:Usage="Required">
                                <wsp:All wsp:Usage="Required">
                                    <wsp:All wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${eventID.count}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="int"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:RightValue stringValue="0"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${clientReqTimestamp.count}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="int"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:RightValue stringValue="0"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    </wsp:All>
                                    <L7p:JsonTransformation>
                                    <L7p:DestinationMessageTarget MessageTarget="included">

                                    <L7p:OtherTargetMessageVariable stringValue="TraceXML"/>
                                    <L7p:Target target="OTHER"/>
                                    <L7p:TargetModifiedByGateway booleanValue="true"/>
                                    </L7p:DestinationMessageTarget>
                                    <L7p:RootTagString stringValue="root"/>
                                    <L7p:Target target="REQUEST"/>
                                    <L7p:Transformation transformation="JSON_to_XML"/>
                                    </L7p:JsonTransformation>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="PGNsaWVudFJlcVRpbWVzdGFtcD4ke3JlcXVlc3QudGltZS5sb2NhbC55eXl5LU1NLWRkJ1QnSEg6bW06c3MuU1NTJ1onfTwvY2xpZW50UmVxVGltZXN0YW1wPg=="/>
                                    <L7p:VariableToSet stringValue="timestamp"/>
                                    </L7p:SetVariable>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="PGV2ZW50SUQ+JHtyZXF1ZXN0SWR9PC9ldmVudElEPg=="/>
                                    <L7p:VariableToSet stringValue="rspTimestamp"/>
                                    </L7p:SetVariable>
                                    <L7p:ResponseXpathAssertion>
                                    <L7p:VariablePrefix stringValue=""/>
                                    <L7p:XmlMsgSrc stringValue="TraceXML"/>
                                    <L7p:XpathExpression xpathExpressionValue="included">
                                    <L7p:Expression stringValue="/root/RequestHeader/Trace/sourceID"/>
                                    <L7p:Namespaces mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="s"/>
                                    <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                    </L7p:entry>
                                    </L7p:Namespaces>
                                    <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
                                    </L7p:XpathExpression>
                                    </L7p:ResponseXpathAssertion>
                                    <L7p:RemoveElement>
                                    <L7p:ElementFromVariable stringValue="responseXpath.elements[0]"/>
                                    <L7p:ElementToInsertVariable stringValue="rspTimestamp"/>
                                    <L7p:InsertedElementLocation insertedElementLocation="NEXT_SIBLING"/>
                                    <L7p:OtherTargetMessageVariable stringValue="TraceXML"/>
                                    <L7p:Target target="OTHER"/>
                                    </L7p:RemoveElement>
                                    <L7p:RemoveElement>
                                    <L7p:ElementFromVariable stringValue="responseXpath.elements[0]"/>
                                    <L7p:ElementToInsertVariable stringValue="timestamp"/>
                                    <L7p:InsertedElementLocation insertedElementLocation="NEXT_SIBLING"/>
                                    <L7p:OtherTargetMessageVariable stringValue="TraceXML"/>
                                    <L7p:Target target="OTHER"/>
                                    </L7p:RemoveElement>
                                    <L7p:JsonTransformation>
                                    <L7p:DestinationMessageTarget MessageTarget="included">

                                    <L7p:OtherTargetMessageVariable stringValue="TraceJson"/>
                                    <L7p:Target target="OTHER"/>
                                    <L7p:TargetModifiedByGateway booleanValue="true"/>
                                    </L7p:DestinationMessageTarget>
                                    <L7p:OtherTargetMessageVariable stringValue="TraceXML"/>
                                    <L7p:RootTagString stringValue=""/>
                                    <L7p:Target target="OTHER"/>
                                    </L7p:JsonTransformation>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtUcmFjZUpzb259"/>
                                    <L7p:VariableToSet stringValue="MessageHeaderTrace.result"/>
                                    </L7p:SetVariable>
                                    <L7p:EvaluateJsonPathExpression>
                                    <L7p:Expression stringValue=".Trace"/>
                                    <L7p:OtherTargetMessageVariable stringValue="TraceJson"/>
                                    <L7p:Target target="OTHER"/>
                                    <L7p:VariablePrefix stringValue="MessageHeaderTrace"/>
                                    </L7p:EvaluateJsonPathExpression>
                                </wsp:All>
                                <wsp:All wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>
                                    <L7p:Expression1 stringValue="${eventID.count}"/>
                                    <L7p:Expression2 stringValue="0"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item binary="included">
                                    <L7p:RightValue stringValue="0"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:JsonTransformation>
                                    <L7p:DestinationMessageTarget MessageTarget="included">

                                    <L7p:OtherTargetMessageVariable stringValue="TraceXML"/>
                                    <L7p:Target target="OTHER"/>
                                    <L7p:TargetModifiedByGateway booleanValue="true"/>
                                    </L7p:DestinationMessageTarget>
                                    <L7p:RootTagString stringValue="root"/>
                                    <L7p:Target target="REQUEST"/>
                                    <L7p:Transformation transformation="JSON_to_XML"/>
                                    </L7p:JsonTransformation>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="PGV2ZW50SUQ+JHtyZXF1ZXN0SWR9PC9ldmVudElEPg=="/>
                                    <L7p:VariableToSet stringValue="rspTimestamp"/>
                                    </L7p:SetVariable>
                                    <L7p:ResponseXpathAssertion>
                                    <L7p:VariablePrefix stringValue=""/>
                                    <L7p:XmlMsgSrc stringValue="TraceXML"/>
                                    <L7p:XpathExpression xpathExpressionValue="included">
                                    <L7p:Expression stringValue="/root/RequestHeader/Trace/sourceID"/>
                                    <L7p:Namespaces mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="s"/>
                                    <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                    </L7p:entry>
                                    </L7p:Namespaces>
                                    <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
                                    </L7p:XpathExpression>
                                    </L7p:ResponseXpathAssertion>
                                    <L7p:RemoveElement>
                                    <L7p:ElementFromVariable stringValue="responseXpath.elements[0]"/>
                                    <L7p:ElementToInsertVariable stringValue="rspTimestamp"/>
                                    <L7p:InsertedElementLocation insertedElementLocation="NEXT_SIBLING"/>
                                    <L7p:OtherTargetMessageVariable stringValue="TraceXML"/>
                                    <L7p:Target target="OTHER"/>
                                    </L7p:RemoveElement>
                                    <L7p:JsonTransformation>
                                    <L7p:DestinationMessageTarget MessageTarget="included">

                                    <L7p:OtherTargetMessageVariable stringValue="TraceJson"/>
                                    <L7p:Target target="OTHER"/>
                                    <L7p:TargetModifiedByGateway booleanValue="true"/>
                                    </L7p:DestinationMessageTarget>
                                    <L7p:OtherTargetMessageVariable stringValue="TraceXML"/>
                                    <L7p:RootTagString stringValue=""/>
                                    <L7p:Target target="OTHER"/>
                                    </L7p:JsonTransformation>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtUcmFjZUpzb259"/>
                                    <L7p:VariableToSet stringValue="MessageHeaderTrace.result"/>
                                    </L7p:SetVariable>
                                    <L7p:EvaluateJsonPathExpression>
                                    <L7p:Expression stringValue=".Trace"/>
                                    <L7p:OtherTargetMessageVariable stringValue="TraceJson"/>
                                    <L7p:Target target="OTHER"/>
                                    <L7p:VariablePrefix stringValue="MessageHeaderTrace"/>
                                    </L7p:EvaluateJsonPathExpression>
                                </wsp:All>
                                <wsp:All wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>
                                    <L7p:Expression1 stringValue="${clientReqTimestamp.count}"/>
                                    <L7p:Expression2 stringValue="0"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item binary="included">
                                    <L7p:RightValue stringValue="0"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:JsonTransformation>
                                    <L7p:DestinationMessageTarget MessageTarget="included">

                                    <L7p:OtherTargetMessageVariable stringValue="TraceXML"/>
                                    <L7p:Target target="OTHER"/>
                                    <L7p:TargetModifiedByGateway booleanValue="true"/>
                                    </L7p:DestinationMessageTarget>
                                    <L7p:RootTagString stringValue="root"/>
                                    <L7p:Target target="REQUEST"/>
                                    <L7p:Transformation transformation="JSON_to_XML"/>
                                    </L7p:JsonTransformation>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="PGNsaWVudFJlcVRpbWVzdGFtcD4ke3JlcXVlc3QudGltZS5sb2NhbC55eXl5LU1NLWRkJ1QnSEg6bW06c3MuU1NTJ1onfTwvY2xpZW50UmVxVGltZXN0YW1wPg=="/>
                                    <L7p:VariableToSet stringValue="timestamp"/>
                                    </L7p:SetVariable>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="PGV2ZW50SUQ+JHtyZXF1ZXN0SWR9PC9ldmVudElEPg=="/>
                                    <L7p:VariableToSet stringValue="rspTimestamp"/>
                                    </L7p:SetVariable>
                                    <L7p:ResponseXpathAssertion>
                                    <L7p:VariablePrefix stringValue=""/>
                                    <L7p:XmlMsgSrc stringValue="TraceXML"/>
                                    <L7p:XpathExpression xpathExpressionValue="included">
                                    <L7p:Expression stringValue="/root/RequestHeader/Trace/sourceID"/>
                                    <L7p:Namespaces mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="s"/>
                                    <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                    </L7p:entry>
                                    </L7p:Namespaces>
                                    <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
                                    </L7p:XpathExpression>
                                    </L7p:ResponseXpathAssertion>
                                    <L7p:RemoveElement>
                                    <L7p:ElementFromVariable stringValue="responseXpath.elements[0]"/>
                                    <L7p:ElementToInsertVariable stringValue="rspTimestamp"/>
                                    <L7p:InsertedElementLocation insertedElementLocation="NEXT_SIBLING"/>
                                    <L7p:OtherTargetMessageVariable stringValue="TraceXML"/>
                                    <L7p:Target target="OTHER"/>
                                    </L7p:RemoveElement>
                                    <L7p:RemoveElement>
                                    <L7p:ElementFromVariable stringValue="responseXpath.elements[0]"/>
                                    <L7p:ElementToInsertVariable stringValue="timestamp"/>
                                    <L7p:InsertedElementLocation insertedElementLocation="NEXT_SIBLING"/>
                                    <L7p:OtherTargetMessageVariable stringValue="TraceXML"/>
                                    <L7p:Target target="OTHER"/>
                                    </L7p:RemoveElement>
                                    <L7p:JsonTransformation>
                                    <L7p:DestinationMessageTarget MessageTarget="included">

                                    <L7p:OtherTargetMessageVariable stringValue="TraceJson"/>
                                    <L7p:Target target="OTHER"/>
                                    <L7p:TargetModifiedByGateway booleanValue="true"/>
                                    </L7p:DestinationMessageTarget>
                                    <L7p:OtherTargetMessageVariable stringValue="TraceXML"/>
                                    <L7p:RootTagString stringValue=""/>
                                    <L7p:Target target="OTHER"/>
                                    </L7p:JsonTransformation>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtUcmFjZUpzb259"/>
                                    <L7p:VariableToSet stringValue="MessageHeaderTrace.result"/>
                                    </L7p:SetVariable>
                                    <L7p:EvaluateJsonPathExpression>
                                    <L7p:Expression stringValue=".Trace"/>
                                    <L7p:OtherTargetMessageVariable stringValue="TraceJson"/>
                                    <L7p:Target target="OTHER"/>
                                    <L7p:VariablePrefix stringValue="MessageHeaderTrace"/>
                                    </L7p:EvaluateJsonPathExpression>
                                </wsp:All>
                            </wsp:OneOrMore>
                        </wsp:All>
                    </wsp:OneOrMore>
                </wsp:All>
                <wsp:All wsp:Usage="Required">
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="ew0KCSJjbGllbnRSZXFUaW1lc3RhbXAiOiAiJHtyZXF1ZXN0LnRpbWUubG9jYWwueXl5eS1NTS1kZCdUJ0hIOm1tOnNzLlNTUydaJ30iLA0KCSJldmVudElEIjogIiR7cmVxdWVzdElkfSINCn0="/>
                        <L7p:VariableToSet stringValue="MessageHeaderTrace.result"/>
                    </L7p:SetVariable>
                </wsp:All>
            </wsp:OneOrMore>
            <wsp:OneOrMore wsp:Usage="Required">
                <wsp:All wsp:Usage="Required">
                    <L7p:EvaluateJsonPathExpression>
                        <L7p:Expression stringValue="$.Body"/>
                        <L7p:VariablePrefix stringValue="body"/>
                    </L7p:EvaluateJsonPathExpression>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="ew0KICAgIlJlcXVlc3RIZWFkZXIiOiB7DQogICAgICAiQ29uc3VtZXIiOiAke01lc3NhZ2VIZWFkZXJDb25zdW1lci5yZXN1bHR9LA0KICAgICAgIlRyYWNlIjogJHtNZXNzYWdlSGVhZGVyVHJhY2UucmVzdWx0fSwNCiAgICAgICJDaGFubmVsIjogJHtNZXNzYWdlSGVhZGVyQ2hhbm5lbC5yZXN1bHR9DQogICB9LA0KICAgIkJvZHkiOiAke2JvZHkucmVzdWx0fQ0KfQ0K"/>
                        <L7p:ContentType stringValue="application/json; charset=utf-8"/>
                        <L7p:DataType variableDataType="message"/>
                        <L7p:VariableToSet stringValue="Request"/>
                    </L7p:SetVariable>
                </wsp:All>
                <wsp:All wsp:Usage="Required">
                    <L7p:CustomizeErrorResponse>
                        <L7p:Content stringValueReference="inline"><![CDATA[{
 "Error": "Invalid  Body"
}]]></L7p:Content>
                        <L7p:ContentType stringValue="application/json; charset=utf-8"/>
                        <L7p:ExtraHeaders nameValuePairArray="included"/>
                    </L7p:CustomizeErrorResponse>
                    <L7p:RaiseError/>
                </wsp:All>
            </wsp:OneOrMore>
        </wsp:All>
    </wsp:All>
</wsp:Policy>