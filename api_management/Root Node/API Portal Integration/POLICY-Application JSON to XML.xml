<?xml version="1.0" encoding="UTF-8"?>
<wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy">
    <wsp:All wsp:Usage="Required">
        <L7p:CommentAssertion>
            <L7p:Comment stringValue="************************************************************************************"/>
        </L7p:CommentAssertion>
        <L7p:CommentAssertion>
            <L7p:Comment stringValue="* Policy for transforming portal application json into xml"/>
        </L7p:CommentAssertion>
        <L7p:CommentAssertion>
            <L7p:Comment stringValue="*"/>
        </L7p:CommentAssertion>
        <L7p:CommentAssertion>
            <L7p:Comment stringValue="************************************************************************************"/>
        </L7p:CommentAssertion>
        <L7p:EvaluateJsonPathExpression>
            <L7p:Expression stringValue="Key"/>
            <L7p:OtherTargetMessageVariable stringValue="props"/>
            <L7p:Target target="OTHER"/>
            <L7p:VariablePrefix stringValue="apiKey"/>
        </L7p:EvaluateJsonPathExpression>
        <L7p:EvaluateJsonPathExpression>
            <L7p:Expression stringValue="Status"/>
            <L7p:OtherTargetMessageVariable stringValue="props"/>
            <L7p:Target target="OTHER"/>
            <L7p:VariablePrefix stringValue="status"/>
        </L7p:EvaluateJsonPathExpression>
        <L7p:EvaluateJsonPathExpression>
            <L7p:Expression stringValue="Secret"/>
            <L7p:OtherTargetMessageVariable stringValue="props"/>
            <L7p:Target target="OTHER"/>
            <L7p:VariablePrefix stringValue="secret"/>
        </L7p:EvaluateJsonPathExpression>
        <L7p:EvaluateJsonPathExpression>
            <L7p:Expression stringValue="AccountPlanMappingId"/>
            <L7p:OtherTargetMessageVariable stringValue="props"/>
            <L7p:Target target="OTHER"/>
            <L7p:VariablePrefix stringValue="mappingId"/>
        </L7p:EvaluateJsonPathExpression>
        <L7p:EvaluateJsonPathExpression>
            <L7p:Expression stringValue="AccountPlanMappingName"/>
            <L7p:OtherTargetMessageVariable stringValue="props"/>
            <L7p:Target target="OTHER"/>
            <L7p:VariablePrefix stringValue="mappingName"/>
        </L7p:EvaluateJsonPathExpression>
        <L7p:EvaluateJsonPathExpression>
            <L7p:Expression stringValue="ApplicationId"/>
            <L7p:OtherTargetMessageVariable stringValue="props"/>
            <L7p:Target target="OTHER"/>
            <L7p:VariablePrefix stringValue="applicationId"/>
        </L7p:EvaluateJsonPathExpression>
        <L7p:EvaluateJsonPathExpression>
            <L7p:Expression stringValue="OAuthCallbackUrl"/>
            <L7p:OtherTargetMessageVariable stringValue="props"/>
            <L7p:Target target="OTHER"/>
            <L7p:VariablePrefix stringValue="OAuthCallbackUrl"/>
        </L7p:EvaluateJsonPathExpression>
        <L7p:EvaluateJsonPathExpression>
            <L7p:Expression stringValue="OAuthScope"/>
            <L7p:OtherTargetMessageVariable stringValue="props"/>
            <L7p:Target target="OTHER"/>
            <L7p:VariablePrefix stringValue="OAuthScope"/>
        </L7p:EvaluateJsonPathExpression>
        <L7p:EvaluateJsonPathExpression>
            <L7p:Expression stringValue="OAuthType"/>
            <L7p:OtherTargetMessageVariable stringValue="props"/>
            <L7p:Target target="OTHER"/>
            <L7p:VariablePrefix stringValue="OAuthType"/>
        </L7p:EvaluateJsonPathExpression>
        <L7p:EvaluateJsonPathExpression>
            <L7p:Expression stringValue="Label"/>
            <L7p:OtherTargetMessageVariable stringValue="props"/>
            <L7p:Target target="OTHER"/>
            <L7p:VariablePrefix stringValue="label"/>
        </L7p:EvaluateJsonPathExpression>
        <L7p:Encapsulated>
            <L7p:EncapsulatedAssertionConfigGuid stringValue="5821066a-15a6-4523-a8f7-3d159129cdb5"/>
            <L7p:EncapsulatedAssertionConfigName stringValue="Portal Escape XML"/>
            <L7p:Parameters mapValue="included">
                <L7p:entry>
                    <L7p:key stringValue="escapedXml"/>
                    <L7p:value stringValue="${label.result}"/>
                </L7p:entry>
            </L7p:Parameters>
        </L7p:Encapsulated>
        <L7p:SetVariable>
            <L7p:Base64Expression stringValue="JHtlc2NhcGVkWG1sfQ=="/>
            <L7p:VariableToSet stringValue="escapedLabel"/>
        </L7p:SetVariable>
        <L7p:EncodeDecode>
            <L7p:SourceVariableName stringValue="OAuthCallbackUrl.result"/>
            <L7p:TargetDataType variableDataType="string"/>
            <L7p:TargetVariableName stringValue="OAuthCallbackUrl.result"/>
            <L7p:TransformType transformType="URL_ENCODE"/>
        </L7p:EncodeDecode>
        <L7p:Encapsulated>
            <L7p:EncapsulatedAssertionConfigGuid stringValue="5821066a-15a6-4523-a8f7-3d159129cdb5"/>
            <L7p:EncapsulatedAssertionConfigName stringValue="Portal Escape XML"/>
            <L7p:Parameters mapValue="included">
                <L7p:entry>
                    <L7p:key stringValue="escapedXml"/>
                    <L7p:value stringValue="${OAuthCallbackUrl.result}"/>
                </L7p:entry>
            </L7p:Parameters>
        </L7p:Encapsulated>
        <L7p:SetVariable>
            <L7p:Base64Expression stringValue="JHtlc2NhcGVkWG1sfQ=="/>
            <L7p:VariableToSet stringValue="OAuthUrlEscaped"/>
        </L7p:SetVariable>
        <L7p:Encapsulated>
            <L7p:EncapsulatedAssertionConfigGuid stringValue="5821066a-15a6-4523-a8f7-3d159129cdb5"/>
            <L7p:EncapsulatedAssertionConfigName stringValue="Portal Escape XML"/>
            <L7p:Parameters mapValue="included">
                <L7p:entry>
                    <L7p:key stringValue="escapedXml"/>
                    <L7p:value stringValue="${OAuthScope.result}"/>
                </L7p:entry>
            </L7p:Parameters>
        </L7p:Encapsulated>
        <L7p:SetVariable>
            <L7p:Base64Expression stringValue="JHtlc2NhcGVkWG1sfQ=="/>
            <L7p:VariableToSet stringValue="OAuthScopeEscaped"/>
        </L7p:SetVariable>
        <L7p:Encapsulated>
            <L7p:EncapsulatedAssertionConfigGuid stringValue="5821066a-15a6-4523-a8f7-3d159129cdb5"/>
            <L7p:EncapsulatedAssertionConfigName stringValue="Portal Escape XML"/>
            <L7p:Parameters mapValue="included">
                <L7p:entry>
                    <L7p:key stringValue="escapedXml"/>
                    <L7p:value stringValue="${mappingName.result}"/>
                </L7p:entry>
            </L7p:Parameters>
        </L7p:Encapsulated>
        <L7p:SetVariable>
            <L7p:Base64Expression stringValue="JHtlc2NhcGVkWG1sfQ=="/>
            <L7p:VariableToSet stringValue="mappingNameEscaped"/>
        </L7p:SetVariable>
        <L7p:SetVariable>
            <L7p:Base64Expression stringValue=""/>
            <L7p:DataType variableDataType="dateTime"/>
            <L7p:DateOffsetExpression stringValue=""/>
            <L7p:VariableToSet stringValue="date"/>
        </L7p:SetVariable>
        <L7p:SetVariable>
            <L7p:AssertionComment assertionComment="included">
                <L7p:Properties mapValue="included">
                    <L7p:entry>
                        <L7p:key stringValue="LEFT.COMMENT"/>
                        <L7p:value stringValue="build api key xml"/>
                    </L7p:entry>
                </L7p:Properties>
            </L7p:AssertionComment>
            <L7p:Base64Expression stringValue="PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4NCjxsNzpBcGlLZXkgeG1sbnM6bDc9Imh0dHA6Ly9ucy5sN3RlY2guY29tLzIwMTIvMDQvYXBpLW1hbmFnZW1lbnQiPg0KICAgICAgIDxsNzpLZXk+JHthcGlLZXkucmVzdWx0fTwvbDc6S2V5Pg0KICAgICAgIDxsNzpTdGF0dXM+JHtzdGF0dXMucmVzdWx0fTwvbDc6U3RhdHVzPg0KICAgICAgIDxsNzpBcGlzLz4NCiAgICAgICA8bDc6U2VjcmV0PiR7c2VjcmV0LnJlc3VsdH08L2w3OlNlY3JldD4NCiAgICAgICA8bDc6QWNjb3VudFBsYW5NYXBwaW5nSWQ+JHttYXBwaW5nSWQucmVzdWx0fTwvbDc6QWNjb3VudFBsYW5NYXBwaW5nSWQ+DQogICAgICAgPGw3OkFjY291bnRQbGFuTWFwcGluZ05hbWU+JHttYXBwaW5nTmFtZUVzY2FwZWR9PC9sNzpBY2NvdW50UGxhbk1hcHBpbmdOYW1lPg0KICAgICAgIDxsNzpBcHBsaWNhdGlvbklkPiR7YXBwbGljYXRpb25JZC5yZXN1bHR9PC9sNzpBcHBsaWNhdGlvbklkPg0KICAgICAgIDxsNzpMYWJlbD4ke2VzY2FwZWRMYWJlbH08L2w3OkxhYmVsPg0KICAgICAgIDxsNzpQbGF0Zm9ybS8+DQogICAgICAgIDxsNzpTZWN1cml0eT4NCiAgICAgICAgICAgIDxsNzpPQXV0aD4NCiAgICAgICAgICAgICAgICA8bDc6Q2FsbGJhY2tVcmw+JHtPQXV0aFVybEVzY2FwZWR9PC9sNzpDYWxsYmFja1VybD4NCiAgICAgICAgICAgICAgICA8bDc6U2NvcGU+JHtPQXV0aFNjb3BlRXNjYXBlZH08L2w3OlNjb3BlPg0KICAgICAgICAgICAgICAgIDxsNzpUeXBlPiR7T0F1dGhUeXBlLnJlc3VsdH08L2w3OlR5cGU+DQogICAgICAgICAgICA8L2w3Ok9BdXRoPg0KICAgICAgICA8L2w3OlNlY3VyaXR5Pg0KPC9sNzpBcGlLZXk+"/>
            <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
            <L7p:DataType variableDataType="message"/>
            <L7p:VariableToSet stringValue="apiKeyXml"/>
        </L7p:SetVariable>
        <L7p:EvaluateJsonPathExpression>
            <L7p:Expression stringValue="Apis"/>
            <L7p:OtherTargetMessageVariable stringValue="props"/>
            <L7p:Target target="OTHER"/>
            <L7p:VariablePrefix stringValue="services"/>
        </L7p:EvaluateJsonPathExpression>
        <L7p:ResponseXpathAssertion>
            <L7p:AssertionComment assertionComment="included">
                <L7p:Properties mapValue="included">
                    <L7p:entry>
                        <L7p:key stringValue="LEFT.COMMENT"/>
                        <L7p:value stringValue="find apis element"/>
                    </L7p:entry>
                </L7p:Properties>
            </L7p:AssertionComment>
            <L7p:VariablePrefix stringValue="servicesElement"/>
            <L7p:XmlMsgSrc stringValue="apiKeyXml"/>
            <L7p:XpathExpression xpathExpressionValue="included">
                <L7p:Expression stringValue="/l7:ApiKey/l7:Apis"/>
                <L7p:Namespaces mapValue="included">
                    <L7p:entry>
                        <L7p:key stringValue="l7"/>
                        <L7p:value stringValue="http://ns.l7tech.com/2012/04/api-management"/>
                    </L7p:entry>
                    <L7p:entry>
                        <L7p:key stringValue="s"/>
                        <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                    </L7p:entry>
                    <L7p:entry>
                        <L7p:key stringValue="L7p"/>
                        <L7p:value stringValue="http://www.layer7tech.com/ws/policy"/>
                    </L7p:entry>
                    <L7p:entry>
                        <L7p:key stringValue="wsp"/>
                        <L7p:value stringValue="http://schemas.xmlsoap.org/ws/2002/12/policy"/>
                    </L7p:entry>
                </L7p:Namespaces>
                <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
            </L7p:XpathExpression>
        </L7p:ResponseXpathAssertion>
        <L7p:ForEachLoop L7p:Usage="Required"
            loopVariable="services.results" variablePrefix="service">
            <L7p:SetVariable>
                <L7p:Base64Expression stringValue="JHtzZXJ2aWNlLmN1cnJlbnR9"/>
                <L7p:ContentType stringValue="application/json; charset=utf-8"/>
                <L7p:DataType variableDataType="message"/>
                <L7p:VariableToSet stringValue="serviceJson"/>
            </L7p:SetVariable>
            <L7p:EvaluateJsonPathExpression>
                <L7p:Expression stringValue="ApiId"/>
                <L7p:OtherTargetMessageVariable stringValue="serviceJson"/>
                <L7p:Target target="OTHER"/>
                <L7p:VariablePrefix stringValue="serviceId"/>
            </L7p:EvaluateJsonPathExpression>
            <L7p:SetVariable>
                <L7p:Base64Expression stringValue="JHtzZXJ2aWNlSWQucmVzdWx0fQ=="/>
                <L7p:VariableToSet stringValue="serviceId"/>
            </L7p:SetVariable>
            <L7p:EvaluateJsonPathExpression>
                <L7p:Expression stringValue="PlanId"/>
                <L7p:OtherTargetMessageVariable stringValue="serviceJson"/>
                <L7p:Target target="OTHER"/>
                <L7p:VariablePrefix stringValue="servicePlan"/>
            </L7p:EvaluateJsonPathExpression>
            <L7p:SetVariable>
                <L7p:Base64Expression stringValue="JHtzZXJ2aWNlUGxhbi5yZXN1bHR9"/>
                <L7p:VariableToSet stringValue="servicePlan"/>
            </L7p:SetVariable>
            <L7p:SetVariable>
                <L7p:Base64Expression stringValue="PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4NCjxsNzpBcGkgYXBpSWQ9IiR7c2VydmljZUlkfSIgcGxhbklkPSIke3NlcnZpY2VQbGFufSIgeG1sbnM6bDc9Imh0dHA6Ly9ucy5sN3RlY2guY29tLzIwMTIvMDQvYXBpLW1hbmFnZW1lbnQiLz4="/>
                <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                <L7p:DataType variableDataType="message"/>
                <L7p:VariableToSet stringValue="serviceElement"/>
            </L7p:SetVariable>
            <L7p:RemoveElement>
                <L7p:ElementFromVariable stringValue="servicesElement.elements[0]"/>
                <L7p:ElementToInsertVariable stringValue="serviceElement.mainpart"/>
                <L7p:InsertedElementLocation insertedElementLocation="LAST_CHILD"/>
                <L7p:OtherTargetMessageVariable stringValue="apiKeyXml"/>
                <L7p:Target target="OTHER"/>
            </L7p:RemoveElement>
            <L7p:assertionComment>
                <L7p:Properties mapValue="included">
                    <L7p:entry>
                        <L7p:key stringValue="LEFT.COMMENT"/>
                        <L7p:value stringValue="build apis element"/>
                    </L7p:entry>
                </L7p:Properties>
            </L7p:assertionComment>
        </L7p:ForEachLoop>
    </wsp:All>
</wsp:Policy>