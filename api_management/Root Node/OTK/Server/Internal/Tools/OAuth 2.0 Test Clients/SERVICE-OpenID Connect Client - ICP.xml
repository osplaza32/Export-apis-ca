<?xml version="1.0" encoding="UTF-8"?>
<wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy">
    <wsp:All wsp:Usage="Required">
        <L7p:SslAssertion/>
        <L7p:Encapsulated>
            <L7p:EncapsulatedAssertionConfigGuid stringValue="51740c0b-11c5-455e-92a0-a1f915264eb0"/>
            <L7p:EncapsulatedAssertionConfigName stringValue="OTK Client Context Variables"/>
        </L7p:Encapsulated>
        <wsp:OneOrMore wsp:Usage="Required">
            <wsp:All wsp:Usage="Required">
                <L7p:ComparisonAssertion>
                    <L7p:Expression1 stringValue="${request.http.parameter.access_token}"/>
                    <L7p:Expression2 stringValue=""/>
                    <L7p:ExpressionIsVariable booleanValue="false"/>
                    <L7p:Negate booleanValue="true"/>
                    <L7p:Operator operator="EMPTY"/>
                    <L7p:Predicates predicates="included">
                        <L7p:item binary="included">
                            <L7p:Negated booleanValue="true"/>
                            <L7p:Operator operator="EMPTY"/>
                            <L7p:RightValue stringValue=""/>
                        </L7p:item>
                    </L7p:Predicates>
                </L7p:ComparisonAssertion>
                <L7p:ComparisonAssertion>
                    <L7p:CaseSensitive booleanValue="false"/>
                    <L7p:Expression1 stringValue="${request.http.parameter.state}"/>
                    <L7p:Expression2 stringValue="pr"/>
                    <L7p:ExpressionIsVariable booleanValue="false"/>
                    <L7p:Predicates predicates="included">
                        <L7p:item binary="included">
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:RightValue stringValue="pr"/>
                        </L7p:item>
                    </L7p:Predicates>
                </L7p:ComparisonAssertion>
                <L7p:HttpRoutingAssertion>
                    <L7p:ProtectedServiceUrl stringValue="${location_resourceendpoint}?access_token=${request.http.parameter.access_token}"/>
                    <L7p:ProxyPassword stringValueNull="null"/>
                    <L7p:ProxyUsername stringValueNull="null"/>
                    <L7p:RequestHeaderRules httpPassthroughRuleSet="included">
                        <L7p:Rules httpPassthroughRules="included"/>
                    </L7p:RequestHeaderRules>
                    <L7p:RequestParamRules httpPassthroughRuleSet="included">
                        <L7p:Rules httpPassthroughRules="included"/>
                    </L7p:RequestParamRules>
                    <L7p:ResponseHeaderRules httpPassthroughRuleSet="included">
                        <L7p:Rules httpPassthroughRules="included">
                            <L7p:item httpPassthroughRule="included">
                                <L7p:Name stringValue="Set-Cookie"/>
                            </L7p:item>
                        </L7p:Rules>
                    </L7p:ResponseHeaderRules>
                    <L7p:SamlAssertionVersion intValue="2"/>
                </L7p:HttpRoutingAssertion>
                <L7p:assertionComment>
                    <L7p:Properties mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="LEFT.COMMENT"/>
                            <L7p:value stringValue="Call the protected resource endpoint"/>
                        </L7p:entry>
                    </L7p:Properties>
                </L7p:assertionComment>
            </wsp:All>
            <wsp:All wsp:Usage="Required">
                <L7p:ComparisonAssertion>
                    <L7p:CaseSensitive booleanValue="false"/>
                    <L7p:Expression1 stringValue="${request.url.path}"/>
                    <L7p:Operator operatorNull="null"/>
                    <L7p:Predicates predicates="included">
                        <L7p:item regex="included">
                            <L7p:Pattern stringValue=".+/icp"/>
                        </L7p:item>
                    </L7p:Predicates>
                </L7p:ComparisonAssertion>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmNvZGV9"/>
                    <L7p:VariableToSet stringValue="code"/>
                </L7p:SetVariable>
                <wsp:All wsp:Usage="Required">
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="JHtjbGllbnRfc2VjcmV0X2ljcH0="/>
                        <L7p:VariableToSet stringValue="client_secret_display"/>
                    </L7p:SetVariable>
                    <L7p:Regex>
                        <L7p:AutoTarget booleanValue="false"/>
                        <L7p:CaptureVar stringValue="client_secret_front"/>
                        <L7p:OtherTargetMessageVariable stringValue="client_secret_display"/>
                        <L7p:Regex stringValue="^(.{5})"/>
                        <L7p:Replace booleanValue="true"/>
                        <L7p:Replacement stringValue=""/>
                        <L7p:Target target="OTHER"/>
                    </L7p:Regex>
                    <L7p:Regex>
                        <L7p:AutoTarget booleanValue="false"/>
                        <L7p:CaptureVar stringValue="client_secret_end"/>
                        <L7p:OtherTargetMessageVariable stringValue="client_secret_display"/>
                        <L7p:Regex stringValue="(.{5})$"/>
                        <L7p:Replace booleanValue="true"/>
                        <L7p:Replacement stringValue=""/>
                        <L7p:Target target="OTHER"/>
                    </L7p:Regex>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="JHtjbGllbnRfc2VjcmV0X2Zyb250WzFdfSAuLi4gJHtjbGllbnRfc2VjcmV0X2VuZFsxXX0="/>
                        <L7p:VariableToSet stringValue="client_secret_display"/>
                    </L7p:SetVariable>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="LEFT.COMMENT"/>
                                <L7p:value stringValue="Compute the client_secret for display"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:All>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="dG9rZW4gaWRfdG9rZW4="/>
                    <L7p:VariableToSet stringValue="response_type"/>
                </L7p:SetVariable>
                <wsp:OneOrMore wsp:Usage="Required">
                    <wsp:All wsp:Usage="Required">
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${request.http.parameter.state}"/>
                            <L7p:Expression2 stringValue="view"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="view"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:ComparisonAssertion>
                            <L7p:Expression1 stringValue="${code}"/>
                            <L7p:Expression2 stringValue=""/>
                            <L7p:Negate booleanValue="true"/>
                            <L7p:Operator operator="EMPTY"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item binary="included">
                                    <L7p:Negated booleanValue="true"/>
                                    <L7p:Operator operator="EMPTY"/>
                                    <L7p:RightValue stringValue=""/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <wsp:OneOrMore wsp:Usage="Required">
                            <wsp:All wsp:Usage="Required">
                                <L7p:Encapsulated>
                                    <L7p:EncapsulatedAssertionConfigGuid stringValue="4e4bc164-3fa2-4b15-ba65-31cef45b84b0"/>
                                    <L7p:EncapsulatedAssertionConfigName stringValue="OTK Session GET"/>
                                    <L7p:Parameters mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="cacheAge"/>
                                    <L7p:value stringValue="300"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="cacheId"/>
                                    <L7p:value stringValue="tokenResult"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="cacheKey"/>
                                    <L7p:value stringValue="${code}"/>
                                    </L7p:entry>
                                    </L7p:Parameters>
                                </L7p:Encapsulated>
                                <L7p:ResponseXpathAssertion>
                                    <L7p:VariablePrefix stringValue="sessionValue"/>
                                    <L7p:XmlMsgSrc stringValue="resp"/>
                                    <L7p:XpathExpression xpathExpressionValue="included">
                                    <L7p:Expression stringValue="/ns:found/ns:value/text()"/>
                                    <L7p:Namespaces mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="ns"/>
                                    <L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-session"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="s"/>
                                    <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                    </L7p:entry>
                                    </L7p:Namespaces>
                                    <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
                                    </L7p:XpathExpression>
                                </L7p:ResponseXpathAssertion>
                                <L7p:EncodeDecode>
                                    <L7p:SourceVariableName stringValue="sessionValue.result"/>
                                    <L7p:TargetContentType stringValue="text/html;charset=UTF-8"/>
                                    <L7p:TargetDataType variableDataType="message"/>
                                    <L7p:TargetVariableName stringValue="tokenResult"/>
                                    <L7p:TransformType transformType="URL_DECODE"/>
                                </L7p:EncodeDecode>
                                <L7p:HardcodedResponse>
                                    <L7p:Base64ResponseBody stringValue="JHtodG1sVGVtcGxhdGVUb3B9CjxoMT5HcmFudCB0eXBlOiBJbXBsaWNpdCB3aXRoIE9wZW5JRCBDb25uZWN0PC9oMT4KJHt0b2tlblJlc3VsdC5tYWlucGFydH0KJHtodG1sVGVtcGxhdGVCb3R0b219"/>
                                    <L7p:ResponseContentType stringValue="text/html;charset=UTF-8"/>
                                </L7p:HardcodedResponse>
                            </wsp:All>
                            <L7p:HardcodedResponse>
                                <L7p:Base64ResponseBody stringValue="JHtodG1sVGVtcGxhdGVUb3B9DQo8aDE+R3JhbnQgdHlwZTogSW1wbGljaXQgd2l0aCBPcGVuSUQgQ29ubmVjdDwvaDE+CjxwPlNvcnJ5LCBidXQgdGhlIGxpZmV0aW1lIGZvciB0aGlzIHBhZ2UgaGFzIGV4cGlyZWQuPC9wPg0KPHA+PGEgaHJlZj0iJHtsb2NhdGlvbl9hcHB9IiBjbGFzcz0iYnRuIGJ0bi1wcmltYXJ5Ij5SZXBlYXQgUmVxdWVzdDwvYT48L3A+DQoke2h0bWxUZW1wbGF0ZUJvdHRvbX0="/>
                                <L7p:ResponseContentType stringValue="text/html;charset=UTF-8"/>
                            </L7p:HardcodedResponse>
                        </wsp:OneOrMore>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="DISPLAY results"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <wsp:All wsp:Usage="Required">
                        <L7p:CommentAssertion>
                            <L7p:Comment stringValue="The received message will be sent to the user-agent which in turn send back the message"/>
                        </L7p:CommentAssertion>
                        <L7p:CommentAssertion>
                            <L7p:Comment stringValue="with parameters instead of a url-fragment"/>
                        </L7p:CommentAssertion>
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${request.http.parameter.auth}"/>
                            <L7p:Expression2 stringValue="done"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="done"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnN0YXRlfQ=="/>
                            <L7p:VariableToSet stringValue="state"/>
                        </L7p:SetVariable>
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${state}"/>
                            <L7p:Expression2 stringValue=""/>
                            <L7p:Operator operator="EMPTY"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Operator operator="EMPTY"/>
                                    <L7p:RightValue stringValue=""/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:HardcodedResponse>
                            <L7p:Base64ResponseBody stringValue="PCFET0NUWVBFIEhUTUwgUFVCTElDICItLy9XM0MvL0RURCBIVE1MIDQuMDEgVHJhbnNpdGlvbmFsLy9FTiIKICAgICAgICAiaHR0cDovL3d3dy53My5vcmcvVFIvaHRtbDQvbG9vc2UuZHRkIj4KPGh0bWw+CjxoZWFkPgogICAgPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPgoKICAgICAgICB2YXIgdGFyZ2V0VXJsID0gJyR7bG9jYXRpb25fYXBwfSc7CiAgICAgICAgdmFyIHNlYXJjaENvbnRlbnQgPSAnJzsKICAgICAgICB2YXIgZnJhZ21lbnRDb250ZW50ID0gJyc7CiAgICAgICAgCiAgICAgICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5oYXNoLmxlbmd0aCA+IDApCiAgICAgICAgICAgIGZyYWdtZW50Q29udGVudCA9IGxvY2F0aW9uLmhhc2guc3Vic3RyaW5nKDEpOwoKICAgICAgICBpZiAod2luZG93LmxvY2F0aW9uLnNlYXJjaC5sZW5ndGggPiAwKQogICAgICAgICAgICBzZWFyY2hDb250ZW50ID0gd2luZG93LmxvY2F0aW9uLnNlYXJjaDsKCiAgICAgICAgaWYgKHNlYXJjaENvbnRlbnQubGVuZ3RoID4gMCAmJiBmcmFnbWVudENvbnRlbnQubGVuZ3RoID4gMCkKICAgICAgICAgICAgdGFyZ2V0VXJsID0gdGFyZ2V0VXJsICsgc2VhcmNoQ29udGVudCArICcmJyArIGZyYWdtZW50Q29udGVudDsKICAgICAgICBlbHNlIGlmIChzZWFyY2hDb250ZW50Lmxlbmd0aCA+IDAgJiYgZnJhZ21lbnRDb250ZW50Lmxlbmd0aCA9PSAwKQogICAgICAgICAgICB0YXJnZXRVcmwgPSB0YXJnZXRVcmwgKyBzZWFyY2hDb250ZW50OwogICAgICAgIGVsc2UgaWYgKHNlYXJjaENvbnRlbnQubGVuZ3RoID09IDAgJiYgZnJhZ21lbnRDb250ZW50Lmxlbmd0aCA+IDApCiAgICAgICAgICAgIHRhcmdldFVybCA9IHRhcmdldFVybCArICc/JyArIGZyYWdtZW50Q29udGVudDsKCgk8IS0tIGFsZXJ0ICh0YXJnZXRVcmwpOyAtLT4KICAgICAgICB3aW5kb3cubG9jYXRpb24gPSB0YXJnZXRVcmw7CiAgICAgICAgCiAgICA8L3NjcmlwdD4KPC9oZWFkPgo8Ym9keT4KPC9ib2R5Pg=="/>
                            <L7p:ResponseContentType stringValue="text/html;charset=UTF-8"/>
                        </L7p:HardcodedResponse>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="Received redirected message"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <wsp:All wsp:Usage="Required">
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${request.http.parameter.auth}"/>
                            <L7p:Expression2 stringValue="done"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="done"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:ComparisonAssertion>
                            <L7p:Expression1 stringValue="${request.http.parameter.error}"/>
                            <L7p:Expression2 stringValue=""/>
                            <L7p:Negate booleanValue="true"/>
                            <L7p:Operator operator="EMPTY"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item binary="included">
                                    <L7p:Negated booleanValue="true"/>
                                    <L7p:Operator operator="EMPTY"/>
                                    <L7p:RightValue stringValue=""/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:HardcodedResponse>
                            <L7p:Base64ResponseBody stringValue="JHtodG1sVGVtcGxhdGVUb3B9DQo8aDE+R3JhbnQgdHlwZTogSW1wbGljaXQgd2l0aCBPcGVuSUQgQ29ubmVjdDwvaDE+CjwhLS0gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gIC0tPg0KPHA+VGhlIGNsaWVudCBhY2Nlc3Mgd2FzIGRlbmllZCBieSB0aGUgcmVzb3VyY2Ugb3duZXIuPC9wPg0KPHA+VGhlIGF1dGhvcml6YXRpb24gc2VydmVyIGhhcyB2YWxpZGF0ZWQgdGhlIHJlcXVlc3QgYW5kIHJldHVybmVkIHRoaXMgZXJyb3IgdG8gdGhlIGNsaWVudCBhcyBVUkwgcGFyYW1ldGVyOjwvcD4NCjxwcmU+RXJyb3I6ICR7cmVxdWVzdC5odHRwLnBhcmFtZXRlci5lcnJvcn08L3ByZT4NCjxwPjxhIGhyZWY9IiR7bG9jYXRpb25fYXBwfSIgY2xhc3M9ImJ0biBidG4tcHJpbWFyeSI+UmVwZWF0IFJlcXVlc3Q8L2E+PC9wPg0KPCEtLSA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAgLS0+DQoke2h0bWxUZW1wbGF0ZUJvdHRvbX0="/>
                            <L7p:ResponseContentType stringValue="text/html;charset=UTF-8"/>
                        </L7p:HardcodedResponse>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="DENIED"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <wsp:All wsp:Usage="Required">
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${request.http.parameter.auth}"/>
                            <L7p:Expression2 stringValue="done"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="done"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${request.http.parameter.state}"/>
                            <L7p:Expression2 stringValue="call"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="call"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmFjY2Vzc190b2tlbn0="/>
                            <L7p:VariableToSet stringValue="access_token"/>
                        </L7p:SetVariable>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmlkX3Rva2VufQ=="/>
                            <L7p:VariableToSet stringValue="id_token"/>
                        </L7p:SetVariable>
                        <wsp:OneOrMore wsp:Usage="Required">
                            <wsp:All wsp:Usage="Required">
                                <L7p:WssReplayProtection>
                                    <L7p:CustomExpiryTime intValue="300000"/>
                                    <L7p:CustomIdentifierVariable stringValue="request.http.parameter.access_token"/>
                                    <L7p:CustomProtection booleanValue="true"/>
                                    <L7p:CustomScope stringValue="bcp"/>
                                </L7p:WssReplayProtection>
                                <wsp:OneOrMore wsp:Usage="Required">
                                    <wsp:All wsp:Usage="Required">
                                    <L7p:CommentAssertion>
                                    <L7p:Comment stringValue="Below validation is a sample which simply succeeds if one  method works."/>
                                    </L7p:CommentAssertion>
                                    <L7p:CommentAssertion>
                                    <L7p:Comment stringValue="A real world client would have to validate the id_token dependant on the 'iss' (issuer)"/>
                                    </L7p:CommentAssertion>
                                    <wsp:OneOrMore wsp:Usage="Required">
                                    <wsp:All wsp:Usage="Required">
                                    <L7p:DecodeJsonWebToken>

                                    <L7p:AssertionComment assertionComment="included">
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>

                                    <L7p:value stringValue="HS256"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>

                                    <L7p:value stringValue="// validation using a shared secret (client_secret)"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:AssertionComment>
                                    <L7p:KeyType stringValue="Certificate"/>

                                    <L7p:PrivateKeySource stringValue="client_secret_icp"/>
                                    <L7p:SignatureSecret stringValue="${client_secret_icp}"/>
                                    <L7p:SourcePayload stringValue="${id_token}"/>

                                    <L7p:TargetVariablePrefix stringValue="jwt"/>
                                    <L7p:ValidationType stringValue="Using Secret"/>
                                    </L7p:DecodeJsonWebToken>
                                    <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${jwt.valid}"/>
                                    <L7p:Expression2 stringValue="true"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item binary="included">

                                    <L7p:CaseSensitive booleanValue="false"/>

                                    <L7p:RightValue stringValue="true"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// HS256"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:assertionComment>
                                    </wsp:All>
                                    <wsp:All wsp:Usage="Required">
                                    <L7p:DecodeJsonWebToken>

                                    <L7p:AssertionComment assertionComment="included">
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>

                                    <L7p:value stringValue="RS256"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>

                                    <L7p:value stringValue="// validation using a public key"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:AssertionComment>
                                    <L7p:KeyGoid goidValue="0000000000000000ffffffffffffffff"/>
                                    <L7p:SourcePayload stringValue="${id_token}"/>

                                    <L7p:TargetVariablePrefix stringValue="jwt"/>
                                    <L7p:ValidationType stringValue="Using Recipient Key From List"/>
                                    </L7p:DecodeJsonWebToken>
                                    <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${jwt.valid}"/>
                                    <L7p:Expression2 stringValue="true"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item binary="included">

                                    <L7p:CaseSensitive booleanValue="false"/>

                                    <L7p:RightValue stringValue="true"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// RS256"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:assertionComment>
                                    </wsp:All>
                                    <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// validate id_token signature"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:assertionComment>
                                    </wsp:OneOrMore>
                                    <L7p:CustomAssertion>
                                    <L7p:base64SerializedValue>rO0ABXNyADFjb20ubDd0ZWNoLnBvbGljeS5hc3NlcnRpb24uQ3VzdG9tQXNzZXJ0aW9uSG9sZGVyZtcreFwddTICAAlaAAxpc1VpQXV0b09wZW5MAApjYXRlZ29yaWVzdAAPTGphdmEvdXRpbC9TZXQ7TAAIY2F0ZWdvcnl0ACpMY29tL2w3dGVjaC9wb2xpY3kvYXNzZXJ0aW9uL2V4dC9DYXRlZ29yeTtMAA9jdXN0b21Bc3NlcnRpb250ADFMY29tL2w3dGVjaC9wb2xpY3kvYXNzZXJ0aW9uL2V4dC9DdXN0b21Bc3NlcnRpb247TAAUY3VzdG9tTW9kdWxlRmlsZU5hbWV0ABJMamF2YS9sYW5nL1N0cmluZztMAA9kZXNjcmlwdGlvblRleHRxAH4ABEwAD3BhbGV0dGVOb2RlTmFtZXEAfgAETAAOcG9saWN5Tm9kZU5hbWVxAH4ABEwAHnJlZ2lzdGVyZWRDdXN0b21GZWF0dXJlU2V0TmFtZXEAfgAEeHIAJWNvbS5sN3RlY2gucG9saWN5LmFzc2VydGlvbi5Bc3NlcnRpb27bX2OZPL2isQIAAloAB2VuYWJsZWRMABBhc3NlcnRpb25Db21tZW50dAAvTGNvbS9sN3RlY2gvcG9saWN5L2Fzc2VydGlvbi9Bc3NlcnRpb24kQ29tbWVudDt4cAFwAXNyABFqYXZhLnV0aWwuSGFzaFNldLpEhZWWuLc0AwAAeHB3DAAAAAI/QAAAAAAAAXNyAChjb20ubDd0ZWNoLnBvbGljeS5hc3NlcnRpb24uZXh0LkNhdGVnb3J5WrCcZaFE/jUCAAJJAAVteUtleUwABm15TmFtZXEAfgAEeHAAAAAHdAAfTWVzc2FnZVZhbGlkYXRpb25UcmFuc2Zvcm1hdGlvbnhwc3IARGNvbS5sN3RlY2guY3VzdG9tLm9wZW5pZGNvbm5lY3QuRGVjb2RlSURUb2tlbi5JRFRva2VuRGVjb2RlQXNzZXJ0aW9uxl6qBXO//LkCABBaAAlleHBvcnRBY3JaAAlleHBvcnRBbGxaAAxleHBvcnRBdEhhc2haAAlleHBvcnRBdWRaAA5leHBvcnRBdXRoVGltZVoACWV4cG9ydEF6cFoAC2V4cG9ydENIYXNoWgAQZXhwb3J0RXhwaXJhdGlvbloACWV4cG9ydElhdFoACWV4cG9ydElzc1oAC2V4cG9ydE5vbmNlWgAJZXhwb3J0U3ViWgAOdmFsaWRhdGVDbGFpbXNaABJ2YWxpZGF0ZUV4cGlyYXRpb25MAA5leHBvcnRWYXJpYWJsZXEAfgAETAAHcGF5bG9hZHEAfgAEeHABAQEBAQEBAQEBAQEBAXQABGRpZHR0AA4ke2p3dC5wYXlsb2FkfXQAGk9wZW5JRENvbm5lY3RBc3NlcnRpb24uamFydAAuRGVjb2RlcyBhbiBJRCBUb2tlbiBwYXNzZWQgaW4gYXMgSlNPTiBtZXNzYWdlLnBwcA==</L7p:base64SerializedValue>
                                    </L7p:CustomAssertion>
                                    <wsp:OneOrMore wsp:Usage="Required">
                                    <wsp:All wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>
                                    <L7p:Expression1 stringValue="${didt.aud}"/>
                                    <L7p:Expression2 stringValue="${client_id_icp}"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item binary="included">

                                    <L7p:RightValue stringValue="${client_id_icp}"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:SetVariable>

                                    <L7p:Base64Expression stringValue="dmFsaWQ="/>
                                    <L7p:VariableToSet stringValue="verified"/>
                                    </L7p:SetVariable>
                                    </wsp:All>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="aW52YWxpZA=="/>
                                    <L7p:VariableToSet stringValue="verified"/>
                                    </L7p:SetVariable>
                                    </wsp:OneOrMore>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtpZF90b2tlbn0="/>
                                    <L7p:VariableToSet stringValue="idToken_display"/>
                                    </L7p:SetVariable>
                                    <L7p:Regex>
                                    <L7p:AutoTarget booleanValue="false"/>

                                    <L7p:OtherTargetMessageVariable stringValue="idToken_display"/>
                                    <L7p:Regex stringValue="[.]"/>
                                    <L7p:Replace booleanValue="true"/>
                                    <L7p:Replacement stringValue=".&lt;br>"/>
                                    <L7p:Target target="OTHER"/>
                                    </L7p:Regex>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="PHRhYmxlPg0KICAgIDx0cj48dGg+UGFyYW1ldGVyPC90aD48dGg+VmFsdWU8L3RoPjx0aD5Db21tZW50PC90aD48L3RyPg0KICAgIDx0cj48dGQ+aWRfdG9rZW48L3RkPjx0ZD4ke2lkVG9rZW5fZGlzcGxheX08L3RkPjx0ZD5UaGlzIGlzIHRoZSwgaGF2ZSBhIGd1ZXNzIC4uLiBpZF90b2tlbiAobGluZSBicmVha3MganVzdCBmb3IgZGlzcGxheSk8L3RkPjwvdHI+DQo8L3RhYmxlPg0KPHA+PGI+SW1wb3J0YW50OjwvYj4gVGhlIGNsaWVudCBoYXMgdG8gdmVyaWZ5IHRoZSBjb250ZW50IG9mIHRoZSBJRF9UT0tFTiBhbmQgbm90IHVzZSBpZiB0aGUgdmVyaWZpY2F0aW9uIGZhaWxzITwvcD4NCjxwPlRoZSBpZF90b2tlbiBwYXlsb2FkIGxvb2tzIGxpa2UgdGhpczo8L3A+DQo8cHJlPiR7and0LnBheWxvYWR9PC9wcmU+DQo8b2w+DQogICAgPGxpPlZlcmlmeSB0aGUgSURfVE9LRU4gbWVtYmVyICdhdWQnLiBJdCBtdXN0IGJlIHRoZSBjbGllbnRfaWQ8L2xpPg0KICAgIDxsaT5WZXJpZnkgdGhlIElEX1RPS0VOIG1lbWJlciAnZXhwJy4gSXQgbXVzdCBiZSBncmVhdGVyIHRoYW4gdGhlIHRpbWUgJ25vdycgaW4gVVRDIHRpbWV6b25lPC9saT4NCiAgICA8bGk+TW9yZSB2ZXJpZmljYXRpb25zIGFyZSBvcHRpb25hbDwvbGk+DQo8L29sPg0KPHA+PGI+VmVyaWZpY2F0aW9uIHJlc3VsdDogJHt2ZXJpZmllZH08L2I+PC9wPg0KPHA+PGI+QWRkaXRpb25hbCBzaWduYXR1cmUgdmFsaWRhdGlvbjogdmFsaWQ8L2I+PC9wPg=="/>
                                    <L7p:VariableToSet stringValue="idTokenIssued"/>
                                    </L7p:SetVariable>
                                    </wsp:All>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="PHA+PGI+Tm8gSURfVE9LRU4gd2FzIGlzc3VlZDwvYj4uIFRoZXJlIGFyZSBzZXZlcmFsIHBvc3NpYmxlIHJlYXNvbnMgZm9yIHRoYXQ6PC9wPg0KPG9sPg0KPGxpPnRoZSB1c2VyIGRpZCBub3QgZ3JhbnQgaXQ8L2xpPg0KPGxpPnRoZSByZXF1ZXN0ZWQgcmVzcG9uc2VfdHlwZSBkaWQgbm90IGluY2x1ZGUgJ2lkX3Rva2VuJzwvbGk+DQo8bGk+dGhlIGNsaWVudCB3YXMgbm90IHJlZ2lzdGVyZWQgYXMgYSB2YWxpZCBPcGVuSUQgQ29ubmVjdCBjbGllbnQ8L2xpPg0KPC9vbD4="/>
                                    <L7p:VariableToSet stringValue="idTokenIssued"/>
                                    </L7p:SetVariable>
                                </wsp:OneOrMore>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="PHA+VGhlIGNsaWVudCBoYXMgcmVjZWl2ZWQgdGhlIHRva2VucyBkaXJlY3RseSBhZnRlciB0aGUgdXNlciBncmFudGVkIGFjY2VzcyB0byBoaXMgcmVzb3VyY2VzLjwvcD4NCjxwPlRoZXNlIHZhbHVlcyB3ZXJlIHJlY2VpdmVkIHdpdGhpbiB0aGUgVVJMOjwvcD4NCjx0YWJsZT4NCiAgICA8dHI+PHRoPlBhcmFtZXRlcjwvdGg+PHRoPlZhbHVlPC90aD48dGg+Q29tbWVudDwvdGg+PC90cj4NCiAgICA8dHI+PHRkPmFjY2Vzc190b2tlbjwvdGQ+PHRkPiR7YWNjZXNzX3Rva2VufTwvdGQ+PHRkPlRoaXMgaXMgdGhlLCBoYXZlIGEgZ3Vlc3MgLi4uIGFjY2Vzc190b2tlbjwvdGQ+PC90cj4NCiAgICA8dHI+PHRkPnNjb3BlPC90ZD48dGQ+JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnNjb3BlfTwvdGQ+PHRkPlRoZSBncmFudGVkIGFuZCBhY2NlcHRlZCBzY29wZSBmb3IgdGhpcyB0b2tlbjwvdGQ+PC90cj4NCiAgICA8dHI+PHRkPmV4cGlyZXNfaW48L3RkPjx0ZD4ke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXIuZXhwaXJlc19pbn08L3RkPjx0ZD5UaGUgZXhwaXJhdGlvbiBkYXRlIGZvciB0aGlzIHRva2VuPC90ZD48L3RyPg0KICAgIDx0cj48dGQ+dG9rZW5fdHlwZTwvdGQ+PHRkPiR7cmVxdWVzdC5odHRwLnBhcmFtZXRlci50b2tlbl90eXBlfTwvdGQ+PHRkPlRoZSBleHBpcmF0aW9uIGRhdGUgZm9yIHRoaXMgY2xpZW50PC90ZD48L3RyPg0KICAgIDx0cj48dGQ+c3RhdGU8L3RkPjx0ZD4ke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXIuc3RhdGV9PC90ZD48dGQ+VGhlIHZhbHVlIHRoYXQgd2FzIHNlbnQgYnkgdGhlIGNsaWVudDwvdGQ+PC90cj4NCjwvdGFibGU+DQoke2lkVG9rZW5Jc3N1ZWR9DQo8cD5UaGUgaW5jbHVkZWQgdG9rZW5zIGNhbiBub3cgYmUgdXNlZCB0byBhY2Nlc3MgdGhlIHVzZXJzIHJlc291cmNlcyBvciB0aGUgJy91c2VyaW5mbycgZW5kcG9pbnQgdG8gcmVxdWVzdCBjbGFpbXMgYWJvdXQgdGhlIHVzZXIuPC9wPg0KPHA+Qm90aCByZXF1ZXN0cyB3aWxsIHVzZSBIVFRQICdQT1NUJyBhbmQgdGhlIHBhcmFtZXRlciAnYWNjZXNzX3Rva2VuJyB3aGljaCwgb2YgY291cnNlLCBpbmNsdWRlcyB0aGUgYWNjZXNzIHRva2VuLjwvcD4NCjxwPjxiPkFjY2Vzc190b2tlbjo8L2I+ICR7YWNjZXNzX3Rva2VufTwvcD4NCjxwPkdvIGFoZWFkIGFuZCB0cnkgaXQgb3V0OjwvcD4NCjxmb3JtIGFjdGlvbj0iJHtsb2NhdGlvbl9hcHB9IiB0YXJnZXQ9InJlc3VsdCIgbWV0aG9kPSJQT1NUIj4NCiAgICA8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJhY2Nlc3NfdG9rZW4iIHZhbHVlPSIke2FjY2Vzc190b2tlbn0iPg0KICAgIDxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9InN0YXRlIiB2YWx1ZT0icHIiPg0KICAgIFJlcXVlc3QgcmVzb3VyY2VzOiA8aW5wdXQgdHlwZT0ic3VibWl0IiB2YWx1ZT0iUmVzb3VyY2VzIj4gKCR7bG9jYXRpb25fcmVzb3VyY2VlbmRwb2ludH0pDQo8L2Zvcm0+DQo8cD5UbyBhY2Nlc3MgdGhlIC91c2VyaW5mbyBlbmRvcG9pbnQgdGhlIGFkZGl0aW9uYWwgcGFyYW1ldGVyLXZhbHVlIHBhaXIgJ3NjaGVtYT1vcGVuaWQnIGlzIHJlcXVpcmVkITwvcD4NCjxmb3JtIGFjdGlvbj0iJHtsb2NhdGlvbl91c2VyaW5mb2VuZHBvaW50fSIgdGFyZ2V0PSJyZXN1bHQiIG1ldGhvZD0iUE9TVCI+DQogICAgPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0ic2NoZW1hIiB2YWx1ZT0ib3BlbmlkIj4NCiAgICA8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJhY2Nlc3NfdG9rZW4iIHZhbHVlPSIke2FjY2Vzc190b2tlbn0iPg0KICAgIFJlcXVlc3QgdXNlciBjbGFpbXM6IDxpbnB1dCB0eXBlPSJzdWJtaXQiIHZhbHVlPSJDbGFpbXMiPiAoJHtsb2NhdGlvbl91c2VyaW5mb2VuZHBvaW50fSkNCjwvZm9ybT4NCjxwPlJlc3VsdCBhZnRlciBhY2Nlc3NpbmcgcmVzb3VyY2VzIG9yIHRoZSB1c2VyaW5mbyBlbmRwb2ludDo8L3A+DQo8aWZyYW1lIGlkPSJyZXN1bHQiIG5hbWU9InJlc3VsdCIgd2lkdGg9IjYwMCI+PC9pZnJhbWU+DQo8cD5UaGF0J3MgaXQhIElmIHlvdSB3YW50IHRvIGRvIGl0IGFnYWluLCBjbGljayBoZXJlOiA8YSBocmVmPSIke2xvY2F0aW9uX2FwcH0iPkFHQUlOPC9hPjwvcD4="/>
                                    <L7p:ContentType stringValue="text/html;charset=UTF-8"/>
                                    <L7p:DataType variableDataType="message"/>
                                    <L7p:VariableToSet stringValue="tokenResult"/>
                                </L7p:SetVariable>
                                <L7p:UUIDGenerator>
                                    <L7p:MaximumQuantity intValue="1"/>
                                    <L7p:TargetVariable stringValue="key"/>
                                </L7p:UUIDGenerator>
                                <L7p:Encapsulated>
                                    <L7p:EncapsulatedAssertionConfigGuid stringValue="dd360775-0fec-47db-8b45-059d995b262d"/>
                                    <L7p:EncapsulatedAssertionConfigName stringValue="OTK Session - Store"/>
                                    <L7p:Parameters mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="cacheAge"/>
                                    <L7p:value stringValue="300"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="cacheId"/>
                                    <L7p:value stringValue="tokenResult"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="cacheKey"/>
                                    <L7p:value stringValue="${key[0]}"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="cacheMaxEntries"/>
                                    <L7p:value stringValue="1000"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="cacheMaxSize"/>
                                    <L7p:value stringValue=""/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="dbAge"/>
                                    <L7p:value stringValue="300"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="value"/>
                                    <L7p:value stringValue="${tokenResult.mainpart}"/>
                                    </L7p:entry>
                                    </L7p:Parameters>
                                </L7p:Encapsulated>
                                <L7p:HardcodedResponse>
                                    <L7p:ResponseContentType stringValue="text/html;charset=UTF-8"/>
                                    <L7p:ResponseStatus stringValue="302"/>
                                </L7p:HardcodedResponse>
                                <L7p:AddHeader>
                                    <L7p:HeaderName stringValue="Location"/>
                                    <L7p:HeaderValue stringValue="${location_app}?state=view&amp;code=${key[0]}"/>
                                    <L7p:RemoveExisting booleanValue="true"/>
                                    <L7p:Target target="RESPONSE"/>
                                </L7p:AddHeader>
                            </wsp:All>
                            <L7p:HardcodedResponse>
                                <L7p:Base64ResponseBody stringValue="JHtodG1sVGVtcGxhdGVUb3B9DQo8aDE+R3JhbnQgdHlwZTogSW1wbGljaXQgd2l0aCBPcGVuSUQgQ29ubmVjdDwvaDE+CjxwPlNvcnJ5LCBidXQgdGhlIGFjY2Vzc190b2tlbiBoYXMgYmVlbiBwcm9jZXNzZWQgYWxyZWFkeS48L3A+DQo8cD48YSBocmVmPSIke2xvY2F0aW9uX2FwcH0iIGNsYXNzPSJidG4gYnRuLXByaW1hcnkiPlJlcGVhdCBSZXF1ZXN0PC9hPjwvcD4NCiR7aHRtbFRlbXBsYXRlQm90dG9tfQ=="/>
                                <L7p:ResponseContentType stringValue="text/html;charset=UTF-8"/>
                            </L7p:HardcodedResponse>
                        </wsp:OneOrMore>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="GRANTED"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <wsp:All wsp:Usage="Required">
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${request.http.parameter.state}"/>
                            <L7p:Expression2 stringValue="init"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="init"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="Y2FsbA=="/>
                            <L7p:VariableToSet stringValue="state"/>
                        </L7p:SetVariable>
                        <L7p:EncodeDecode>
                            <L7p:SourceVariableName stringValue="client_id_icp"/>
                            <L7p:TargetDataType variableDataType="string"/>
                            <L7p:TargetVariableName stringValue="client_id"/>
                            <L7p:TransformType transformType="URL_ENCODE"/>
                        </L7p:EncodeDecode>
                        <L7p:EncodeDecode>
                            <L7p:SourceVariableName stringValue="scope"/>
                            <L7p:TargetDataType variableDataType="string"/>
                            <L7p:TargetVariableName stringValue="scope"/>
                            <L7p:TransformType transformType="URL_ENCODE"/>
                        </L7p:EncodeDecode>
                        <L7p:EncodeDecode>
                            <L7p:SourceVariableName stringValue="response_type"/>
                            <L7p:TargetDataType variableDataType="string"/>
                            <L7p:TargetVariableName stringValue="response_type"/>
                            <L7p:TransformType transformType="URL_ENCODE"/>
                        </L7p:EncodeDecode>
                        <L7p:EncodeDecode>
                            <L7p:SourceVariableName stringValue="redirect_uri"/>
                            <L7p:TargetDataType variableDataType="string"/>
                            <L7p:TargetVariableName stringValue="redirect_uri"/>
                            <L7p:TransformType transformType="URL_ENCODE"/>
                        </L7p:EncodeDecode>
                        <L7p:EncodeDecode>
                            <L7p:SourceVariableName stringValue="display"/>
                            <L7p:TargetDataType variableDataType="string"/>
                            <L7p:TargetVariableName stringValue="display"/>
                            <L7p:TransformType transformType="URL_ENCODE"/>
                        </L7p:EncodeDecode>
                        <L7p:EncodeDecode>
                            <L7p:SourceVariableName stringValue="prompt"/>
                            <L7p:TargetDataType variableDataType="string"/>
                            <L7p:TargetVariableName stringValue="prompt"/>
                            <L7p:TransformType transformType="URL_ENCODE"/>
                        </L7p:EncodeDecode>
                        <L7p:EncodeDecode>
                            <L7p:SourceVariableName stringValue="state"/>
                            <L7p:TargetDataType variableDataType="string"/>
                            <L7p:TargetVariableName stringValue="state"/>
                            <L7p:TransformType transformType="URL_ENCODE"/>
                        </L7p:EncodeDecode>
                        <L7p:EncodeDecode>
                            <L7p:SourceVariableName stringValue="request.http.parameter.nonce"/>
                            <L7p:TargetDataType variableDataType="string"/>
                            <L7p:TargetVariableName stringValue="nonce"/>
                            <L7p:TransformType transformType="URL_ENCODE"/>
                        </L7p:EncodeDecode>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="Y2xpZW50X2lkPSR7Y2xpZW50X2lkfSZzY29wZT0ke3Njb3BlfSZyZXNwb25zZV90eXBlPSR7cmVzcG9uc2VfdHlwZX0mcmVkaXJlY3RfdXJpPSR7cmVkaXJlY3RfdXJpfSZkaXNwbGF5PSR7ZGlzcGxheX0mcHJvbXB0PSR7cHJvbXB0fSZzdGF0ZT0ke3N0YXRlfSZub25jZT0ke25vbmNlfQ=="/>
                            <L7p:VariableToSet stringValue="authRequestParameters"/>
                        </L7p:SetVariable>
                        <L7p:HardcodedResponse>
                            <L7p:ResponseContentType stringValue="text/html;charset=UTF-8"/>
                            <L7p:ResponseStatus stringValue="302"/>
                        </L7p:HardcodedResponse>
                        <L7p:AddHeader>
                            <L7p:HeaderName stringValue="Location"/>
                            <L7p:HeaderValue stringValue="${location_authserver}?${authRequestParameters}"/>
                            <L7p:RemoveExisting booleanValue="true"/>
                            <L7p:Target target="RESPONSE"/>
                        </L7p:AddHeader>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="Create auth-request and redirect client"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <wsp:All wsp:Usage="Required">
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnN0YXRlfQ=="/>
                            <L7p:VariableToSet stringValue="state"/>
                        </L7p:SetVariable>
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${state}"/>
                            <L7p:Expression2 stringValue=""/>
                            <L7p:Operator operator="EMPTY"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Operator operator="EMPTY"/>
                                    <L7p:RightValue stringValue=""/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="aW5pdA=="/>
                            <L7p:VariableToSet stringValue="state"/>
                        </L7p:SetVariable>
                        <L7p:EncodeDecode>
                            <L7p:SourceVariableName stringValue="state"/>
                            <L7p:TargetDataType variableDataType="string"/>
                            <L7p:TargetVariableName stringValue="state"/>
                            <L7p:TransformType transformType="URL_ENCODE"/>
                        </L7p:EncodeDecode>
                        <L7p:EncodeDecode>
                            <L7p:SourceVariableName stringValue="gateway.time.HHssmmSSS"/>
                            <L7p:TargetDataType variableDataType="string"/>
                            <L7p:TargetVariableName stringValue="nonce"/>
                            <L7p:TransformType transformType="URL_ENCODE"/>
                        </L7p:EncodeDecode>
                        <L7p:HardcodedResponse>
                            <L7p:Base64ResponseBody stringValue="JHtodG1sVGVtcGxhdGVUb3B9DQo8aDE+R3JhbnQgdHlwZTogSW1wbGljaXQgd2l0aCBPcGVuSUQgQ29ubmVjdDwvaDE+CjxwPlRoaXMgY2xpZW50IGlzIGdvaW5nIHRvIHJlcXVlc3QgYW4gT0F1dGggMi4wIGFjY2Vzc190b2tlbiBhbmQgYW4gT3BlbklEIENvbm5lY3QgaWRfdG9rZW4uPC9wPg0KPHA+VGhlIGNsaWVudCBpcyB1c2luZyB0aGUgPGI+cmVzcG9uc2VfdHlwZT0ke3Jlc3BvbnNlX3R5cGV9PC9iPjwvcD4NCjxwPlRoaXMgY2xpZW50IGlzIGV4cG9zaW5nIHNvbWUgdmFsdWVzIE9OTFkgdG8gZGlzcGxheSB3aGF0IGlzIGdvaW5nIG9uIGJlaGluZCB0aGUgc2NlbmVzLiAnSGlkZGVuJyBpbiB0aGUgdGFibGUgYmVsb3cNCiAgICByZWZlcnMgdG8gdmFsdWVzIHRoYXQgc2hvdWxkIG5vdC8gZG8gbm90IGhhdmUgdG8gYmUgZXhwb3NlZCB0byB0aGUgdXNlci1hZ2VudCBpbiBhIHJlYWwtd29ybGQgc2NlbmFyaW8gYWx0aG91Z2ggaXQgbWF5IG5vdCBiZSBwb3NzaWJsZSB3aGVuIHVzaW5nIHRlY2hub2xvZ2llcyBsaWtlIEphdmFTY3JpcHQgdG8gaW1wbGVtZW50IHRoZSBjbGllbnQ8L3A+DQo8cD5Gb3IgYW55IG1vcmUgZGV0YWlscyBwbGVhc2UgcmVmZXIgdG8gdGhpcyB3ZWJzaXRlOiA8YSBocmVmPSJodHRwOi8vb3BlbmlkLm5ldC9zcGVjcy9vcGVuaWQtY29ubmVjdC1pbXBsaWNpdC0xXzAuaHRtbCIgdGFyZ2V0PSJfYmxhbmsiPm9wZW5pZC5uZXQvc3BlY3Mvb3BlbmlkLWNvbm5lY3QtaW1wbGljaXQtMV8wLmh0bWw8L2E+PC9wPg0KPHA+V2l0aCB0aGlzIHJlc3BvbnNlX3R5cGUgdGhlIGNsaWVudCBoYXMgdG8gYnVpbGQgdXAgYSByZXF1ZXN0IHVzaW5nIGZvbGxvd2luZyB2YWx1ZXM6PC9wPg0KPHRhYmxlIGNsYXNzPSJ0YWJsZS1zdHJpcGVkIHRhYmxlLWhvdmVyIj4NCiAgICA8dHI+PHRoPlBhcmFtZXRlcjwvdGg+PHRoPlZhbHVlPC90aD48dGg+UmVxdWlyZWQ8L3RoPjx0aD5IaWRkZW48L3RoPjx0aD5Db21tZW50PC90aD48L3RyPg0KICAgIDx0cj48dGQ+Y2xpZW50X2lkPC90ZD48dGQ+JHtjbGllbnRfaWRfaWNwfTwvdGQ+PHRkPlllczwvdGQ+PHRkPk5vPC90ZD48dGQ+TVVTVCBiZSBrbm93biBhdCB0aGUgYXV0aG9yaXphdGlvbiBzZXJ2ZXI8L3RkPjwvdHI+DQogICAgPHRyPjx0ZD5zY29wZTwvdGQ+PHRkPiR7c2NvcGV9PC90ZD48dGQ+WWVzPC90ZD48dGQ+Tm88L3RkPjx0ZD5NVVNUIGluY2x1ZGUgJ29wZW5pZCcgdG8gbWFrZSBpdCBhIHZhbGlkIE9wZW5JRCBDb25uZWN0IHJlcXVlc3Q8L3RkPjwvdHI+DQogICAgPHRyPjx0ZD5yZXNwb25zZV90eXBlPC90ZD48dGQ+JHtyZXNwb25zZV90eXBlfTwvdGQ+PHRkPlllczwvdGQ+PHRkPk5vPC90ZD48dGQ+TVVTVCBjb250YWluICd0b2tlbicgYW5kICdpZF90b2tlbic8L3RkPjwvdHI+DQogICAgPHRyPjx0ZD5yZWRpcmVjdF91cmk8L3RkPjx0ZD4ke3JlZGlyZWN0X3VyaX08L3RkPjx0ZD5ZZXM8L3RkPjx0ZD5ObzwvdGQ+PHRkPk1VU1QgYmUgcHJlLXJlZ2lzdGVyZWQgd2l0aCB0aGUgYXV0aG9yaXphdGlvbiBzZXJ2ZXI8L3RkPjwvdHI+DQogICAgPHRyPjx0ZD5ub25jZTwvdGQ+PHRkPiR7bm9uY2V9PC90ZD48dGQ+WWVzPC90ZD48dGQ+Tm88L3RkPjx0ZD5BIHJhbmRvbSB2YWx1ZSBvcGFxdWUgdG8gdGhlIHNlcnZlci4gSXQgaGFzIHRvIGFwcGVhciB3aXRoaW4gaWRfdG9rZW48L3RkPjwvdHI+DQogICAgPHRyPjx0ZD5zdGF0ZTwvdGQ+PHRkPiR7c3RhdGV9PC90ZD48dGQ+Tm88L3RkPjx0ZD5ObzwvdGQ+PHRkPkEgdmFsdWUgb3BhcXVlIHRvIHRoZSBhdXRob3JpemF0aW9uIHNlcnZlcjsgd2lsbCBiZSBwYXNzZWQgYmFjayB0byB0aGUgY2xpZW50PC90ZD48L3RyPg0KICAgIDx0cj48dGQ+ZGlzcGxheTwvdGQ+PHRkPiR7ZGlzcGxheX08L3RkPjx0ZD5ObzwvdGQ+PHRkPk5vPC90ZD48dGQ+VmFsaWQgdmFsdWVzIHRoYXQgc3BlY2lmeSBob3cgdGhlIGF1dGhvcml6YXRpb24gc2VydmVyIHNob3VsZCBkaXNwbGF5IHRoZSBhdXRob3JpemF0aW9uIHBhZ2U6ICdwYWdlJ3wncG9wdXAnfCd0b3VjaCd8J3dhcCc8L3RkPjwvdHI+DQogICAgPHRyPjx0ZD5wcm9tcHQ8L3RkPjx0ZD4ke3Byb21wdH08L3RkPjx0ZD5ObzwvdGQ+PHRkPk5vPC90ZD48dGQ+VmFsaWQgdmFsdWVzIHRoYXQgc3BlY2lmeSBpZiB0aGUgYXV0aG9yaXphdGlvbiBzZXJ2ZXIgc2hvdWxkIChyZS0pYXV0aGVudGljYXRlIHRoZSB1c2VyOiAnbm9uZSd8J2xvZ2luJ3wnY29uc2VudCd8J3NlbGVjdF9hY2NvdW50JzwvdGQ+PC90cj4NCjwvdGFibGU+DQo8YnIvPg0KPHA+VGhlIGNsaWVudCBpcyBzZW5kaW5nIHRoZSByZXF1ZXN0IHRvIHRoaXMgYXV0aG9yaXphdGlvbiBzZXJ2ZXIgdXNpbmcgSFRUUCAnR0VUJzo8L3A+PHByZT4ke2xvY2F0aW9uX2F1dGhzZXJ2ZXJ9PC9wcmU+DQo8YnIvPg0KPHA+VGhlIHBhcmFtZXRlciB2YWx1ZXMgbXVzdCBiZSAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJyBlbmNvZGVkOjwvcD4NCjxmb3JtIGFjdGlvbj0iJHtsb2NhdGlvbl9hcHB9Ij4NCiAgICA8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJzdGF0ZSIgdmFsdWU9ImluaXQiLz4NCiAgICA8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJub25jZSIgdmFsdWU9IiR7bm9uY2V9Ii8+DQogICAgPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1wcmltYXJ5IiB0eXBlPSJzdWJtaXQiIG5hbWU9InNlbmQiIHZhbHVlPSJzZW5kIj5TZW5kPC9idXR0b24+DQo8L2Zvcm0+DQo8YnIvPg0KPHA+KFdoZW4geW91IGhpdCB0aGUgJ3NlbmQnIGJ1dHRvbiB0aGlzIHVzZXItYWdlbnQgc2VuZHMgYSByZXF1ZXN0IHRvIHRoZSBjbGllbnQsIHRoZSBjbGllbnQgcHJlcGFyZXMgdGhlIGF1dGhvcml6YXRpb24gcmVxdWVzdCBhbmQgZGlyZWN0cyB0aGlzIHVzZXItYWdlbnQgdG8gdGhlIHNlcnZlciBsb2NhdGlvbiB1c2luZyBhIHJlZGlyZWN0KTwvcD4NCiR7aHRtbFRlbXBsYXRlQm90dG9tfQ=="/>
                            <L7p:ResponseContentType stringValue="text/html;charset=UTF-8"/>
                        </L7p:HardcodedResponse>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="INITIAL"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                </wsp:OneOrMore>
                <L7p:assertionComment>
                    <L7p:Properties mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="LEFT.COMMENT"/>
                            <L7p:value stringValue="Implicit Client Profile"/>
                        </L7p:entry>
                        <L7p:entry>
                            <L7p:key stringValue="RIGHT.COMMENT"/>
                            <L7p:value stringValue="response_type=token id_token"/>
                        </L7p:entry>
                    </L7p:Properties>
                </L7p:assertionComment>
            </wsp:All>
        </wsp:OneOrMore>
    </wsp:All>
</wsp:Policy>