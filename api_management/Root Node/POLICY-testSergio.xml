<?xml version="1.0" encoding="UTF-8"?>
<wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy">
    <wsp:All wsp:Usage="Required">
        <L7p:Include>
            <L7p:PolicyGuid stringValue="812ed196-c315-4e92-b630-b5c64c5c043c"/>
        </L7p:Include>
        <L7p:ApiPortalIntegration>
            <L7p:ApiGroup stringValue=""/>
            <L7p:ApiId stringValue="e597e84a-9b9a-4cd1-82fe-cafff27b9a43"/>
            <L7p:PortalManagedApiFlag stringValue="L7p:ApiPortalManagedServiceAssertion"/>
        </L7p:ApiPortalIntegration>
        <L7p:Encapsulated>
            <L7p:Enabled booleanValue="false"/>
            <L7p:EncapsulatedAssertionConfigGuid stringValue="8a48ee76-a432-4013-85b6-428c65bd182d"/>
            <L7p:EncapsulatedAssertionConfigName stringValue="API Portal Integration - OAuth 2.0"/>
        </L7p:Encapsulated>
        <L7p:AuditDetailAssertion>
            <L7p:CustomLoggerSuffix stringValue="entel.api.system"/>
            <L7p:Detail stringValue="IDTRANSACTION: ${requestId} HEADER: ${request.http.allheadervalues} REQUEST GW: ${request.mainpart} "/>
            <L7p:LoggingOnly booleanValue="true"/>
        </L7p:AuditDetailAssertion>
        <L7p:SetVariable>
            <L7p:Base64Expression stringValue="JHtyZXF1ZXN0LnRpbWUubG9jYWwueXl5eS1NTS1kZCdUJ0hIOm1tOnNzLlNTU30="/>
            <L7p:VariableToSet stringValue="responseTimestamp"/>
        </L7p:SetVariable>
        <L7p:SetVariable>
            <L7p:Base64Expression stringValue="JHtvcGVyYXRpb24wfXwke29wZXJhdGlvbjF9fCR7b3BlcmF0aW9uMn18JHtvcGVyYXRpb24zfXwke29wZXJhdGlvbjR9fCR7b3BlcmF0aW9uNX18JHtvcGVyYXRpb242fXwke29wZXJhdGlvbjd9fCR7b3BlcmF0aW9uOH18JHtvcGVyYXRpb245fXwke29wZXJhdGlvbjEwfQ=="/>
            <L7p:VariableToSet stringValue="operations"/>
        </L7p:SetVariable>
        <L7p:Split>
            <L7p:IgnoreEmptyValues booleanValue="true"/>
            <L7p:InputVariable stringValue="operations"/>
            <L7p:OutputVariable stringValue="operation"/>
            <L7p:SplitPattern stringValue="|"/>
            <L7p:SplitPatternRegEx booleanValue="false"/>
        </L7p:Split>
        <L7p:Regex>
            <L7p:AutoTarget booleanValue="false"/>
            <L7p:CaptureVar stringValue="permittedMethods"/>
            <L7p:OtherTargetMessageVariable stringValue="operations"/>
            <L7p:Regex stringValue="GET|POST|PUT|DELETE"/>
            <L7p:Replace booleanValue="true"/>
            <L7p:Replacement stringValue=""/>
            <L7p:Target target="OTHER"/>
        </L7p:Regex>
        <L7p:HardcodedResponse>
            <L7p:Base64ResponseBody stringValue="b3BlcmF0aW9uWzBdOiAke29wZXJhdGlvblswXX0Kb3BlcmF0aW9uWzFdOiAke29wZXJhdGlvblsxXX0Kb3BlcmF0aW9uWzJdOiAke29wZXJhdGlvblsyXX0Kb3BlcmF0aW9uWzNdOiAke29wZXJhdGlvblszXX0Kb3BlcmF0aW9uczogJHtvcGVyYXRpb25zfQpwZXJtaXR0ZWRNZXRob2RzOiAke3Blcm1pdHRlZE1ldGhvZHN9"/>
        </L7p:HardcodedResponse>
        <wsp:OneOrMore L7p:Enabled="false" wsp:Usage="Required">
            <wsp:All L7p:Enabled="false" wsp:Usage="Required">
                <wsp:OneOrMore L7p:Enabled="false" wsp:Usage="Required">
                    <wsp:All L7p:Enabled="false" wsp:Usage="Required">
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${permittedMethods}"/>
                            <L7p:Expression2 stringValue="${request.http.method}"/>
                            <L7p:Operator operator="CONTAINS"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Operator operator="CONTAINS"/>
                                    <L7p:RightValue stringValue="${request.http.method}"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <wsp:OneOrMore wsp:Usage="Required">
                            <wsp:All wsp:Usage="Required">
                                <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${request.http.uri}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item regex="included">
                                    <L7p:Pattern stringValue="^\/resource\/physicalResource\/v1\/physicalDevices$"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:Include>
                                    <L7p:PolicyGuid stringValue="3c5eef99-5a62-419a-b5d5-0dc55d3760ed"/>
                                </L7p:Include>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="Recurso1"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:All>
                            <wsp:All wsp:Usage="Required">
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="Recurso2"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:All>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="Evaluar rutas y recursos"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:OneOrMore>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue="POST"/>
                                </L7p:entry>
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="Evaluar Método POST"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <wsp:All L7p:Enabled="false" wsp:Usage="Required">
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${request.http.method}"/>
                            <L7p:Expression2 stringValue="OPTIONS"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="OPTIONS"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:AddHeader>
                            <L7p:AssertionComment assertionComment="included">
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue="Indicar metodos implementados"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:AssertionComment>
                            <L7p:HeaderName stringValue="Allow"/>
                            <L7p:HeaderValue stringValue="${permittedMethods}"/>
                            <L7p:Target target="RESPONSE"/>
                        </L7p:AddHeader>
                        <L7p:HardcodedResponse>
                            <L7p:ResponseContentType stringValue="application/json; charset=UTF-8"/>
                        </L7p:HardcodedResponse>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue="OPTIONS"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <wsp:All L7p:Enabled="false" wsp:Usage="Required">
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="NDA1"/>
                            <L7p:VariableToSet stringValue="code"/>
                        </L7p:SetVariable>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="TcOpdG9kbyBubyBwZXJtaXRpZG8="/>
                            <L7p:VariableToSet stringValue="description"/>
                        </L7p:SetVariable>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="VW5hIHBldGljacOzbiBmdWUgaGVjaGEgYSB1bmEgVVJJIHV0aWxpemFuZG8gdW4gbcOpdG9kbyBkZSBzb2xpY2l0dWQgbm8gc29wb3J0YWRvLg=="/>
                            <L7p:VariableToSet stringValue="descriptionDetail"/>
                        </L7p:SetVariable>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="JHtyZXF1ZXN0LnRpbWUubG9jYWwueXl5eS9NTS9kZCdUJ0hIOm1tOnNzLlNTU30="/>
                            <L7p:VariableToSet stringValue="responseTimestamp"/>
                        </L7p:SetVariable>
                        <L7p:AuditDetailAssertion>
                            <L7p:CustomLoggerSuffix stringValue="entel.api.syslog"/>
                            <L7p:Detail stringValue="IDTRANSACTION: ${requestId} SERVICE: ${httpRouting.url} LATENCY: ${httpRouting.latency} HTTP STATUS: ${httpRouting.reasonCode} DESCRIPTION: ${description} DESCRIPTION: ${descriptionDetail} CODE: ${code} BODY: ${httpRouting.reasonCode} REQUEST:${request}"/>
                            <L7p:LoggingOnly booleanValue="true"/>
                        </L7p:AuditDetailAssertion>
                        <L7p:CustomizeErrorResponse>
                            <L7p:Content stringValueReference="inline"><![CDATA[{
"result":{
	"transactionId":"${requestId}",
	"code":"${code}",
	"description":"${description}",
	"descriptionDetail":"${descriptionDetail}",
	"responseTimestamp":"${responseTimestamp}"
	}
}]]></L7p:Content>
                            <L7p:ContentType stringValue="application/json; charset=UTF-8"/>
                            <L7p:ExtraHeaders nameValuePairArray="included">
                                <L7p:item nameValuePair="included">
                                    <L7p:Key stringValue="Allow"/>
                                    <L7p:Value stringValue="POST, OPTIONS"/>
                                </L7p:item>
                            </L7p:ExtraHeaders>
                            <L7p:HttpStatus stringValue="405"/>
                        </L7p:CustomizeErrorResponse>
                        <L7p:RaiseError/>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="Método no permitido"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="Evaluar Métodos"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:OneOrMore>
            </wsp:All>
            <wsp:All L7p:Enabled="false" wsp:Usage="Required">
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="NDA0"/>
                    <L7p:VariableToSet stringValue="code"/>
                </L7p:SetVariable>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="UmVjdXJzbyBubyBlbmNvbnRyYWRv"/>
                    <L7p:VariableToSet stringValue="description"/>
                </L7p:SetVariable>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="RWwgcmVjdXJzbyBubyBleGlzdGUgbyBlc3RhIGRlc2hhYmlsaXRhZG8="/>
                    <L7p:VariableToSet stringValue="descriptionDetail"/>
                </L7p:SetVariable>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="JHtyZXF1ZXN0LnRpbWUubG9jYWwueXl5eS9NTS9kZCdUJ0hIOm1tOnNzLlNTU30="/>
                    <L7p:VariableToSet stringValue="responseTimestamp"/>
                </L7p:SetVariable>
                <L7p:AuditDetailAssertion>
                    <L7p:CustomLoggerSuffix stringValue="entel.api.syslog"/>
                    <L7p:Detail stringValue="TRANSACTION: ${requestId} CODE: ${code} DESCRIPTION: ${description} DETAIL: ${descriptionDetail}"/>
                    <L7p:LoggingOnly booleanValue="true"/>
                </L7p:AuditDetailAssertion>
                <L7p:CustomizeErrorResponse>
                    <L7p:Content stringValueReference="inline"><![CDATA[{
"result":{
	"transactionId":"${requestId}",
	"code":"${code}",
	"description":"${description}",
	"descriptionDetail":"${descriptionDetail}",
	"responseTimestamp":"${responseTimestamp}"
	}
}]]></L7p:Content>
                    <L7p:ContentType stringValue="application/json; charset=UTF-8"/>
                    <L7p:ExtraHeaders nameValuePairArray="included"/>
                    <L7p:HttpStatus stringValue="404"/>
                </L7p:CustomizeErrorResponse>
                <L7p:RaiseError/>
                <L7p:assertionComment>
                    <L7p:Properties mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="LEFT.COMMENT"/>
                            <L7p:value stringValue="Camino no implementado"/>
                        </L7p:entry>
                    </L7p:Properties>
                </L7p:assertionComment>
            </wsp:All>
        </wsp:OneOrMore>
        <L7p:ExportVariables>
            <L7p:Enabled booleanValue="false"/>
            <L7p:ExportedVars stringArrayValue="included">
                <L7p:item stringValue="code"/>
                <L7p:item stringValue="codeapplication.result"/>
                <L7p:item stringValue="codedescription"/>
                <L7p:item stringValue="codeSource"/>
                <L7p:item stringValue="codeSource.count"/>
                <L7p:item stringValue="codeSource.found"/>
                <L7p:item stringValue="codeSource.result"/>
                <L7p:item stringValue="codeSource.results"/>
                <L7p:item stringValue="cors.isCORS"/>
                <L7p:item stringValue="cors.isPreflight"/>
                <L7p:item stringValue="description"/>
                <L7p:item stringValue="descriptionDetail"/>
                <L7p:item stringValue="descriptionDetail.count"/>
                <L7p:item stringValue="descriptionDetail.found"/>
                <L7p:item stringValue="descriptionDetail.result"/>
                <L7p:item stringValue="descriptionDetail.results"/>
                <L7p:item stringValue="header"/>
                <L7p:item stringValue="httpRouting.latency"/>
                <L7p:item stringValue="httpRouting.reasonCode"/>
                <L7p:item stringValue="httpRouting.url"/>
                <L7p:item stringValue="message"/>
                <L7p:item stringValue="message.mainpart"/>
                <L7p:item stringValue="operation"/>
                <L7p:item stringValue="operation0"/>
                <L7p:item stringValue="operation1"/>
                <L7p:item stringValue="operation2"/>
                <L7p:item stringValue="operation3"/>
                <L7p:item stringValue="operation4"/>
                <L7p:item stringValue="operation5"/>
                <L7p:item stringValue="operations"/>
                <L7p:item stringValue="permittedMethods"/>
                <L7p:item stringValue="portal.managed.service.apiGroup"/>
                <L7p:item stringValue="portal.managed.service.apiId"/>
                <L7p:item stringValue="responseTimestamp"/>
                <L7p:item stringValue="resultBody.count"/>
                <L7p:item stringValue="resultBody.found"/>
                <L7p:item stringValue="resultBody.result"/>
                <L7p:item stringValue="resultBody.results"/>
                <L7p:item stringValue="resultBody2"/>
                <L7p:item stringValue="serviceResponse"/>
            </L7p:ExportedVars>
        </L7p:ExportVariables>
    </wsp:All>
</wsp:Policy>