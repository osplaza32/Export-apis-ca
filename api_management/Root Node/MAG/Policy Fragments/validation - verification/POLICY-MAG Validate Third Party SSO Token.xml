<?xml version="1.0" encoding="UTF-8"?>
<wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy">
    <wsp:All wsp:Usage="Required">
        <L7p:CommentAssertion>
            <L7p:Comment stringValue=" ============================================"/>
        </L7p:CommentAssertion>
        <L7p:CommentAssertion>
            <L7p:Comment stringValue=" === ***  THIS POLICY IS READ ONLY ***"/>
        </L7p:CommentAssertion>
        <L7p:CommentAssertion>
            <L7p:Comment stringValue=" === If you have the need to customize this policy"/>
        </L7p:CommentAssertion>
        <L7p:CommentAssertion>
            <L7p:Comment stringValue=" === please contact CA APIM Support so we can improve customization capability"/>
        </L7p:CommentAssertion>
        <L7p:CommentAssertion>
            <L7p:Comment stringValue=" ============================================"/>
        </L7p:CommentAssertion>
        <L7p:CommentAssertion>
            <L7p:Comment stringValue="This policy can be found and should be used as 'Encapsulated Assertion'!"/>
        </L7p:CommentAssertion>
        <L7p:ResponseXpathAssertion>
            <L7p:VariablePrefix stringValue="xpathSSOToken"/>
            <L7p:XmlMsgSrc stringValue="resp"/>
            <L7p:XpathExpression xpathExpressionValue="included">
                <L7p:Expression stringValue="/ns:validation/ns:third_party_sso_token"/>
                <L7p:Namespaces mapValue="included">
                    <L7p:entry>
                        <L7p:key stringValue="ns"/>
                        <L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-ovp"/>
                    </L7p:entry>
                    <L7p:entry>
                        <L7p:key stringValue="s"/>
                        <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                    </L7p:entry>
                </L7p:Namespaces>
                <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
            </L7p:XpathExpression>
        </L7p:ResponseXpathAssertion>
        <L7p:ResponseXpathAssertion>
            <L7p:VariablePrefix stringValue="xpathSSOTokenType"/>
            <L7p:XmlMsgSrc stringValue="resp"/>
            <L7p:XpathExpression xpathExpressionValue="included">
                <L7p:Expression stringValue="/ns:validation/ns:third_party_sso_token_type"/>
                <L7p:Namespaces mapValue="included">
                    <L7p:entry>
                        <L7p:key stringValue="ns"/>
                        <L7p:value stringValue="http://ns.l7tech.com/2012/11/otk-ovp"/>
                    </L7p:entry>
                    <L7p:entry>
                        <L7p:key stringValue="s"/>
                        <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                    </L7p:entry>
                </L7p:Namespaces>
                <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
            </L7p:XpathExpression>
        </L7p:ResponseXpathAssertion>
        <L7p:Encapsulated>
            <L7p:EncapsulatedAssertionConfigGuid stringValue="291ff570-361e-4011-8117-1a8d3a34e5bf"/>
            <L7p:EncapsulatedAssertionConfigName stringValue="MAG Session Validation - Third Party SSO Token"/>
            <L7p:Parameters mapValue="included">
                <L7p:entry>
                    <L7p:key stringValue="assertion"/>
                    <L7p:value stringValue="${xpathSSOToken.result}"/>
                </L7p:entry>
                <L7p:entry>
                    <L7p:key stringValue="third_party_sso_token"/>
                    <L7p:value stringValue="${xpathSSOToken.result}"/>
                </L7p:entry>
                <L7p:entry>
                    <L7p:key stringValue="third_party_sso_token_type"/>
                    <L7p:value stringValue="${xpathSSOTokenType.result}"/>
                </L7p:entry>
            </L7p:Parameters>
        </L7p:Encapsulated>
        <L7p:ComparisonAssertion>
            <L7p:CaseSensitive booleanValue="false"/>
            <L7p:Expression1 stringValue="${third_party_sso_token_state}"/>
            <L7p:Expression2 stringValue="active"/>
            <L7p:Predicates predicates="included">
                <L7p:item binary="included">
                    <L7p:CaseSensitive booleanValue="false"/>
                    <L7p:RightValue stringValue="active"/>
                </L7p:item>
            </L7p:Predicates>
        </L7p:ComparisonAssertion>
    </wsp:All>
</wsp:Policy>