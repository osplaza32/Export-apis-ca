<?xml version="1.0" encoding="UTF-8"?>
<wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy">
    <wsp:All wsp:Usage="Required">
        <L7p:CommentAssertion>
            <L7p:Comment stringValue=" ============================================"/>
        </L7p:CommentAssertion>
        <L7p:CommentAssertion>
            <L7p:Comment stringValue=" === ***  THIS POLICY IS READ ONLY ***"/>
        </L7p:CommentAssertion>
        <L7p:CommentAssertion>
            <L7p:Comment stringValue=" === Required changes can be implemented in OTK policies in the 'Customizations' folder "/>
        </L7p:CommentAssertion>
        <L7p:CommentAssertion>
            <L7p:Comment stringValue=" === The policy within that folder is named '#OTK Fail with error message' "/>
        </L7p:CommentAssertion>
        <L7p:CommentAssertion>
            <L7p:Comment stringValue=" === If you find you cannot add your customizations using the policies in the 'Customizations' folder"/>
        </L7p:CommentAssertion>
        <L7p:CommentAssertion>
            <L7p:Comment stringValue=" === please contact CA APIM Support so we can improve customization capability"/>
        </L7p:CommentAssertion>
        <L7p:CommentAssertion>
            <L7p:Comment stringValue=" ============================================"/>
        </L7p:CommentAssertion>
        <L7p:CommentAssertion>
            <L7p:Comment stringValue="This policy should be used as an encapsulated assertion"/>
        </L7p:CommentAssertion>
        <L7p:CommentAssertion>
            <L7p:Comment stringValue="OTK has error responses configured that can be extended here"/>
        </L7p:CommentAssertion>
        <L7p:CommentAssertion>
            <L7p:Comment stringValue="MAG policies pass in an error code and this encapsulated assertion will return appropriate errors"/>
        </L7p:CommentAssertion>
        <L7p:CommentAssertion>
            <L7p:Comment stringValue="Customizations:"/>
        </L7p:CommentAssertion>
        <L7p:CommentAssertion>
            <L7p:Comment stringValue="DO NOT CHANGE OR OVERWRITE EXISTING ERROR CODES!"/>
        </L7p:CommentAssertion>
        <L7p:CommentAssertion>
            <L7p:Comment stringValue="==="/>
        </L7p:CommentAssertion>
        <L7p:HandleErrors L7p:Usage="Required"
            includeIOException="false" variablePrefix="errors">
            <wsp:OneOrMore wsp:Usage="Required">
                <L7p:CommentAssertion>
                    <L7p:Comment stringValue="CA Mobile API Gateway OTP feature related"/>
                </L7p:CommentAssertion>
                <wsp:All wsp:Usage="Required">
                    <L7p:Encapsulated>
                        <L7p:EncapsulatedAssertionConfigGuid stringValue="c9cca8d0-0795-4cae-9e80-2c754b6301c2"/>
                        <L7p:EncapsulatedAssertionConfigName stringValue="OTP Fail with error message"/>
                        <L7p:NoOpIfConfigMissing booleanValue="true"/>
                    </L7p:Encapsulated>
                    <L7p:ComparisonAssertion>
                        <L7p:CaseSensitive booleanValue="false"/>
                        <L7p:Expression1 stringValue="${error.msg}"/>
                        <L7p:Expression2 stringValue=""/>
                        <L7p:Negate booleanValue="true"/>
                        <L7p:Operator operator="EMPTY"/>
                        <L7p:Predicates predicates="included">
                            <L7p:item binary="included">
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Negated booleanValue="true"/>
                                <L7p:Operator operator="EMPTY"/>
                                <L7p:RightValue stringValue=""/>
                            </L7p:item>
                        </L7p:Predicates>
                    </L7p:ComparisonAssertion>
                </wsp:All>
                <L7p:CommentAssertion>
                    <L7p:Comment stringValue="Error cases related to device usage and requests"/>
                </L7p:CommentAssertion>
                <wsp:All wsp:Usage="Required">
                    <L7p:ComparisonAssertion>
                        <L7p:CaseSensitive booleanValue="false"/>
                        <L7p:Expression1 stringValue="${givenErrorCode}"/>
                        <L7p:Expression2 stringValue="101"/>
                        <L7p:Predicates predicates="included">
                            <L7p:item binary="included">
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:RightValue stringValue="101"/>
                            </L7p:item>
                        </L7p:Predicates>
                    </L7p:ComparisonAssertion>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="NDAw"/>
                        <L7p:VariableToSet stringValue="status"/>
                    </L7p:SetVariable>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="ew0KICAiZXJyb3IiOiJkZXZpY2VfcmVnaXN0cmF0aW9uX2Vycm9yIiwNCiAgImVycm9yX2Rlc2NyaXB0aW9uIjoiVGhlIGdpdmVuIEROIGlzIG5vdCB2YWxpZCINCn0="/>
                        <L7p:VariableToSet stringValue="error.msg"/>
                    </L7p:SetVariable>
                    <L7p:RaiseError/>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="LEFT.COMMENT"/>
                                <L7p:value stringValue="101"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="invalid DN"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:All>
                <wsp:All wsp:Usage="Required">
                    <L7p:ComparisonAssertion>
                        <L7p:CaseSensitive booleanValue="false"/>
                        <L7p:Expression1 stringValue="${givenErrorCode}"/>
                        <L7p:Expression2 stringValue="102"/>
                        <L7p:Predicates predicates="included">
                            <L7p:item binary="included">
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:RightValue stringValue="102"/>
                            </L7p:item>
                        </L7p:Predicates>
                    </L7p:ComparisonAssertion>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="NDAw"/>
                        <L7p:VariableToSet stringValue="status"/>
                    </L7p:SetVariable>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="ew0KICAiZXJyb3IiOiJkZXZpY2VfcmVnaXN0cmF0aW9uX2Vycm9yIiwNCiAgImVycm9yX2Rlc2NyaXB0aW9uIjoiVGhlIGdpdmVuIGNlcnQtZm9ybWF0IGZvciB0aGUgcmVzcG9uc2UgaXMgbm90IHZhbGlkIg0KfQ=="/>
                        <L7p:VariableToSet stringValue="error.msg"/>
                    </L7p:SetVariable>
                    <L7p:RaiseError/>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="LEFT.COMMENT"/>
                                <L7p:value stringValue="102"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="invalid request certificate format"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:All>
                <wsp:All wsp:Usage="Required">
                    <L7p:ComparisonAssertion>
                        <L7p:CaseSensitive booleanValue="false"/>
                        <L7p:Expression1 stringValue="${givenErrorCode}"/>
                        <L7p:Expression2 stringValue="104"/>
                        <L7p:Predicates predicates="included">
                            <L7p:item binary="included">
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:RightValue stringValue="104"/>
                            </L7p:item>
                        </L7p:Predicates>
                    </L7p:ComparisonAssertion>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="NDAw"/>
                        <L7p:VariableToSet stringValue="status"/>
                    </L7p:SetVariable>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="ew0KICAiZXJyb3IiOiJkZXZpY2VfcmVnaXN0cmF0aW9uX2Vycm9yIiwNCiAgImVycm9yX2Rlc2NyaXB0aW9uIjoiQW4gaW52YWxpZCBDU1Igd2FzIGZvdW5kIGFuZCBjb3VsZCBub3QgYmUgc2lnbmVkIg0KfQ=="/>
                        <L7p:VariableToSet stringValue="error.msg"/>
                    </L7p:SetVariable>
                    <L7p:RaiseError/>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="LEFT.COMMENT"/>
                                <L7p:value stringValue="104"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="invalid CSR"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:All>
                <wsp:All wsp:Usage="Required">
                    <L7p:ComparisonAssertion>
                        <L7p:CaseSensitive booleanValue="false"/>
                        <L7p:Expression1 stringValue="${givenErrorCode}"/>
                        <L7p:Expression2 stringValue="105"/>
                        <L7p:Predicates predicates="included">
                            <L7p:item binary="included">
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:RightValue stringValue="105"/>
                            </L7p:item>
                        </L7p:Predicates>
                    </L7p:ComparisonAssertion>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="NDAw"/>
                        <L7p:VariableToSet stringValue="status"/>
                    </L7p:SetVariable>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="ew0KICAiZXJyb3IiOiJkZXZpY2VfcmVnaXN0cmF0aW9uX2Vycm9yIiwNCiAgImVycm9yX2Rlc2NyaXB0aW9uIjoiVGhlIGRldmljZSBoYXMgYWxyZWFkeSBiZWVuIHJlZ2lzdGVyZWQiDQp9"/>
                        <L7p:VariableToSet stringValue="error.msg"/>
                    </L7p:SetVariable>
                    <L7p:RaiseError/>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="LEFT.COMMENT"/>
                                <L7p:value stringValue="105"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="device is already registered"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:All>
                <wsp:All wsp:Usage="Required">
                    <L7p:ComparisonAssertion>
                        <L7p:CaseSensitive booleanValue="false"/>
                        <L7p:Expression1 stringValue="${givenErrorCode}"/>
                        <L7p:Expression2 stringValue="106"/>
                        <L7p:Predicates predicates="included">
                            <L7p:item binary="included">
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:RightValue stringValue="106"/>
                            </L7p:item>
                        </L7p:Predicates>
                    </L7p:ComparisonAssertion>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="NDAw"/>
                        <L7p:VariableToSet stringValue="status"/>
                    </L7p:SetVariable>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="ew0KICAiZXJyb3IiOiJkZXZpY2VfcmVtb3ZhbF9lcnJvciIsDQogICJlcnJvcl9kZXNjcmlwdGlvbiI6Ik5laXRoZXIgdGhlIGRldmljZSByZWdpc3RyYXRpb24gbm9yIGFzc29jaWF0ZWQgdG9rZW4gKGlkX3Rva2VuLCBvYXV0aF90b2tlbiwgcmVmcmVzaF90b2tlbikgY291bGQgYmUgcmVtb3ZlZCINCn0="/>
                        <L7p:VariableToSet stringValue="error.msg"/>
                    </L7p:SetVariable>
                    <L7p:RaiseError/>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="LEFT.COMMENT"/>
                                <L7p:value stringValue="106"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="device related token could not be removed"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:All>
                <wsp:All wsp:Usage="Required">
                    <L7p:ComparisonAssertion>
                        <L7p:CaseSensitive booleanValue="false"/>
                        <L7p:Expression1 stringValue="${givenErrorCode}"/>
                        <L7p:Expression2 stringValue="107"/>
                        <L7p:Predicates predicates="included">
                            <L7p:item binary="included">
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:RightValue stringValue="107"/>
                            </L7p:item>
                        </L7p:Predicates>
                    </L7p:ComparisonAssertion>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="NDAw"/>
                        <L7p:VariableToSet stringValue="status"/>
                    </L7p:SetVariable>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="ew0KICAiZXJyb3IiOiJpbnZhbGlkX3JlcXVlc3QiLA0KICAiZXJyb3JfZGVzY3JpcHRpb24iOiJUaGUgZ2l2ZW4gbWFnLWlkZW50aWZpZXIgaXMgZWl0aGVyIGludmFsaWQgb3IgcG9pbnRzIHRvIGFuIHVua25vd24gZGV2aWNlIg0KfQ=="/>
                        <L7p:VariableToSet stringValue="error.msg"/>
                    </L7p:SetVariable>
                    <L7p:RaiseError/>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="LEFT.COMMENT"/>
                                <L7p:value stringValue="107"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="invalid mag-identifier"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:All>
                <wsp:All wsp:Usage="Required">
                    <L7p:ComparisonAssertion>
                        <L7p:CaseSensitive booleanValue="false"/>
                        <L7p:Expression1 stringValue="${givenErrorCode}"/>
                        <L7p:Expression2 stringValue="108"/>
                        <L7p:Predicates predicates="included">
                            <L7p:item binary="included">
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:RightValue stringValue="108"/>
                            </L7p:item>
                        </L7p:Predicates>
                    </L7p:ComparisonAssertion>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="NDAw"/>
                        <L7p:VariableToSet stringValue="status"/>
                    </L7p:SetVariable>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="ew0KICAiZXJyb3IiOiJpbnZhbGlkX3JlcXVlc3QiLA0KICAiZXJyb3JfZGVzY3JpcHRpb24iOiJUaGUgcmVmZXJlbmNlZCBkZXZpY2UgaXMgbm90IGFjdGl2YXRlZCINCn0="/>
                        <L7p:VariableToSet stringValue="error.msg"/>
                    </L7p:SetVariable>
                    <L7p:RaiseError/>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="LEFT.COMMENT"/>
                                <L7p:value stringValue="108"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="deactivated device"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:All>
                <wsp:All wsp:Usage="Required">
                    <L7p:ComparisonAssertion>
                        <L7p:CaseSensitive booleanValue="false"/>
                        <L7p:Expression1 stringValue="${givenErrorCode}"/>
                        <L7p:Expression2 stringValue="111"/>
                        <L7p:Predicates predicates="included">
                            <L7p:item binary="included">
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:RightValue stringValue="111"/>
                            </L7p:item>
                        </L7p:Predicates>
                    </L7p:ComparisonAssertion>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="NDAw"/>
                        <L7p:VariableToSet stringValue="status"/>
                    </L7p:SetVariable>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="ew0KICAiZXJyb3IiOiJkZXZpY2VfYXV0aG9yaXphdGlvbl9lcnJvciIsDQogICJlcnJvcl9kZXNjcmlwdGlvbiI6IlRoZSBzZXJ2aWNlIGlzIHRlbXBvcmFyaWx5IG5vdCBhdmFpbGFibGUiDQp9"/>
                        <L7p:VariableToSet stringValue="error.msg"/>
                    </L7p:SetVariable>
                    <L7p:RaiseError/>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="LEFT.COMMENT"/>
                                <L7p:value stringValue="111"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="too many connection attempts"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:All>
                <wsp:All wsp:Usage="Required">
                    <L7p:ComparisonAssertion>
                        <L7p:CaseSensitive booleanValue="false"/>
                        <L7p:Expression1 stringValue="${givenErrorCode}"/>
                        <L7p:Expression2 stringValue="206"/>
                        <L7p:Predicates predicates="included">
                            <L7p:item binary="included">
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:RightValue stringValue="206"/>
                            </L7p:item>
                        </L7p:Predicates>
                    </L7p:ComparisonAssertion>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="NDAx"/>
                        <L7p:VariableToSet stringValue="status"/>
                    </L7p:SetVariable>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="ew0KICAiZXJyb3IiOiJpbnZhbGlkX3JlcXVlc3QiLA0KICAiZXJyb3JfZGVzY3JpcHRpb24iOiJUaGUgY2xpZW50IGNlcnRpZmljYXRlIGhhcyBleHBpcmVkIg0KfQ=="/>
                        <L7p:VariableToSet stringValue="error.msg"/>
                    </L7p:SetVariable>
                    <L7p:RaiseError/>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="LEFT.COMMENT"/>
                                <L7p:value stringValue="206"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="expired client certificate"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:All>
                <L7p:assertionComment>
                    <L7p:Properties mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="LEFT.COMMENT"/>
                            <L7p:value stringValue="error"/>
                        </L7p:entry>
                        <L7p:entry>
                            <L7p:key stringValue="RIGHT.COMMENT"/>
                            <L7p:value stringValue="Find the appropriate error"/>
                        </L7p:entry>
                    </L7p:Properties>
                </L7p:assertionComment>
            </wsp:OneOrMore>
        </L7p:HandleErrors>
    </wsp:All>
</wsp:Policy>