<?xml version="1.0" encoding="UTF-8"?>
<wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy">
    <wsp:All wsp:Usage="Required">
        <L7p:CommentAssertion>
            <L7p:Comment stringValue="Add context variables below to override variables set in &quot;MAG Device Enrollment Configuration&quot;"/>
        </L7p:CommentAssertion>
        <L7p:CommentAssertion>
            <L7p:Comment stringValue="Copy variables from the target policy into this policy to overwrite default values."/>
        </L7p:CommentAssertion>
        <L7p:CommentAssertion>
            <L7p:Comment stringValue="To use values per client enable the following branch and add the matching JSON configuration into the custom field of oauth clients in OAuth Manager."/>
        </L7p:CommentAssertion>
        <L7p:CommentAssertion>
            <L7p:Comment stringValue="See the docops documentation for more details."/>
        </L7p:CommentAssertion>
        <wsp:OneOrMore L7p:Enabled="false" wsp:Usage="Required">
            <L7p:ComparisonAssertion>
                <L7p:CaseSensitive booleanValue="false"/>
                <L7p:Expression1 stringValue="${custom_client}"/>
                <L7p:Expression2 stringValue=""/>
                <L7p:Operator operator="EMPTY"/>
                <L7p:Predicates predicates="included">
                    <L7p:item binary="included">
                        <L7p:CaseSensitive booleanValue="false"/>
                        <L7p:Operator operator="EMPTY"/>
                        <L7p:RightValue stringValue=""/>
                    </L7p:item>
                </L7p:Predicates>
            </L7p:ComparisonAssertion>
            <wsp:All wsp:Usage="Required">
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="JHtjdXN0b21fY2xpZW50fQ=="/>
                    <L7p:ContentType stringValue="application/json; charset=utf-8"/>
                    <L7p:DataType variableDataType="message"/>
                    <L7p:VariableToSet stringValue="clientCustom"/>
                </L7p:SetVariable>
                <wsp:OneOrMore wsp:Usage="Required">
                    <wsp:All wsp:Usage="Required">
                        <L7p:EvaluateJsonPathExpression>
                            <L7p:Expression stringValue="$..sdk_enrollment"/>
                            <L7p:OtherTargetMessageVariable stringValue="clientCustom"/>
                            <L7p:Target target="OTHER"/>
                            <L7p:VariablePrefix stringValue="enrollment"/>
                        </L7p:EvaluateJsonPathExpression>
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${enrollment.count}"/>
                            <L7p:Expression2 stringValue="1"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="1"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <wsp:OneOrMore wsp:Usage="Required">
                            <wsp:All wsp:Usage="Required">
                                <L7p:EvaluateJsonPathExpression>
                                    <L7p:Expression stringValue="$..sdk_enrollment.enrollment_url"/>
                                    <L7p:OtherTargetMessageVariable stringValue="clientCustom"/>
                                    <L7p:Target target="OTHER"/>
                                    <L7p:VariablePrefix stringValue="enrollmentURL"/>
                                </L7p:EvaluateJsonPathExpression>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtlbnJvbGxtZW50VVJMLnJlc3VsdH0="/>
                                    <L7p:VariableToSet stringValue="enrollment_url"/>
                                </L7p:SetVariable>
                            </wsp:All>
                            <L7p:TrueAssertion/>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue="EnrollmentURL"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// check if an enrollmentURL has been configured for the given client"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:OneOrMore>
                        <wsp:OneOrMore wsp:Usage="Required">
                            <wsp:All wsp:Usage="Required">
                                <L7p:EvaluateJsonPathExpression>
                                    <L7p:Expression stringValue="$..sdk_enrollment.enrollment_cert_name"/>
                                    <L7p:OtherTargetMessageVariable stringValue="clientCustom"/>
                                    <L7p:Target target="OTHER"/>
                                    <L7p:VariablePrefix stringValue="enrollmentCertName"/>
                                </L7p:EvaluateJsonPathExpression>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtlbnJvbGxtZW50Q2VydE5hbWUucmVzdWx0fQ=="/>
                                    <L7p:VariableToSet stringValue="enrollment_cert_name"/>
                                </L7p:SetVariable>
                            </wsp:All>
                            <L7p:TrueAssertion/>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue="EnrollmentCert"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// check if an enrollmentCertName has been configured for the given client"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:OneOrMore>
                        <wsp:OneOrMore wsp:Usage="Required">
                            <wsp:All wsp:Usage="Required">
                                <L7p:EvaluateJsonPathExpression>
                                    <L7p:Expression stringValue="$..sdk_enrollment.enrollment_sig_secret"/>
                                    <L7p:OtherTargetMessageVariable stringValue="clientCustom"/>
                                    <L7p:Target target="OTHER"/>
                                    <L7p:VariablePrefix stringValue="enrollmentSigSecret"/>
                                </L7p:EvaluateJsonPathExpression>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtlbnJvbGxtZW50U2lnU2VjcmV0LnJlc3VsdH0="/>
                                    <L7p:VariableToSet stringValue="enrollment_sig_secret"/>
                                </L7p:SetVariable>
                            </wsp:All>
                            <L7p:TrueAssertion/>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue="EnrollmentSigSecret"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// check if an enrollmentSigSecret has been configured for the given client"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:OneOrMore>
                        <wsp:OneOrMore wsp:Usage="Required">
                            <wsp:All wsp:Usage="Required">
                                <L7p:EvaluateJsonPathExpression>
                                    <L7p:Expression stringValue="$..sdk_enrollment.enrollment_sig_alg"/>
                                    <L7p:OtherTargetMessageVariable stringValue="clientCustom"/>
                                    <L7p:Target target="OTHER"/>
                                    <L7p:VariablePrefix stringValue="enrollmentSigAlg"/>
                                </L7p:EvaluateJsonPathExpression>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtlbnJvbGxtZW50U2lnQWxnLnJlc3VsdH0="/>
                                    <L7p:VariableToSet stringValue="enrollment_sig_alg"/>
                                </L7p:SetVariable>
                            </wsp:All>
                            <L7p:TrueAssertion/>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue="EnrollmentSigAlg"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// check if an enrollmentSigAlg has been configured for the given client"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:OneOrMore>
                        <wsp:OneOrMore wsp:Usage="Required">
                            <wsp:All wsp:Usage="Required">
                                <L7p:EvaluateJsonPathExpression>
                                    <L7p:Expression stringValue="$..sdk_enrollment.enrollment_iss"/>
                                    <L7p:OtherTargetMessageVariable stringValue="clientCustom"/>
                                    <L7p:Target target="OTHER"/>
                                    <L7p:VariablePrefix stringValue="enrollmentIss"/>
                                </L7p:EvaluateJsonPathExpression>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtlbnJvbGxtZW50SXNzLnJlc3VsdH0="/>
                                    <L7p:VariableToSet stringValue="enrollment_iss"/>
                                </L7p:SetVariable>
                            </wsp:All>
                            <L7p:TrueAssertion/>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue="EnrollmentIss"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// check if an enrollment iisuer has been configured for the given client"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:OneOrMore>
                        <wsp:OneOrMore wsp:Usage="Required">
                            <wsp:All wsp:Usage="Required">
                                <L7p:EvaluateJsonPathExpression>
                                    <L7p:Expression stringValue="$..sdk_enrollment.enrollment_lifetime"/>
                                    <L7p:OtherTargetMessageVariable stringValue="clientCustom"/>
                                    <L7p:Target target="OTHER"/>
                                    <L7p:VariablePrefix stringValue="enrollmentLifetime"/>
                                </L7p:EvaluateJsonPathExpression>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtlbnJvbGxtZW50TGlmZXRpbWUucmVzdWx0fQ=="/>
                                    <L7p:VariableToSet stringValue="enrollment_lifetime"/>
                                </L7p:SetVariable>
                            </wsp:All>
                            <L7p:TrueAssertion/>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue="EnrollmentLifetime"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// check if an enrollment lifetime has been configured for the given client"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:OneOrMore>
                    </wsp:All>
                    <L7p:TrueAssertion/>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="LEFT.COMMENT"/>
                                <L7p:value stringValue="Enrollment"/>
                            </L7p:entry>
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="// check if any enrollment information is included"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:OneOrMore>
            </wsp:All>
            <L7p:assertionComment>
                <L7p:Properties mapValue="included">
                    <L7p:entry>
                        <L7p:key stringValue="LEFT.COMMENT"/>
                        <L7p:value stringValue="client_custom"/>
                    </L7p:entry>
                    <L7p:entry>
                        <L7p:key stringValue="RIGHT.COMMENT"/>
                        <L7p:value stringValue="// handle an exisiting client_custon field"/>
                    </L7p:entry>
                </L7p:Properties>
            </L7p:assertionComment>
        </wsp:OneOrMore>
    </wsp:All>
</wsp:Policy>