<?xml version="1.0" encoding="UTF-8"?>
<wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy">
    <wsp:All wsp:Usage="Required">
        <L7p:CustomAssertion>
            <L7p:base64SerializedValue>rO0ABXNyADFjb20ubDd0ZWNoLnBvbGljeS5hc3NlcnRpb24uQ3VzdG9tQXNzZXJ0aW9uSG9sZGVyZtcreFwddTICAAlaAAxpc1VpQXV0b09wZW5MAApjYXRlZ29yaWVzdAAPTGphdmEvdXRpbC9TZXQ7TAAIY2F0ZWdvcnl0ACpMY29tL2w3dGVjaC9wb2xpY3kvYXNzZXJ0aW9uL2V4dC9DYXRlZ29yeTtMAA9jdXN0b21Bc3NlcnRpb250ADFMY29tL2w3dGVjaC9wb2xpY3kvYXNzZXJ0aW9uL2V4dC9DdXN0b21Bc3NlcnRpb247TAAUY3VzdG9tTW9kdWxlRmlsZU5hbWV0ABJMamF2YS9sYW5nL1N0cmluZztMAA9kZXNjcmlwdGlvblRleHRxAH4ABEwAD3BhbGV0dGVOb2RlTmFtZXEAfgAETAAOcG9saWN5Tm9kZU5hbWVxAH4ABEwAHnJlZ2lzdGVyZWRDdXN0b21GZWF0dXJlU2V0TmFtZXEAfgAEeHIAJWNvbS5sN3RlY2gucG9saWN5LmFzc2VydGlvbi5Bc3NlcnRpb27bX2OZPL2isQIAAloAB2VuYWJsZWRMABBhc3NlcnRpb25Db21tZW50dAAvTGNvbS9sN3RlY2gvcG9saWN5L2Fzc2VydGlvbi9Bc3NlcnRpb24kQ29tbWVudDt4cAFwAXNyABFqYXZhLnV0aWwuSGFzaFNldLpEhZWWuLc0AwAAeHB3DAAAAAI/QAAAAAAAAXNyAChjb20ubDd0ZWNoLnBvbGljeS5hc3NlcnRpb24uZXh0LkNhdGVnb3J5WrCcZaFE/jUCAAJJAAVteUtleUwABm15TmFtZXEAfgAEeHAAAAALdAAQQ3VzdG9tQXNzZXJ0aW9uc3hwc3IAQWNvbS5sN3RlY2guY3VzdG9tLmFzc2VydGlvbnMuanZtbWV0cmljcy5Kdm1NZXRyaWNzRm9yQXBtQXNzZXJ0aW9uCg3soQJu444CABVaABFhdmVyYWdlU3lzdGVtTG9hZFoADWdjRWxhcHNlZFRpbWVaAA1nY01lbW9yeUFmdGVyWgAOZ2NNZW1vcnlCZWZvcmVaAAppbmNsdWRlQWxsWgASbWVtb3J5UG9vbEhlYXBQZWFrWgATbWVtb3J5UG9vbEhlYXBVc2FnZVoAFW1lbW9yeVBvb2xOb25IZWFwUGVha1oAFm1lbW9yeVBvb2xOb25IZWFwVXNhZ2VaAA5tZW1vcnlTaXplSGVhcFoAEW1lbW9yeVNpemVOb25IZWFwWgAKc3RhY2tUcmFjZUkAF3N0YWNrVHJhY2VEZXB0aE1heFZhbHVlWgALdGhyZWFkc0xpdmVaAAt0aHJlYWRzUGVha1oADHRocmVhZHNTdGF0ZVoAC3RocmVhZHNUb3A1WgAMdGhyZWFkc1RvdGFsWgAGdXBUaW1lTAALbWV0cmljc1R5cGV0ADdMY29tL2w3dGVjaC9jdXN0b20vYXNzZXJ0aW9ucy9qdm1tZXRyaWNzL0pWTU1ldHJpY1R5cGU7TAAOdmFyaWFibGVQcmVmaXhxAH4ABHhwAQEAAAABAQEBAQEAAAAAAAEBAQABAX5yADVjb20ubDd0ZWNoLmN1c3RvbS5hc3NlcnRpb25zLmp2bW1ldHJpY3MuSlZNTWV0cmljVHlwZQAAAAAAAAAAEgAAeHIADmphdmEubGFuZy5FbnVtAAAAAAAAAAASAAB4cHQABEpTT050AApqdm1NZXRyaWNzdAA0ZGVmODMyNTgwN2FmZTJkZjQxY2VlM2Y1NTA0YmJjODEzYzhhMGZkYmE0ZTRmZmFkLmphcnQAGkdldCBKVk0gTWV0cmljcyBmb3IgQ0EgQVBNdAAaR2V0IEpWTSBNZXRyaWNzIGZvciBDQSBBUE10ABpHZXQgSlZNIE1ldHJpY3MgZm9yIENBIEFQTXA=</L7p:base64SerializedValue>
        </L7p:CustomAssertion>
        <L7p:SetVariable>
            <L7p:Base64Expression stringValue="JHtqdm1NZXRyaWNzLmpzb259"/>
            <L7p:VariableToSet stringValue="jvmMetrics"/>
        </L7p:SetVariable>
        <L7p:SetVariable>
            <L7p:Base64Expression stringValue="JHtqdm1NZXRyaWNzLmRvY3VtZW50fQ=="/>
            <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
            <L7p:DataType variableDataType="message"/>
            <L7p:Enabled booleanValue="false"/>
            <L7p:VariableToSet stringValue="metricsOutput"/>
        </L7p:SetVariable>
        <L7p:SetVariable>
            <L7p:Base64Expression stringValue="JHtqdm1NZXRyaWNzLmRvY3VtZW50fQ=="/>
            <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
            <L7p:DataType variableDataType="message"/>
            <L7p:Enabled booleanValue="false"/>
            <L7p:VariableToSet stringValue="threadOutput"/>
        </L7p:SetVariable>
        <L7p:ResponseXpathAssertion>
            <L7p:Enabled booleanValue="false"/>
            <L7p:VariablePrefix stringValue="hostname"/>
            <L7p:XmlMsgSrc stringValue="metricsOutput"/>
            <L7p:XpathExpression xpathExpressionValue="included">
                <L7p:Expression stringValue="/jvmMetrics/hostName"/>
                <L7p:Namespaces mapValue="included">
                    <L7p:entry>
                        <L7p:key stringValue="s"/>
                        <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                    </L7p:entry>
                </L7p:Namespaces>
                <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
            </L7p:XpathExpression>
        </L7p:ResponseXpathAssertion>
        <L7p:SetVariable>
            <L7p:Base64Expression stringValue="JHtob3N0bmFtZS5yZXN1bHR9"/>
            <L7p:Enabled booleanValue="false"/>
            <L7p:VariableToSet stringValue="node"/>
        </L7p:SetVariable>
        <L7p:ResponseXpathAssertion>
            <L7p:Enabled booleanValue="false"/>
            <L7p:VariablePrefix stringValue="output"/>
            <L7p:XmlMsgSrc stringValue="metricsOutput"/>
            <L7p:XpathExpression xpathExpressionValue="included">
                <L7p:Expression stringValue="/jvmMetrics/memory/heap/used"/>
                <L7p:Namespaces mapValue="included">
                    <L7p:entry>
                        <L7p:key stringValue="s"/>
                        <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                    </L7p:entry>
                </L7p:Namespaces>
                <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
            </L7p:XpathExpression>
        </L7p:ResponseXpathAssertion>
        <L7p:SetVariable>
            <L7p:AssertionComment assertionComment="included">
                <L7p:Properties mapValue="included">
                    <L7p:entry>
                        <L7p:key stringValue="RIGHT.COMMENT"/>
                        <L7p:value stringValue="Add heap used memory metrics"/>
                    </L7p:entry>
                </L7p:Properties>
            </L7p:AssertionComment>
            <L7p:Base64Expression stringValue="JHtqdm1NZXRyaWNzfQ0KeyAidHlwZSIgOiAiTG9uZ0NvdW50ZXIiLCANCiAgIm5hbWUiIDogIiR7bm9kZX18R2F0ZXdheXxKVk18R0MgSGVhcDpCeXRlcyBJbiBVc2UiLCANCiAgInZhbHVlIjogIiR7b3V0cHV0LnJlc3VsdH0iIA0KfQ=="/>
            <L7p:Enabled booleanValue="false"/>
            <L7p:VariableToSet stringValue="jvmMetrics"/>
        </L7p:SetVariable>
        <L7p:SetVariable>
            <L7p:Base64Expression stringValue="JHtqdm1NZXRyaWNzfSw="/>
            <L7p:Enabled booleanValue="false"/>
            <L7p:VariableToSet stringValue="jvmMetrics"/>
        </L7p:SetVariable>
        <L7p:ResponseXpathAssertion>
            <L7p:Enabled booleanValue="false"/>
            <L7p:VariablePrefix stringValue="output"/>
            <L7p:XmlMsgSrc stringValue="metricsOutput"/>
            <L7p:XpathExpression xpathExpressionValue="included">
                <L7p:Expression stringValue="/jvmMetrics/memory/heap/max"/>
                <L7p:Namespaces mapValue="included">
                    <L7p:entry>
                        <L7p:key stringValue="s"/>
                        <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                    </L7p:entry>
                </L7p:Namespaces>
                <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
            </L7p:XpathExpression>
        </L7p:ResponseXpathAssertion>
        <L7p:SetVariable>
            <L7p:AssertionComment assertionComment="included">
                <L7p:Properties mapValue="included">
                    <L7p:entry>
                        <L7p:key stringValue="RIGHT.COMMENT"/>
                        <L7p:value stringValue="Add heap max memory metrics"/>
                    </L7p:entry>
                </L7p:Properties>
            </L7p:AssertionComment>
            <L7p:Base64Expression stringValue="JHtqdm1NZXRyaWNzfQ0KeyAidHlwZSIgOiAiTG9uZ0NvdW50ZXIiLCANCiAgIm5hbWUiIDogIiR7bm9kZX18R2F0ZXdheXxKVk18R0MgSGVhcDpCeXRlcyBUb3RhbCIsIA0KICAidmFsdWUiOiAiJHtvdXRwdXQucmVzdWx0fSIgDQp9"/>
            <L7p:Enabled booleanValue="false"/>
            <L7p:VariableToSet stringValue="jvmMetrics"/>
        </L7p:SetVariable>
        <L7p:XslTransformation>
            <L7p:AssertionComment assertionComment="included">
                <L7p:Properties mapValue="included">
                    <L7p:entry>
                        <L7p:key stringValue="RIGHT.COMMENT"/>
                        <L7p:value stringValue="Using XSLT, translate the thread related data"/>
                    </L7p:entry>
                </L7p:Properties>
            </L7p:AssertionComment>
            <L7p:Direction intValue="-1"/>
            <L7p:Enabled booleanValue="false"/>
            <L7p:OtherTargetMessageVariable stringValue="threadOutput"/>
            <L7p:ResourceInfo staticResourceInfo="included">
                <L7p:Document stringValueReference="inline"><![CDATA[<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:output omit-xml-declaration="yes"/>
<xsl:strip-space elements="*"/>
<xsl:template match="jvmMetrics">
<xsl:variable name="countNewThreads">
<xsl:value-of select="count(threads/thread[state='NEW'])"/>
</xsl:variable>

<xsl:variable name="countRunnableThreads">
<xsl:value-of select="count(threads/thread[state='RUNNABLE'])"/>
</xsl:variable>

<xsl:variable name="countBlockedThreads">
<xsl:value-of select="count(threads/thread[state='BLOCKED'])"/>
</xsl:variable>

<xsl:variable name="countWaitingThreads">
<xsl:value-of select="count(threads/thread[state='WAITING'])"/>
</xsl:variable>

<xsl:variable name="countTimedWaitingThreads">
<xsl:value-of select="count(threads/thread[state='TIMED_WAITING'])"/>
</xsl:variable>

<xsl:variable name="countTerminatedThreads">
<xsl:value-of select="count(threads/thread[state='TERMINATED'])"/>
</xsl:variable>NEW:<xsl:value-of select="normalize-space($countNewThreads)"/>,RUNNABLE:<xsl:value-of select="normalize-space($countRunnableThreads)"/>,BLOCKED:<xsl:value-of select="normalize-space($countBlockedThreads)"/>,WAITING:<xsl:value-of select="normalize-space($countWaitingThreads)"/>,TIMED_WAITING:<xsl:value-of select="normalize-space($countTimedWaitingThreads)"/>,TERMINATED:<xsl:value-of select="normalize-space($countTerminatedThreads)"/>
</xsl:template>
</xsl:stylesheet>]]></L7p:Document>
            </L7p:ResourceInfo>
            <L7p:Target target="OTHER"/>
            <L7p:TransformName stringValue=""/>
            <L7p:XsltVersion stringValue="1.0"/>
        </L7p:XslTransformation>
        <L7p:SetVariable>
            <L7p:Base64Expression stringValue="JHt0aHJlYWRPdXRwdXQubWFpblBhcnR9"/>
            <L7p:Enabled booleanValue="false"/>
            <L7p:VariableToSet stringValue="threadResults"/>
        </L7p:SetVariable>
        <L7p:Split>
            <L7p:Enabled booleanValue="false"/>
            <L7p:InputVariable stringValue="threadResults"/>
            <L7p:OutputVariable stringValue="threadStateCounts"/>
        </L7p:Split>
        <L7p:ForEachLoop L7p:Enabled="false" L7p:Usage="Required"
            loopVariable="threadStateCounts" variablePrefix="state">
            <L7p:Split>
                <L7p:Enabled booleanValue="false"/>
                <L7p:InputVariable stringValue="state.current"/>
                <L7p:OutputVariable stringValue="eachState"/>
                <L7p:SplitPattern stringValue=":"/>
            </L7p:Split>
            <L7p:SetVariable>
                <L7p:Base64Expression stringValue="JHtqdm1NZXRyaWNzfSw="/>
                <L7p:Enabled booleanValue="false"/>
                <L7p:VariableToSet stringValue="jvmMetrics"/>
            </L7p:SetVariable>
            <L7p:SetVariable>
                <L7p:Base64Expression stringValue="JHtqdm1NZXRyaWNzfQ0KeyAidHlwZSIgOiAiSW50Q291bnRlciIsIA0KICAibmFtZSIgOiAiJHtub2RlfXxHYXRld2F5fEpWTXxUaHJlYWRzOiR7ZWFjaFN0YXRlLjF9IiwgDQogICJ2YWx1ZSI6ICIke2VhY2hTdGF0ZS4yfSINCn0="/>
                <L7p:Enabled booleanValue="false"/>
                <L7p:VariableToSet stringValue="jvmMetrics"/>
            </L7p:SetVariable>
            <L7p:assertionComment>
                <L7p:Properties mapValue="included">
                    <L7p:entry>
                        <L7p:key stringValue="RIGHT.COMMENT"/>
                        <L7p:value stringValue="Add metric for each thread type"/>
                    </L7p:entry>
                </L7p:Properties>
            </L7p:assertionComment>
        </L7p:ForEachLoop>
    </wsp:All>
</wsp:Policy>