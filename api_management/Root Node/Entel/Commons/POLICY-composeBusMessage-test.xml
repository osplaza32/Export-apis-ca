<?xml version="1.0" encoding="UTF-8"?>
<wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy">
    <wsp:All wsp:Usage="Required">
        <L7p:AuditDetailAssertion>
            <L7p:Detail stringValue="Policy Fragment: composeBusMessage"/>
        </L7p:AuditDetailAssertion>
        <L7p:SetVariable>
            <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAuaGVhZGVyLnJlcXVlc3RUaW1lc3RhbXB9"/>
            <L7p:VariableToSet stringValue="Timestamp"/>
        </L7p:SetVariable>
        <L7p:Regex>
            <L7p:AutoTarget booleanValue="false"/>
            <L7p:OtherTargetMessageVariable stringValue="Timestamp"/>
            <L7p:Regex stringValue="\-|T|\:|\."/>
            <L7p:RegexVar stringValue="Timestamp"/>
            <L7p:Replace booleanValue="true"/>
            <L7p:Replacement stringValue=""/>
            <L7p:Target target="OTHER"/>
        </L7p:Regex>
        <L7p:Regex>
            <L7p:AutoTarget booleanValue="false"/>
            <L7p:CaptureVar stringValue="Timestamp"/>
            <L7p:OtherTargetMessageVariable stringValue="Timestamp"/>
            <L7p:Regex stringValue="^................"/>
            <L7p:Replace booleanValue="true"/>
            <L7p:Replacement stringValue=""/>
            <L7p:Target target="OTHER"/>
        </L7p:Regex>
        <wsp:OneOrMore wsp:Usage="Required">
            <wsp:All wsp:Usage="Required">
                <L7p:ComparisonAssertion>
                    <L7p:CaseSensitive booleanValue="false"/>
                    <L7p:Expression1 stringValue="${request.http.header.applicationCode}"/>
                    <L7p:Operator operatorNull="null"/>
                    <L7p:Predicates predicates="included">
                        <L7p:item dataType="included">
                            <L7p:Type variableDataType="string"/>
                        </L7p:item>
                        <L7p:item binary="included">
                            <L7p:RightValue stringValue="ATG"/>
                        </L7p:item>
                    </L7p:Predicates>
                </L7p:ComparisonAssertion>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="MDAwOA=="/>
                    <L7p:VariableToSet stringValue="originSystem"/>
                </L7p:SetVariable>
                <L7p:assertionComment>
                    <L7p:Properties mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="RIGHT.COMMENT"/>
                            <L7p:value stringValue="ATG"/>
                        </L7p:entry>
                    </L7p:Properties>
                </L7p:assertionComment>
            </wsp:All>
            <wsp:All wsp:Usage="Required">
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="MDAwMA=="/>
                    <L7p:VariableToSet stringValue="originSystem"/>
                </L7p:SetVariable>
            </wsp:All>
        </wsp:OneOrMore>
        <wsp:OneOrMore wsp:Usage="Required">
            <wsp:All wsp:Usage="Required">
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="JHtyZXF1ZXN0SWR9"/>
                    <L7p:VariableToSet stringValue="originEventID"/>
                </L7p:SetVariable>
                <L7p:Regex>
                    <L7p:AutoTarget booleanValue="false"/>
                    <L7p:IncludeEntireExpressionCapture booleanValue="false"/>
                    <L7p:OtherTargetMessageVariable stringValue="originEventID"/>
                    <L7p:Regex stringValue="\-"/>
                    <L7p:Replace booleanValue="true"/>
                    <L7p:Replacement stringValue=""/>
                    <L7p:Target target="OTHER"/>
                </L7p:Regex>
                <L7p:Regex>
                    <L7p:AutoTarget booleanValue="false"/>
                    <L7p:CaptureVar stringValue="originEventID"/>
                    <L7p:OtherTargetMessageVariable stringValue="originEventID"/>
                    <L7p:Regex stringValue=".{16}$"/>
                    <L7p:Replace booleanValue="true"/>
                    <L7p:Replacement stringValue=""/>
                    <L7p:Target target="OTHER"/>
                </L7p:Regex>
            </wsp:All>
        </wsp:OneOrMore>
        <wsp:OneOrMore wsp:Usage="Required">
            <wsp:All wsp:Usage="Required">
                <L7p:ComparisonAssertion>
                    <L7p:Expression1 stringValue="${format}"/>
                    <L7p:Expression2 stringValue="XML"/>
                    <L7p:Predicates predicates="included">
                        <L7p:item binary="included">
                            <L7p:RightValue stringValue="XML"/>
                        </L7p:item>
                    </L7p:Predicates>
                </L7p:ComparisonAssertion>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="ICAgICAgICAgPG5zMDpSZXF1ZXN0SGVhZGVyIHhtbG5zOm5zMD0iaHR0cDovL3d3dy5lbnRlbC5jbC9FU08vTWVzc2FnZUhlYWRlci92MSI+DQogICAgICAgICAgICA8bnMwOkNvbnN1bWVyIHN5c0NvZGU9IiR7cmVxdWVzdC5odHRwLmhlYWRlci5hcHBsaWNhdGlvbkNvZGV9IiBlbnRlcnByaXNlQ29kZT0iRU5URUwtJHtyZXF1ZXN0Lmh0dHAuaGVhZGVyLmNvdW50cnlDb2RlfSIgY291bnRyeUNvZGU9IiR7cmVxdWVzdC5odHRwLmhlYWRlci5jb3VudHJ5Q29kZX0iLz4NCiAgICAgICAgICAgIDxuczA6VHJhY2UgY2xpZW50UmVxVGltZXN0YW1wPSIke3JlcXVlc3QuaHR0cC5oZWFkZXIucmVxdWVzdFRpbWVzdGFtcH0iIGV2ZW50SUQ9IiR7b3JpZ2luU3lzdGVtfSR7b3BlcmF0aW9uQ29kZX0ke1RpbWVzdGFtcH0ke29yaWdpbkV2ZW50SUR9MDAwIi8+DQogICAgICAgICA8L25zMDpSZXF1ZXN0SGVhZGVyPg=="/>
                    <L7p:VariableToSet stringValue="header"/>
                </L7p:SetVariable>
            </wsp:All>
            <wsp:All wsp:Usage="Required">
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="ew0KICAgICAgIkNvbnN1bWVyIjogew0KICAgICAgICAgInN5c0NvZGUiOiAiJHtyZXF1ZXN0Lmh0dHAuaGVhZGVyLmFwcGxpY2F0aW9uQ29kZX0iLA0KICAgICAgICAgImVudGVycHJpc2VDb2RlIjogIkVOVEVMLSR7cmVxdWVzdC5odHRwLmhlYWRlci5jb3VudHJ5Q29kZX0iLA0KICAgICAgICAgImNvdW50cnlDb2RlIjogIiR7cmVxdWVzdC5odHRwLmhlYWRlci5jb3VudHJ5Q29kZX0iDQogICAgICB9LA0KICAgICAgIlRyYWNlIjogew0KICAgICAgICAgImNsaWVudFJlcVRpbWVzdGFtcCI6ICIke3JlcXVlc3QuaHR0cC5oZWFkZXIucmVxdWVzdFRpbWVzdGFtcH0iLA0KICAgICAgICAgImV2ZW50SUQiOiAiJHtvcmlnaW5TeXN0ZW19JHtvcGVyYXRpb25Db2RlfSR7VGltZXN0YW1wfSR7b3JpZ2luRXZlbnRJRH0wMDAiDQogICAgICB9DQogICB9LA=="/>
                    <L7p:VariableToSet stringValue="header"/>
                </L7p:SetVariable>
            </wsp:All>
        </wsp:OneOrMore>
    </wsp:All>
</wsp:Policy>