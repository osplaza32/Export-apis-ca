<?xml version="1.0" encoding="UTF-8"?>
<wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy">
    <wsp:All wsp:Usage="Required">
        <L7p:AuditDetailAssertion>
            <L7p:Detail stringValue="Policy Fragment: getIdentificationQuiz"/>
        </L7p:AuditDetailAssertion>
        <wsp:OneOrMore wsp:Usage="Required">
            <wsp:All wsp:Usage="Required">
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVycy5jb250cmFjdFR5cGV9"/>
                    <L7p:DataType variableDataType="int"/>
                    <L7p:Enabled booleanValue="false"/>
                    <L7p:VariableToSet stringValue="contractType"/>
                </L7p:SetVariable>
                <L7p:EvaluateJsonPathExpression>
                    <L7p:Expression stringValue=".contractType"/>
                    <L7p:VariablePrefix stringValue="contractType"/>
                </L7p:EvaluateJsonPathExpression>
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAuaGVhZGVyLnJlcXVlc3RUaW1lc3RhbXB9"/>
                    <L7p:VariableToSet stringValue="requestTimestamp"/>
                </L7p:SetVariable>
                <wsp:OneOrMore wsp:Usage="Required">
                    <wsp:All wsp:Usage="Required">
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${contractType.result}"/>
                            <L7p:Operator operatorNull="null"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                </L7p:item>
                                <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="0"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:EvaluateJsonPathExpression>
                            <L7p:Expression stringValue=".dni"/>
                            <L7p:VariablePrefix stringValue="dni"/>
                        </L7p:EvaluateJsonPathExpression>
                        <L7p:EvaluateJsonPathExpression>
                            <L7p:Expression stringValue=".channel"/>
                            <L7p:VariablePrefix stringValue="channel"/>
                        </L7p:EvaluateJsonPathExpression>
                        <L7p:EvaluateJsonPathExpression>
                            <L7p:Expression stringValue=".reason"/>
                            <L7p:VariablePrefix stringValue="reason"/>
                        </L7p:EvaluateJsonPathExpression>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="ew0KICAiUmVxdWVzdEhlYWRlciI6IHsNCiAgICAgICJDb25zdW1lciI6IHsNCiAgICAgICAgICJzeXNDb2RlIjogIiR7cmVxdWVzdC5odHRwLmhlYWRlci5hcHBsaWNhdGlvbkNvZGV9IiwNCiAgICAgICAgICJlbnRlcnByaXNlQ29kZSI6ICJFTlRFTC1QRVIiLA0KICAgICAgICAgImNvdW50cnlDb2RlIjogIiR7cmVxdWVzdC5odHRwLmhlYWRlci5jb3VudHJ5Q29kZX0iDQogICAgICB9LA0KICAgICAgIlRyYWNlIjogew0KICAgICAgICAgImNsaWVudFJlcVRpbWVzdGFtcCI6ICIke3JlcXVlc3QuaHR0cC5oZWFkZXIucmVxdWVzdFRpbWVzdGFtcH0iLA0KICAgICAgICAgInByb2Nlc3NJRCI6ICJDTlNUREVUQ09OU1VNTyIsDQogICAgICAgICAiZXZlbnRJRCI6ICIwMjE1U0FTUzEwMDA0MyR7cmVxdWVzdFRpbWVzdGFtcH0wMDAwMDAwMjM0NTY3MjIyIg0KICAgICAgfQ0KICB9LA0KICAiQm9keSI6IHsNCiAgICAiUmVxdWVzdGVyIjogew0KICAgICAgICAiUXVlc3Rpb25hcnlBbmRBbnN3ZXIiOiB7DQogICAgICAgICAgICAicmVhc29uIjogIiR7cmVhc29uLnJlc3VsdH0iDQogICAgICAgIH0sDQogICAgICAgICJTYWxlc0NoYW5uZWwiOiB7DQogICAgICAgICAgICAiSUQiOiAiJHtjaGFubmVsLnJlc3VsdH0iDQogICAgICAgIH0sDQogICAgICAgICJwYXJ0eUlkZW50aWZpY2F0aW9uIjogew0KICAgICAgICAgICAgIm51bWJlciI6ICIke2RuaS5yZXN1bHR9Ig0KICAgICAgICB9DQogICAgfQ0KICB9DQp9"/>
                            <L7p:ContentType stringValue="application/json; charset=utf-8"/>
                            <L7p:DataType variableDataType="message"/>
                            <L7p:VariableToSet stringValue="jsonRequest"/>
                        </L7p:SetVariable>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="aHR0cDovLyR7Z2F0ZXdheS5sZWdhZG8uaG9zdG5hbWV9L0VTL1NJRi9QYXJ0eUlkZW50aWZpY2F0aW9uUXVpei92MS9HZXQ="/>
                            <L7p:VariableToSet stringValue="urlBackend"/>
                        </L7p:SetVariable>
                        <L7p:AuditDetailAssertion>
                            <L7p:CustomLoggerSuffix stringValue="entel.api.syslog"/>
                            <L7p:Detail stringValue="ID Transaction: ${transactionId.result} Service: ${urlBackend} Request: ${jsonRequest}"/>
                            <L7p:LoggingOnly booleanValue="true"/>
                        </L7p:AuditDetailAssertion>
                        <L7p:HttpRoutingAssertion>
                            <L7p:FailOnErrorStatus booleanValue="false"/>
                            <L7p:HttpMethod httpMethod="POST"/>
                            <L7p:ProtectedServiceUrl stringValue="http://10.49.9.126:8271/getPartyIdentificationQuiz"/>
                            <L7p:ProxyPassword stringValueNull="null"/>
                            <L7p:ProxyUsername stringValueNull="null"/>
                            <L7p:RequestHeaderRules httpPassthroughRuleSet="included">
                                <L7p:ForwardAll booleanValue="true"/>
                                <L7p:Rules httpPassthroughRules="included">
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="Cookie"/>
                                    </L7p:item>
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="SOAPAction"/>
                                    </L7p:item>
                                </L7p:Rules>
                            </L7p:RequestHeaderRules>
                            <L7p:RequestMsgSrc stringValue="jsonRequest"/>
                            <L7p:RequestParamRules httpPassthroughRuleSet="included">
                                <L7p:ForwardAll booleanValue="true"/>
                                <L7p:Rules httpPassthroughRules="included"/>
                            </L7p:RequestParamRules>
                            <L7p:ResponseHeaderRules httpPassthroughRuleSet="included">
                                <L7p:ForwardAll booleanValue="true"/>
                                <L7p:Rules httpPassthroughRules="included">
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="Set-Cookie"/>
                                    </L7p:item>
                                </L7p:Rules>
                            </L7p:ResponseHeaderRules>
                            <L7p:ResponseMsgDest stringValue="serviceResponse"/>
                        </L7p:HttpRoutingAssertion>
                        <L7p:AuditDetailAssertion>
                            <L7p:CustomLoggerSuffix stringValue="entel.api.syslog"/>
                            <L7p:Detail stringValue="ID Transaction: ${transactionId.result} Service: ${httpRouting.url} ReasonCode: ${httpRouting.reasonCode} Response: ${serviceResponse.mainpart}"/>
                            <L7p:LoggingOnly booleanValue="true"/>
                        </L7p:AuditDetailAssertion>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="JHtzZXJ2aWNlUmVzcG9uc2UubWFpbnBhcnR9"/>
                            <L7p:ContentType stringValue="application/json; charset=utf-8"/>
                            <L7p:DataType variableDataType="message"/>
                            <L7p:VariableToSet stringValue="jsonResponse"/>
                        </L7p:SetVariable>
                        <L7p:EvaluateJsonPathExpression>
                            <L7p:Expression stringValue=".Requester"/>
                            <L7p:OtherTargetMessageVariable stringValue="jsonResponse"/>
                            <L7p:Target target="OTHER"/>
                            <L7p:VariablePrefix stringValue="requester"/>
                        </L7p:EvaluateJsonPathExpression>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="JHtyZXF1ZXN0LnRpbWUubG9jYWwueXl5eS1NTS1kZCdUJ0hIOm1tOnNzLlNTU30="/>
                            <L7p:VariableToSet stringValue="responseTimestamp"/>
                        </L7p:SetVariable>
                        <L7p:HardcodedResponse>
                            <L7p:Base64ResponseBody stringValue="ewogICJyZXN1bHQiOiB7CiAgICAiY29kZSI6ICIke2h0dHBSb3V0aW5nLnJlYXNvbkNvZGV9IiwKICAgICJkZXNjcmlwdGlvbiI6ICJPSyIsCiAgICAiZGVzY3JpcHRpb25EZXRhaWwiOiAiUmVzcHVlc3RhIEV4aXRvc2EiLAogICAgInJlc3BvbnNlVGltZXN0YW1wIjogIiR7cmVzcG9uc2VUaW1lc3RhbXB9IiwKICAgICJ0cmFuc2FjdGlvbklkIjogICIke3JlcXVlc3RJZH0iCiAgfSwKICAicmVxdWVzdGVyIjogIiR7cmVxdWVzdGVyLnJlc3VsdH0iCn0="/>
                            <L7p:ResponseContentType stringValue="application/json; charset=UTF-8"/>
                        </L7p:HardcodedResponse>
                    </wsp:All>
                    <wsp:All wsp:Usage="Required">
                        <L7p:ComparisonAssertion>
                            <L7p:CaseSensitive booleanValue="false"/>
                            <L7p:Expression1 stringValue="${contractType.result}"/>
                            <L7p:Operator operatorNull="null"/>
                            <L7p:Predicates predicates="included">
                                <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                </L7p:item>
                                <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="1"/>
                                </L7p:item>
                            </L7p:Predicates>
                        </L7p:ComparisonAssertion>
                        <L7p:EvaluateJsonPathExpression>
                            <L7p:Expression stringValue=".dni"/>
                            <L7p:VariablePrefix stringValue="dni"/>
                        </L7p:EvaluateJsonPathExpression>
                        <L7p:EvaluateJsonPathExpression>
                            <L7p:Expression stringValue=".phoneNumber"/>
                            <L7p:VariablePrefix stringValue="phoneNumber"/>
                        </L7p:EvaluateJsonPathExpression>
                        <L7p:EvaluateJsonPathExpression>
                            <L7p:Expression stringValue=".simNumber"/>
                            <L7p:VariablePrefix stringValue="simNumber"/>
                        </L7p:EvaluateJsonPathExpression>
                        <L7p:EvaluateJsonPathExpression>
                            <L7p:Expression stringValue=".origin"/>
                            <L7p:VariablePrefix stringValue="origin"/>
                        </L7p:EvaluateJsonPathExpression>
                        <L7p:EvaluateJsonPathExpression>
                            <L7p:Expression stringValue=".applicationId"/>
                            <L7p:VariablePrefix stringValue="applicationId"/>
                        </L7p:EvaluateJsonPathExpression>
                        <L7p:EvaluateJsonPathExpression>
                            <L7p:Expression stringValue=".user"/>
                            <L7p:VariablePrefix stringValue="user"/>
                        </L7p:EvaluateJsonPathExpression>
                        <L7p:EvaluateJsonPathExpression>
                            <L7p:Expression stringValue=".transactionIdESB"/>
                            <L7p:VariablePrefix stringValue="transactionIdESB"/>
                        </L7p:EvaluateJsonPathExpression>
                        <L7p:EvaluateJsonPathExpression>
                            <L7p:Expression stringValue=".transactionIdBusiness"/>
                            <L7p:VariablePrefix stringValue="transactionIdBusiness"/>
                        </L7p:EvaluateJsonPathExpression>
                        <L7p:EvaluateJsonPathExpression>
                            <L7p:Expression stringValue=".startDate"/>
                            <L7p:VariablePrefix stringValue="startDate"/>
                        </L7p:EvaluateJsonPathExpression>
                        <L7p:EvaluateJsonPathExpression>
                            <L7p:Expression stringValue=".additionalNode"/>
                            <L7p:VariablePrefix stringValue="additionalNode"/>
                        </L7p:EvaluateJsonPathExpression>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="ew0KICAgImhlYWRlciI6ew0KICAgICAgImNhbmFsIjoiJHtjaGFubmVsLnJlc3VsdH0iLA0KICAgICAgImlkQXBsaWNhY2lvbiI6JHthcHBsaWNhdGlvbklkLnJlc3VsdH0sDQogICAgICAidXN1YXJpbyI6IiR7dXNlci5yZXN1bHR9IiwNCiAgICAgICJpZFRyYW5zYWNjaW9uRVNCIjoiJHt0cmFuc2FjdGlvbklkRVNCLnJlc3VsdH0iLA0KICAgICAgImlkVHJhbnNhY2Npb25OZWdvY2lvIjoiJHt0cmFuc2FjdGlvbklkQnVzaW5lc3MucmVzdWx0fSIsDQogICAgICAiZmVjaGFJbmljaW8iOiIke3N0YXJ0RGF0ZS5yZXN1bHR9IiwNCiAgICAgICJub2RvQWRpY2lvbmFsIjoiJHthZGRpdGlvbmFsTm9kZS5yZXN1bHR9Ig0KICAgfSwNCiAgICJib2R5Ijp7DQogICAgICAiZG9jdW1lbnROdW1iZXIiOiIke2RuaS5yZXN1bHR9IiwNCiAgICAgICJwaG9uZU51bWJlciI6IiR7cGhvbmVOdW1iZXIucmVzdWx0fSIsDQogICAgICAiU2ltTnVtYmVyIjoiJHtTaW1OdW1iZXIucmVzdWx0fSIsDQogICAgICAib3JpZ2luIjoiJHtvcmlnaW4ucmVzdWx0fSINCiAgIH0NCn0="/>
                            <L7p:ContentType stringValue="application/json; charset=utf-8"/>
                            <L7p:DataType variableDataType="message"/>
                            <L7p:VariableToSet stringValue="jsonRequest"/>
                        </L7p:SetVariable>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="aHR0cDovLzEwLjQ5LjkuMTI2OjgyNzMvdmFsaWRhdGVOb0Jpb21ldHJpY3M="/>
                            <L7p:VariableToSet stringValue="urlBackend"/>
                        </L7p:SetVariable>
                        <L7p:AuditDetailAssertion>
                            <L7p:CustomLoggerSuffix stringValue="entel.api.syslog"/>
                            <L7p:Detail stringValue="ID Transaction: ${transactionId.result} Service: ${urlBackend} Request: ${jsonRequest}"/>
                            <L7p:LoggingOnly booleanValue="true"/>
                        </L7p:AuditDetailAssertion>
                        <L7p:HttpRoutingAssertion>
                            <L7p:FailOnErrorStatus booleanValue="false"/>
                            <L7p:HttpMethod httpMethod="POST"/>
                            <L7p:ProtectedServiceUrl stringValue="http://10.49.9.126:8273/validateNoBiometrics"/>
                            <L7p:ProxyPassword stringValueNull="null"/>
                            <L7p:ProxyUsername stringValueNull="null"/>
                            <L7p:RequestHeaderRules httpPassthroughRuleSet="included">
                                <L7p:ForwardAll booleanValue="true"/>
                                <L7p:Rules httpPassthroughRules="included">
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="Cookie"/>
                                    </L7p:item>
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="SOAPAction"/>
                                    </L7p:item>
                                </L7p:Rules>
                            </L7p:RequestHeaderRules>
                            <L7p:RequestMsgSrc stringValue="jsonRequest"/>
                            <L7p:RequestParamRules httpPassthroughRuleSet="included">
                                <L7p:ForwardAll booleanValue="true"/>
                                <L7p:Rules httpPassthroughRules="included"/>
                            </L7p:RequestParamRules>
                            <L7p:ResponseHeaderRules httpPassthroughRuleSet="included">
                                <L7p:ForwardAll booleanValue="true"/>
                                <L7p:Rules httpPassthroughRules="included">
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="Set-Cookie"/>
                                    </L7p:item>
                                </L7p:Rules>
                            </L7p:ResponseHeaderRules>
                            <L7p:ResponseMsgDest stringValue="serviceResponse"/>
                        </L7p:HttpRoutingAssertion>
                        <L7p:AuditDetailAssertion>
                            <L7p:CustomLoggerSuffix stringValue="entel.api.syslog"/>
                            <L7p:Detail stringValue="ID Transaction: ${transactionId.result} Service: ${httpRouting.url} ReasonCode: ${httpRouting.reasonCode} Response: ${serviceResponse.mainpart}"/>
                            <L7p:LoggingOnly booleanValue="true"/>
                        </L7p:AuditDetailAssertion>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="JHtzZXJ2aWNlUmVzcG9uc2UubWFpbnBhcnR9"/>
                            <L7p:ContentType stringValue="application/json; charset=utf-8"/>
                            <L7p:DataType variableDataType="message"/>
                            <L7p:VariableToSet stringValue="jsonResponse"/>
                        </L7p:SetVariable>
                        <L7p:EvaluateJsonPathExpression>
                            <L7p:Expression stringValue=".responseStatus"/>
                            <L7p:OtherTargetMessageVariable stringValue="jsonResponse"/>
                            <L7p:Target target="OTHER"/>
                            <L7p:VariablePrefix stringValue="responseStatus"/>
                        </L7p:EvaluateJsonPathExpression>
                        <L7p:EvaluateJsonPathExpression>
                            <L7p:Expression stringValue=".responseData"/>
                            <L7p:OtherTargetMessageVariable stringValue="jsonResponse"/>
                            <L7p:Target target="OTHER"/>
                            <L7p:VariablePrefix stringValue="responseData"/>
                        </L7p:EvaluateJsonPathExpression>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="JHtyZXF1ZXN0LnRpbWUubG9jYWwueXl5eS1NTS1kZCdUJ0hIOm1tOnNzLlNTU30="/>
                            <L7p:VariableToSet stringValue="responseTimestamp"/>
                        </L7p:SetVariable>
                        <L7p:HardcodedResponse>
                            <L7p:Base64ResponseBody stringValue="ewogICJyZXN1bHQiOiB7CiAgICAiY29kZSI6ICIke2h0dHBSb3V0aW5nLnJlYXNvbkNvZGV9IiwKICAgICJkZXNjcmlwdGlvbiI6ICJPSyIsCiAgICAiZGVzY3JpcHRpb25EZXRhaWwiOiAiUmVzcHVlc3RhIEV4aXRvc2EiLAogICAgInJlc3BvbnNlVGltZXN0YW1wIjogIiR7cmVzcG9uc2VUaW1lc3RhbXB9IiwKICAgICJ0cmFuc2FjdGlvbklkIjogICIke3JlcXVlc3RJZH0iCiAgfSwKICAicmVzcG9uc2VTdGF0dXMiOiAiJHtyZXNwb25zZVN0YXR1cy5yZXN1bHR9IiwKICAicmVzcG9uc2VEYXRhIjogIiR7cmVzcG9uc2VEYXRhLnJlc3VsdH0iCn0="/>
                            <L7p:ResponseContentType stringValue="application/json; charset=UTF-8"/>
                        </L7p:HardcodedResponse>
                    </wsp:All>
                    <wsp:All wsp:Usage="Required">
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="NDAw"/>
                            <L7p:VariableToSet stringValue="code"/>
                        </L7p:SetVariable>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="QmFkIFJlcXVlc3Q="/>
                            <L7p:VariableToSet stringValue="description"/>
                        </L7p:SetVariable>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue="RXN0cnVjdHVyYSBkZSBVUkkgaW52w6FsaWRh"/>
                            <L7p:VariableToSet stringValue="descriptionDetail"/>
                        </L7p:SetVariable>
                        <L7p:CustomizeErrorResponse>
                            <L7p:Content stringValueReference="inline"><![CDATA[{
"result":{
	"transactionId":"${requestId}",
	"code":"${code}",
	"description":"${description}",
	"descriptionDetail":"${descriptionDetail}",
	"responseTimestamp":"${responseTimestamp}"
	}
}]]></L7p:Content>
                            <L7p:ContentType stringValue="application/json; charset=UTF-8"/>
                            <L7p:ExtraHeaders nameValuePairArray="included"/>
                            <L7p:HttpStatus stringValue="400"/>
                        </L7p:CustomizeErrorResponse>
                        <L7p:RaiseError/>
                    </wsp:All>
                </wsp:OneOrMore>
            </wsp:All>
            <wsp:All wsp:Usage="Required">
                <L7p:SetVariable>
                    <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAuaGVhZGVyLnJlcXVlc3RUaW1lc3RhbXB9"/>
                    <L7p:VariableToSet stringValue="requestTimestamp"/>
                </L7p:SetVariable>
                <L7p:Include>
                    <L7p:PolicyGuid stringValue="1b3f18a3-5e88-4cae-9fae-44b459727ac1"/>
                </L7p:Include>
            </wsp:All>
        </wsp:OneOrMore>
    </wsp:All>
</wsp:Policy>